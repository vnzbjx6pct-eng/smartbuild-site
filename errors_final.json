[{"filePath":"/Users/dmitri/smartbuild-site/app/ClientHomeTracker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/account/error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/account/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/account/loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/account/notifications/page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/dmitri/smartbuild-site/app/account/notifications/page.tsx:41:9\n  39 |     useEffect(() => {\n  40 |          \n> 41 |         fetchNotifications();\n     |         ^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  42 |     }, []);\n  43 |\n  44 |     const filteredNotifications = useMemo(() => {","line":41,"column":9,"nodeType":null,"endLine":41,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2518,2521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2518,2521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2818,2821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2818,2821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3069,3072],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3069,3072],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3083,3086],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3083,3086],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":112,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4219,4222],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4219,4222],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":141,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5752,5755],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5752,5755],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState, useMemo } from \"react\";\nimport { supabase } from \"@/app/lib/supabaseClient\";\nimport type { Notification } from \"@/app/lib/types\";\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\nimport Link from \"next/link\";\nimport { ArrowLeft, Clock, AlertTriangle, Info, AlertCircle } from \"lucide-react\";\n\n// Derived state must be computed with useMemo; do not setState in useEffect for filtering\nexport default function NotificationsPage() {\n    const { t } = useLanguage();\n    const [notifications, setNotifications] = useState<Notification[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [filter, setFilter] = useState<'all' | 'unread' | 'important'>('all');\n\n    const fetchNotifications = async () => {\n        setLoading(true);\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) {\n            setNotifications([]);\n            setLoading(false);\n            return;\n        }\n\n        const { data } = await supabase\n            .from('notifications')\n            .select('*')\n            .eq('user_id', user.id)\n            .order('created_at', { ascending: false })\n            .limit(100);\n\n        if (data) {\n            setNotifications(data as unknown as Notification[]);\n        }\n        setLoading(false);\n    };\n\n    useEffect(() => {\n         \n        fetchNotifications();\n    }, []);\n\n    const filteredNotifications = useMemo(() => {\n        return notifications.filter(n => {\n            if (filter === 'unread') return !n.is_read;\n            if (filter === 'important') return ['action_required', 'error', 'warning'].includes(n.severity);\n            return true;\n        });\n    }, [notifications, filter]);\n\n    const markAllRead = async () => {\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) return;\n\n        setNotifications(prev => prev.map(n => ({ ...n, is_read: true })));\n\n        await supabase\n            .from('notifications')\n            .update({ is_read: true })\n            .eq('user_id', user.id)\n            .eq('is_read', false);\n\n        // Background sync\n        const { data } = await supabase\n            .from('notifications')\n            .select('*')\n            .eq('user_id', user.id)\n            .order('created_at', { ascending: false })\n            .limit(100);\n\n        if (data) setNotifications(data as unknown as Notification[]);\n    };\n\n    const getLocalizedText = (n: Notification) => {\n        const dict = (t as any).notifications || {};\n        const title = n.title_key ? titleFallback(n.title_key, dict) : n.title_text || \"\";\n        const body = n.body_key ? bodyFallback(n.body_key, dict, n.payload) : n.body_text || \"\";\n        return { title, body };\n    };\n\n    const titleFallback = (key: string, dict: any) => {\n        const parts = key.split('.');\n        if (parts.length === 3 && parts[0] === 'notifications') {\n            return dict[parts[1]]?.[parts[2]] || key;\n        }\n        return key;\n    };\n\n    const bodyFallback = (key: string, dict: any, payload: any) => {\n        let text = titleFallback(key, dict);\n        if (payload && typeof payload === 'object') {\n            Object.keys(payload).forEach(k => {\n                text = text.replace(`{${k}}`, payload[k]);\n            });\n        }\n        return text;\n    };\n\n    return (\n        <div className=\"min-h-screen bg-slate-50 pb-20\">\n            <div className=\"max-w-md mx-auto bg-white min-h-screen shadow-sm\">\n                {/* Header */}\n                <div className=\"p-4 border-b border-slate-100 flex items-center justify-between sticky top-0 bg-white/80 backdrop-blur-md z-10\">\n                    <div className=\"flex items-center gap-3\">\n                        <Link href=\"/account\" className=\"p-2 -ml-2 hover:bg-slate-50 rounded-full\">\n                            <ArrowLeft className=\"text-slate-600\" size={24} />\n                        </Link>\n                        <h1 className=\"text-xl font-bold text-slate-900\">Notifications</h1>\n                    </div>\n                    <button onClick={markAllRead} className=\"text-sm font-medium text-blue-600 hover:text-blue-700\">\n                        {(t as any).notifications?.mark_all_read || \"Mark all read\"}\n                    </button>\n                </div>\n\n                {/* Filters */}\n                <div className=\"p-4 flex gap-2 overflow-x-auto no-scrollbar\">\n                    {(['all', 'unread', 'important'] as const).map(f => (\n                        <button\n                            key={f}\n                            onClick={() => setFilter(f)}\n                            className={`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors\n                                ${filter === f\n                                    ? 'bg-slate-900 text-white'\n                                    : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}\n                        >\n                            {f.charAt(0).toUpperCase() + f.slice(1)}\n                        </button>\n                    ))}\n                </div>\n\n                {/* List */}\n                <div className=\"px-4 space-y-3\">\n                    {loading ? (\n                        <div className=\"py-10 text-center text-slate-400\">Loading...</div>\n                    ) : filteredNotifications.length === 0 ? (\n                        <div className=\"py-20 text-center\">\n                            <div className=\"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-300\">\n                                <Info size={32} />\n                            </div>\n                            <p className=\"text-slate-500\">{(t as any).notifications?.empty || \"No notifications\"}</p>\n                        </div>\n                    ) : (\n                        filteredNotifications.map(n => {\n                            const { title, body } = getLocalizedText(n);\n\n                            return (\n                                <Link\n                                    key={n.id}\n                                    href={n.payload?.order_id ? `/account/orders/${n.payload.order_id}` : '#'}\n                                    className={`block p-4 rounded-2xl border transition-all\n                                        ${!n.is_read ? 'bg-white border-blue-200 shadow-sm' : 'bg-slate-50/50 border-transparent'}\n                                    `}\n                                >\n                                    <div className=\"flex items-start gap-4\">\n                                        <div className={`mt-1 shrink-0\n                                            ${n.severity === 'action_required' ? 'text-amber-500' : ''}\n                                            ${n.severity === 'error' ? 'text-red-500' : ''}\n                                            ${n.severity === 'warning' ? 'text-amber-500' : ''}\n                                            ${n.severity === 'info' ? 'text-blue-500' : ''}\n                                        `}>\n                                            {(n.severity === 'action_required' || n.severity === 'warning') && <AlertTriangle size={20} />}\n                                            {n.severity === 'error' && <AlertCircle size={20} />}\n                                            {n.severity === 'info' && <Info size={20} />}\n                                        </div>\n                                        <div className=\"flex-1 min-w-0\">\n                                            <div className=\"flex justify-between items-start gap-2 mb-1\">\n                                                <h3 className={`font-semibold text-base ${!n.is_read ? 'text-slate-900' : 'text-slate-700'}`}>\n                                                    {title}\n                                                </h3>\n                                                {!n.is_read && (\n                                                    <span className=\"w-2 h-2 rounded-full bg-blue-500 mt-1.5 shrink-0\"></span>\n                                                )}\n                                            </div>\n                                            <p className=\"text-slate-600 text-sm leading-relaxed mb-2\">{body}</p>\n                                            <div className=\"flex items-center gap-2 text-xs text-slate-400\">\n                                                <Clock size={12} />\n                                                {new Date(n.created_at).toLocaleString([], { dateStyle: 'short', timeStyle: 'short' })}\n                                            </div>\n                                        </div>\n                                    </div>\n                                </Link>\n                            );\n                        })\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/account/orders/[id]/loading.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Skeleton' is defined but never used.","line":1,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":18,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Skeleton"},"fix":{"range":[0,52],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Skeleton } from \"@/components/ui/Skeleton\";\n\nexport default function LoadingOrder() {\n    return (\n        <div className=\"max-w-3xl mx-auto space-y-8 animate-pulse\">\n            <div className=\"h-8 w-32 bg-slate-200 rounded mb-6\"></div>\n\n            {/* Header */}\n            <div className=\"bg-white p-6 rounded-2xl border border-slate-200 space-y-4\">\n                <div className=\"flex justify-between\">\n                    <div className=\"h-6 w-48 bg-slate-200 rounded\"></div>\n                    <div className=\"h-6 w-24 bg-slate-200 rounded\"></div>\n                </div>\n                <div className=\"h-10 w-3/4 bg-slate-200 rounded\"></div>\n            </div>\n\n            {/* Timeline */}\n            <div className=\"bg-white p-6 rounded-2xl border border-slate-200 h-32\"></div>\n\n            {/* Items */}\n            <div className=\"bg-white rounded-2xl border border-slate-200 overflow-hidden\">\n                <div className=\"p-4 border-b border-slate-100 flex gap-4\">\n                    <div className=\"h-16 w-16 bg-slate-200 rounded\"></div>\n                    <div className=\"flex-1 space-y-2\">\n                        <div className=\"h-4 w-1/2 bg-slate-200 rounded\"></div>\n                        <div className=\"h-4 w-1/4 bg-slate-200 rounded\"></div>\n                    </div>\n                </div>\n                <div className=\"p-4 border-b border-slate-100 flex gap-4\">\n                    <div className=\"h-16 w-16 bg-slate-200 rounded\"></div>\n                    <div className=\"flex-1 space-y-2\">\n                        <div className=\"h-4 w-1/2 bg-slate-200 rounded\"></div>\n                        <div className=\"h-4 w-1/4 bg-slate-200 rounded\"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/account/orders/[id]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":6,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":40,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Clock"},"fix":{"range":[176,183],"text":""},"desc":"Remove unused variable \"Clock\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Phone' is defined but never used.","line":6,"column":59,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":64,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Phone"},"fix":{"range":[200,207],"text":""},"desc":"Remove unused variable \"Phone\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronRight' is defined but never used.","line":6,"column":92,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":104,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ChevronRight"},"fix":{"range":[233,247],"text":""},"desc":"Remove unused variable \"ChevronRight\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[877,880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[877,880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1065,1068],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1065,1068],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1705,1708],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1705,1708],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6296,6299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6296,6299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has unnecessary dependencies: 'dict.account', 'dict.delivery', and 'dict.order_details'. Either exclude them or remove the dependency array.","line":183,"column":8,"nodeType":"ArrayExpression","endLine":183,"endColumn":70,"suggestions":[{"desc":"Update the dependencies array to be: [order, dict]","fix":{"range":[7333,7395],"text":"[order, dict]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState, useMemo } from \"react\";\nimport { useParams } from \"next/navigation\";\nimport Link from \"next/link\";\nimport { ArrowLeft, CheckCircle2, Clock, MapPin, Package, Phone, AlertCircle, Truck, Info, ChevronRight, HelpCircle, Star, Repeat, FileText, AlertTriangle, XCircle } from \"lucide-react\";\nimport { supabase } from \"@/app/lib/supabaseClient\";\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\nimport type { Order, OrderItem, Shipment } from \"@/app/lib/types\";\nimport type { DeliveryUXState } from \"@/app/lib/delivery/ux\";\nimport { getDeliveryUXState } from \"@/app/lib/delivery/ux\";\nimport { DeliverySeverity, DeliveryAction } from \"@/app/lib/delivery/reasonCodes\";\n\n// --- VIEW MODEL ---\ntype TimelineStep = {\n    id: string;\n    label: string;\n    completed: boolean;\n    current: boolean;\n    date?: string;\n    icon: any;\n};\n\ntype OrderViewModel = {\n    id: string;\n    displayId: string;\n    humanStatus: {\n        text: string;\n        color: \"green\" | \"blue\" | \"amber\" | \"red\" | \"slate\";\n        icon: any;\n        description?: string;\n    };\n    uxState: DeliveryUXState;\n    eta?: {\n        label: string;\n        value: string; // \"Today 17:00-19:00\"\n        isDelayed: boolean;\n    };\n    timeline: TimelineStep[];\n    groups: {\n        title: string;\n        items: (OrderItem & { image?: string })[];\n        shipment?: Shipment;\n    }[];\n    delivery: {\n        address: string;\n        contact: string;\n        method: string;\n    };\n};\n\nexport default function OrderDetailsPage() {\n    const params = useParams();\n    const id = params?.id as string;\n    const { t } = useLanguage();\n    const dict = t as unknown as Record<string, any>;\n\n    const [order, setOrder] = useState<Order | null>(null);\n    const [loading, setLoading] = useState(true);\n    // const [activeTab, setActiveTab] = useState<string>(\"today\"); // Unused\n\n    // --- DATA FETCHING ---\n    useEffect(() => {\n        const fetchOrder = async () => {\n            const { data: { user } } = await supabase.auth.getUser();\n            if (!user || !id) return;\n\n            const { data } = await supabase\n                .from(\"orders\")\n                .select(`\n                    *,\n                    items(*),\n                    shipments(*, events:shipment_events(*))\n                `)\n                .eq(\"id\", id)\n                .eq(\"user_id\", user.id)\n                .single();\n\n            if (data) setOrder(data as unknown as Order);\n            setLoading(false);\n        };\n        fetchOrder();\n    }, [id]);\n\n    // --- LOGIC: MAP TO VIEW MODEL ---\n    const model: OrderViewModel | null = useMemo(() => {\n        if (!order) return null;\n\n        const dOrder = dict.order_details;\n        const dictReasons = dict.delivery?.reasons || {};\n        const dictAcc = dict.account;\n\n        let globalStatus: \"in_progress\" | \"completed\" | \"problem\" = \"in_progress\";\n        const hasShipments = (order.shipments?.length ?? 0) > 0;\n        const allDelivered = hasShipments && order.shipments!.every(s => s.status === 'delivered');\n        const anyProblem = order.shipments?.some(s => s.status === 'failed' || s.status === 'cancelled') ?? false;\n\n        if (allDelivered) globalStatus = \"completed\";\n        if (anyProblem) globalStatus = \"problem\";\n\n        const statusMap = {\n            in_progress: { text: dOrder.status_in_progress, color: \"blue\" as const, icon: Truck, description: \"Kuller on teel\" },\n            completed: { text: dOrder.status_completed, color: \"green\" as const, icon: CheckCircle2, description: \"Kõik kaubad kohal\" },\n            problem: { text: dOrder.status_problem, color: \"red\" as const, icon: AlertCircle, description: dOrder.reason_high_demand },\n        };\n\n        // 2. ETA Logic\n        const etas = order.shipments?.map(s => s.eta_minutes ? new Date(new Date(s.created_at).getTime() + s.eta_minutes * 60000) : null).filter(Boolean) || [];\n        const latestEta = etas.length > 0 ? new Date(Math.max(...etas.map(d => d!.getTime()))) : null;\n\n        let etaDisplay = undefined;\n        if (latestEta) {\n            const isToday = latestEta.toDateString() === new Date().toDateString();\n            const timeStr = latestEta.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n            etaDisplay = {\n                label: dOrder.eta_title,\n                value: `${isToday ? dOrder.eta_today : dOrder.eta_tomorrow}, ${timeStr}`,\n                isDelayed: globalStatus === 'problem'\n            };\n        }\n\n        // 3. Timeline Logic\n        const steps = [\n            { id: 'placed', label: dOrder.timeline_placed, icon: FileText, completed: true },\n            { id: 'confirmed', label: dOrder.timeline_confirmed, icon: CheckCircle2, completed: order.status !== 'draft' },\n            { id: 'assembly', label: dOrder.timeline_assembly, icon: Package, completed: order.status !== 'draft' && order.status !== 'submitted' },\n            { id: 'shipping', label: dOrder.timeline_shipping, icon: Truck, completed: order.shipments?.some(s => ['dispatched', 'delivered'].includes(s.status)) ?? false },\n            { id: 'delivered', label: dOrder.timeline_delivered, icon: Star, completed: allDelivered }\n        ];\n\n        let foundCurrent = false;\n        const timeline = steps.map(s => {\n            const isCurrent = !s.completed && !foundCurrent;\n            if (isCurrent) foundCurrent = true;\n            return { ...s, current: isCurrent || (s.id === 'delivered' && s.completed) };\n        });\n\n        // 4. Grouping Items\n        const groups = [];\n        if (order.shipments && order.shipments.length > 0) {\n            order.shipments.forEach((s) => {\n                if (s.events) {\n                    s.events = s.events.map(ev => {\n                        if (ev.visibility === 'internal') return null;\n                        let msg = ev.message;\n                        if (ev.reason_code && dictReasons[ev.reason_code]) {\n                            msg = dictReasons[ev.reason_code].title;\n                        } else if (!msg) {\n                            msg = (dictAcc[`timeline_${ev.event_status}`] || ev.event_status);\n                        }\n                        return { ...ev, message: msg };\n                    }).filter(Boolean) as any;\n                }\n\n                groups.push({\n                    title: (dictAcc[`type_${s.type}`] || s.type) + ` • ${(dictAcc[`shipment_${s.status}`] || s.status)}`,\n                    items: order.items?.filter(i => i.shipment_id === s.id) || [],\n                    shipment: s\n                });\n            });\n        } else {\n            groups.push({\n                title: dOrder.tab_today, // Fallback\n                items: order.items || []\n            });\n        }\n\n        return {\n            id: order.id,\n            displayId: order.id.slice(0, 8),\n            humanStatus: statusMap[globalStatus],\n            uxState: getDeliveryUXState(order, order.shipments || []),\n            eta: etaDisplay,\n            timeline,\n            groups,\n            delivery: {\n                address: `${order.address_line}, ${order.city}`,\n                contact: order.phone,\n                method: order.shipments?.[0]?.type === 'pickup' ? dictAcc.type_pickup : dictAcc.type_wolt\n            }\n        };\n\n    }, [order, dict, dict.order_details, dict.delivery, dict.account]);\n\n    if (loading) return <div></div>;\n    if (!order || !model) return <div className=\"p-8 text-center text-slate-500\">Order not found</div>;\n\n    const StatusIcon = model.humanStatus.icon;\n\n    return (\n        <div className=\"max-w-3xl mx-auto pb-20\">\n            {/* Nav */}\n            <Link href=\"/account/orders\" className=\"inline-flex items-center gap-2 text-slate-500 hover:text-slate-800 mb-6 font-medium text-sm transition-colors\">\n                <ArrowLeft size={16} />\n                {dict.account.back_to_orders}\n            </Link>\n\n            {/* 1. Header Card */}\n            <div className={`\n                relative overflow-hidden rounded-3xl p-6 mb-8 text-white shadow-lg transition-transform hover:scale-[1.01] duration-300\n                ${model.humanStatus.color === 'blue' ? 'bg-gradient-to-br from-blue-600 to-indigo-700' : ''}\n                ${model.humanStatus.color === 'green' ? 'bg-gradient-to-br from-emerald-500 to-emerald-700' : ''}\n                ${model.humanStatus.color === 'red' ? 'bg-gradient-to-br from-rose-500 to-red-700' : ''}\n            `}>\n                <div className=\"relative z-10\">\n                    <div className=\"flex justify-between items-start mb-6\">\n                        <div className=\"bg-white/10 backdrop-blur-md px-3 py-1 rounded-full text-xs font-mono tracking-wider border border-white/20\">\n                            #{model.displayId}\n                        </div>\n                        {model.eta && (\n                            <div className=\"text-right\">\n                                <div className=\"text-blue-100 text-xs font-medium uppercase tracking-wider mb-1 opacity-80\">{model.eta.label}</div>\n                                <div className=\"text-2xl font-bold tracking-tight\">{model.eta.value}</div>\n                            </div>\n                        )}\n                    </div>\n\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"p-3 bg-white/20 backdrop-blur-sm rounded-2xl border border-white/10 shadow-inner\">\n                            <StatusIcon size={32} className=\"text-white\" strokeWidth={1.5} />\n                        </div>\n                        <div>\n                            <h1 className=\"text-3xl font-bold tracking-tight text-white mb-1\">\n                                {model.humanStatus.text}\n                            </h1>\n                            <p className=\"text-blue-100 text-lg opacity-90 font-medium\">\n                                {model.humanStatus.description}\n                            </p>\n                        </div>\n                    </div>\n\n                    {model.uxState.showCard && model.uxState.reasonCode && (\n                        <div className={`mt-6 backdrop-blur-md rounded-2xl p-4 border flex gap-4 items-start\n                            ${model.uxState.severity === DeliverySeverity.INFO ? 'bg-blue-500/10 border-blue-400/20 text-blue-50' : ''}\n                            ${model.uxState.severity === DeliverySeverity.WARNING ? 'bg-amber-500/10 border-amber-400/20 text-amber-50' : ''}\n                            ${model.uxState.severity === DeliverySeverity.ACTION_REQUIRED ? 'bg-rose-500/20 border-rose-400/30 text-rose-50' : ''}\n                            ${model.uxState.severity === DeliverySeverity.ERROR ? 'bg-red-900/40 border-red-500/30 text-red-50' : ''}\n                        `}>\n                            {model.uxState.severity === DeliverySeverity.INFO && <Info className=\"shrink-0 mt-0.5 text-blue-200\" />}\n                            {(model.uxState.severity === DeliverySeverity.WARNING || model.uxState.severity === DeliverySeverity.ACTION_REQUIRED) && <AlertTriangle className=\"shrink-0 mt-0.5 text-amber-200\" />}\n                            {model.uxState.severity === DeliverySeverity.ERROR && <XCircle className=\"shrink-0 mt-0.5 text-red-300\" />}\n\n                            <div className=\"flex-1\">\n                                <div className=\"font-bold text-lg mb-1\">\n                                    {dict.delivery.ux[model.uxState.reasonCode].title}\n                                </div>\n                                <div className=\"text-white/80 text-sm mb-3\">\n                                    {dict.delivery.ux[model.uxState.reasonCode].description}\n                                </div>\n\n                                {model.uxState.action !== DeliveryAction.NONE && (\n                                    <button className=\"bg-white text-slate-900 font-bold py-2 px-4 rounded-xl text-sm hover:bg-slate-100 transition-colors\">\n                                        {dict.delivery.ux.cta[model.uxState.action]}\n                                    </button>\n                                )}\n                            </div>\n                        </div>\n                    )}\n                </div>\n\n                {/* Decorative BG */}\n                <div className=\"absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full -translate-y-1/2 translate-x-1/3 blur-3xl\"></div>\n                <div className=\"absolute bottom-0 left-0 w-48 h-48 bg-black/10 rounded-full translate-y-1/3 -translate-x-1/4 blur-2xl\"></div>\n            </div>\n\n\n            {/* 2. Visual Timeline */}\n            <div className=\"mb-10 px-2 lg:px-0\">\n                <div className=\"flex justify-between items-center relative\">\n                    {/* Connection Line */}\n                    <div className=\"absolute top-1/2 left-0 w-full h-1 bg-slate-100 -z-10 rounded-full\"></div>\n                    <div className=\"absolute top-1/2 left-0 h-1 bg-emerald-500/20 -z-10 rounded-full transition-all duration-1000\"\n                        style={{ width: `${(model.timeline.filter(s => s.completed).length / (model.timeline.length - 1)) * 100}%` }}\n                    ></div>\n\n                    {model.timeline.map((step, idx) => {\n                        const Icon = step.icon;\n                        const isCompleted = step.completed;\n                        const isCurrent = step.current;\n\n                        return (\n                            <div key={idx} className=\"flex flex-col items-center gap-3\">\n                                <div className={`\n                                    w-10 h-10 rounded-full flex items-center justify-center border-4 z-10 transition-all duration-500\n                                    ${isCompleted ? 'bg-emerald-500 border-white text-white shadow-lg shadow-emerald-500/30 scale-110' :\n                                        isCurrent ? 'bg-white border-blue-500 text-blue-500 ring-4 ring-blue-500/20' :\n                                            'bg-slate-50 border-slate-200 text-slate-300'}\n                                `}>\n                                    <Icon size={isCompleted ? 18 : 16} strokeWidth={isCompleted ? 3 : 2} />\n                                </div>\n                                <span className={`\n                                    text-xs font-semibold uppercase tracking-wider text-center max-w-[80px] transition-colors\n                                    ${isCompleted ? 'text-emerald-700' : isCurrent ? 'text-blue-700' : 'text-slate-400'}\n                                `}>\n                                    {step.label}\n                                </span>\n                            </div>\n                        );\n                    })}\n                </div>\n            </div>\n\n            {/* 3. Order Content (Groups) */}\n            <div className=\"space-y-6 mb-10\">\n                <h3 className=\"text-xl font-bold text-slate-900 px-2\">{dict.order_details.items_count.replace('{count}', order.items?.reduce((acc, i) => acc + (i.qty || 0), 0) || 0)}</h3>\n\n                {model.groups.map((group, idx) => (\n                    <div key={idx} className=\"bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden\">\n                        <div className=\"bg-slate-50/50 px-6 py-3 border-b border-slate-100 flex justify-between items-center\">\n                            <span className=\"font-semibold text-slate-700 text-sm flex items-center gap-2\">\n                                <Package size={16} className=\"text-slate-400\" />\n                                {group.title}\n                            </span>\n                            {group.shipment?.eta_minutes && (\n                                <span className=\"text-xs font-medium bg-emerald-100 text-emerald-700 px-2 py-1 rounded\">\n                                    ~{group.shipment.eta_minutes} min\n                                </span>\n                            )}\n                        </div>\n                        <div className=\"divide-y divide-slate-100\">\n                            {group.items.map((item) => (\n                                <div key={item.id} className=\"p-4 flex gap-4 items-center hover:bg-slate-50/50 transition-colors\">\n                                    <div className=\"w-16 h-16 bg-slate-100 rounded-lg shrink-0 flex items-center justify-center\">\n                                        {/* Image Placeholder */}\n                                        <Package className=\"text-slate-300\" size={24} />\n                                    </div>\n                                    <div className=\"flex-1 min-w-0\">\n                                        <div className=\"font-bold text-slate-900 truncate\">{item.name}</div>\n                                        <div className=\"text-sm text-slate-500\">{item.qty} {dict.common.pcs} × {item.price.toFixed(2)} €</div>\n                                    </div>\n                                    <div className=\"text-right font-bold text-slate-900\">\n                                        {item.line_total.toFixed(2)} €\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                ))}\n            </div>\n\n            {/* 4. Delivery & Meta Grid */}\n            <div className=\"grid md:grid-cols-2 gap-6 mb-10\">\n                <div className=\"bg-white p-6 rounded-2xl border border-slate-200 shadow-sm space-y-4\">\n                    <h4 className=\"font-bold text-slate-900 flex items-center gap-2 text-sm uppercase tracking-wide text-slate-500\">\n                        <MapPin size={16} />\n                        {dict.order_details.shipping_address}\n                    </h4>\n                    <div className=\"text-lg font-medium text-slate-900\">{model.delivery.address}</div>\n                    <div className=\"bg-slate-50 p-3 rounded-xl flex items-center gap-3 text-sm text-slate-600\">\n                        <div className=\"w-8 h-8 rounded-full bg-white border border-slate-200 flex items-center justify-center font-bold text-xs text-slate-500\">\n                            {model.delivery.contact.slice((model.delivery.contact.length || 2) - 2)}\n                        </div>\n                        <div>\n                            <div className=\"font-bold text-slate-900\">{dict.order_details.contact_receiver}</div>\n                            {model.delivery.contact}\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"bg-white p-6 rounded-2xl border border-slate-200 shadow-sm space-y-4\">\n                    <h4 className=\"font-bold text-slate-900 flex items-center gap-2 text-sm uppercase tracking-wide text-slate-500\">\n                        <Info size={16} />\n                        {dict.order_details.shipping_method}\n                    </h4>\n                    <div className=\"text-lg font-medium text-slate-900 flex items-center gap-2\">\n                        {model.delivery.method}\n                        <CheckCircle2 size={16} className=\"text-emerald-500\" />\n                    </div>\n\n                    {/* Summary Mini */}\n                    <div className=\"pt-4 border-t border-slate-100 flex justify-between items-center mt-2\">\n                        <span className=\"text-slate-500\">Total</span>\n                        <span className=\"text-xl font-black text-slate-900\">{order.total.toFixed(2)} €</span>\n                    </div>\n                </div>\n            </div>\n\n            {/* 5. Help & Actions */}\n            <div className=\"space-y-4\">\n                {/* Help Block */}\n                <div className=\"bg-indigo-50 border border-indigo-100 rounded-2xl p-6 flex flex-col md:flex-row items-center gap-6 text-center md:text-left\">\n                    <div className=\"bg-white p-4 rounded-full shadow-sm text-indigo-500 shrink-0\">\n                        <HelpCircle size={24} />\n                    </div>\n                    <div className=\"flex-1\">\n                        <h4 className=\"font-bold text-indigo-900 text-lg mb-1\">{dict.order_details.help_title}</h4>\n                        <p className=\"text-indigo-700/80 text-sm\">{dict.order_details.help_desc}</p>\n                    </div>\n                    <div className=\"flex flex-col gap-2 w-full md:w-auto\">\n                        <button className=\"bg-white hover:bg-indigo-100 text-indigo-600 font-semibold py-2 px-4 rounded-xl border border-indigo-200 transition-colors text-sm\">\n                            {dict.order_details.action_faq}\n                        </button>\n                    </div>\n                </div>\n\n                {/* Primary Actions */}\n                <div className=\"grid grid-cols-2 gap-4\">\n                    <button className=\"flex items-center justify-center gap-2 bg-white hover:bg-slate-50 text-slate-600 font-bold py-4 rounded-xl border border-slate-200 transition-colors shadow-sm\">\n                        <Repeat size={18} />\n                        {dict.order_details.action_repeat}\n                    </button>\n                    <button className=\"flex items-center justify-center gap-2 bg-slate-900 hover:bg-slate-800 text-white font-bold py-4 rounded-xl transition-colors shadow-lg shadow-slate-900/10\">\n                        <Star size={18} />\n                        {dict.order_details.action_rate}\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/account/orders/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5507,5510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5507,5510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5767,5770],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5767,5770],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6575,6578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6575,6578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { supabase } from \"@/app/lib/supabaseClient\";\nimport Link from \"next/link\";\nimport { ChevronRight, Package, ShoppingCart } from \"lucide-react\";\nimport type { Order } from \"@/app/lib/types\";\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\n\nexport default function OrdersPage() {\n    const [orders, setOrders] = useState<Order[]>([]);\n    const [filter, setFilter] = useState<'all' | 'active' | 'done'>('active');\n    const [loading, setLoading] = useState(true);\n    const { t } = useLanguage();\n\n    useEffect(() => {\n        const fetch = async () => {\n            const { data: { user } } = await supabase.auth.getUser();\n            if (!user) return;\n\n            const { data } = await supabase\n                .from(\"orders\")\n                .select(\"*, shipments(type)\")\n                .eq(\"user_id\", user.id)\n                .order(\"created_at\", { ascending: false });\n\n            if (data) setOrders(data as Order[]);\n            setLoading(false);\n        };\n        fetch();\n    }, []);\n\n    if (loading) return <div>...</div>;\n\n    return (\n        <div>\n            <h1 className=\"text-2xl font-bold text-slate-900 mb-6\">{t.account.nav_orders || \"Minu Tellimused\"}</h1>\n\n            {/* Filters */}\n            <div className=\"flex gap-2 mb-6 border-b border-slate-200 pb-1\">\n                <button\n                    onClick={() => setFilter('active')}\n                    className={`px-4 py-2 text-sm font-medium rounded-t-lg transition-colors border-b-2 ${filter === 'active' ? 'border-emerald-500 text-emerald-600 bg-emerald-50/50' : 'border-transparent text-slate-500 hover:text-slate-700'\n                        }`}\n                >\n                    Aktiivsed\n                </button>\n                <button\n                    onClick={() => setFilter('done')}\n                    className={`px-4 py-2 text-sm font-medium rounded-t-lg transition-colors border-b-2 ${filter === 'done' ? 'border-emerald-500 text-emerald-600 bg-emerald-50/50' : 'border-transparent text-slate-500 hover:text-slate-700'\n                        }`}\n                >\n                    Lõpetatud\n                </button>\n                <button\n                    onClick={() => setFilter('all')}\n                    className={`px-4 py-2 text-sm font-medium rounded-t-lg transition-colors border-b-2 ${filter === 'all' ? 'border-emerald-500 text-emerald-600 bg-emerald-50/50' : 'border-transparent text-slate-500 hover:text-slate-700'\n                        }`}\n                >\n                    Kõik\n                </button>\n            </div>\n\n            <div className=\"space-y-4\">\n                {orders.filter(o => {\n                    if (filter === 'all') return true;\n                    if (filter === 'active') return ['draft', 'submitted', 'confirmed'].includes(o.status);\n                    if (filter === 'done') return ['completed', 'cancelled'].includes(o.status);\n                    return true;\n                }).length === 0 ? (\n                    <div className=\"py-16 text-center bg-white rounded-xl border border-slate-200 shadow-sm flex flex-col items-center\">\n                        <div className=\"w-16 h-16 bg-slate-100 text-slate-400 rounded-full flex items-center justify-center mb-4\">\n                            <Package size={32} />\n                        </div>\n                        <h3 className=\"text-lg font-bold text-slate-900 mb-2\">{t.account.no_orders}</h3>\n                        <p className=\"text-slate-500 mb-6 max-w-xs\">{t.cart.empty_text || \"Lisa tooteid kataloogist, et võrrelda hindu ja küsida pakkumist.\"}</p>\n                        <Link\n                            href=\"/products\"\n                            className=\"inline-flex items-center gap-2 bg-emerald-600 hover:bg-emerald-500 text-white font-medium px-6 py-2.5 rounded-xl transition-colors\"\n                        >\n                            <ShoppingCart size={18} />\n                            {t.products.back_to_catalog}\n                        </Link>\n                    </div>\n                ) : (\n                    orders.filter(o => {\n                        if (filter === 'all') return true;\n                        if (filter === 'active') return ['draft', 'submitted', 'confirmed'].includes(o.status);\n                        if (filter === 'done') return ['completed', 'cancelled'].includes(o.status);\n                        return true;\n                    }).map(order => (\n                        <Link key={order.id} href={`/account/orders/${order.id}`} className=\"block bg-white p-6 rounded-xl border border-slate-200 shadow-sm hover:border-emerald-500 transition-all group\">\n                            <div className=\"flex justify-between items-center\">\n                                <div>\n                                    <div className=\"flex items-center gap-3 mb-1\">\n                                        <span className=\"font-bold text-slate-900 text-lg\">#{order.id.slice(0, 8)}</span>\n                                        <div className=\"text-xs text-slate-400\">{new Date(order.created_at).toLocaleDateString()} {new Date(order.created_at).toLocaleTimeString().slice(0, 5)}</div>\n                                    </div>\n                                    <div className=\"flex items-center gap-2\">\n                                        {/* Shipments Badges */}\n                                        {order.shipments?.map((s: any, idx) => (\n                                            <span key={idx} className=\"bg-slate-100 text-slate-600 text-xs px-2 py-1 rounded capitalize font-medium\">\n                                                {s.type === 'wolt' ? '🚀 ' : ''}{(t.account as any)[`type_${s.type}`] || s.type}\n                                            </span>\n                                        ))}\n                                    </div>\n                                </div>\n                                <div className=\"text-right\">\n                                    <div className=\"font-black text-xl text-slate-900 mb-1\">{order.total.toFixed(2)} €</div>\n                                    <span className={`inline-block px-3 py-1 rounded-full text-xs font-bold uppercase ${order.status === 'completed' ? 'bg-green-100 text-green-700' :\n                                        order.status === 'cancelled' ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700'\n                                        }`}>\n                                        {(t.account as any)[`status_${order.status}`] || order.status}\n                                    </span>\n                                </div>\n                                <div className=\"pl-4 text-slate-300 group-hover:text-emerald-500 transition-colors\">\n                                    <ChevronRight />\n                                </div>\n                            </div>\n                        </Link>\n                    ))\n                )}\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/account/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Truck' is defined but never used.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Truck"},"fix":{"range":[152,158],"text":""},"desc":"Remove unused variable \"Truck\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { supabase } from \"@/app/lib/supabaseClient\";\nimport Link from \"next/link\";\nimport { Truck, Clock } from \"lucide-react\";\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\n\ninterface OrderItem {\n    id: string;\n    name: string;\n    qty: number;\n    price: number;\n    unit: string;\n    line_total: number;\n}\n\ninterface Order {\n    id: string;\n    created_at: string;\n    total: number;\n    status: string;\n    items: OrderItem[];\n}\n\nexport default function AccountOverview() {\n    const [lastOrder, setLastOrder] = useState<Order | null>(null);\n    const [loading, setLoading] = useState(true);\n    const { t } = useLanguage();\n\n    useEffect(() => {\n        const fetch = async () => {\n            const { data: { user } } = await supabase.auth.getUser();\n            if (!user) return;\n\n            const { data } = await supabase\n                .from(\"orders\")\n                .select(\"*, items(*)\")\n                .eq(\"user_id\", user.id)\n                .order(\"created_at\", { ascending: false })\n                .limit(1)\n                .single();\n\n            if (data) setLastOrder(data);\n            setLoading(false);\n        };\n        fetch();\n    }, []);\n\n    // Helper to create test order\n    const createTestOrder = async () => {\n        setLoading(true);\n        const { data: { session } } = await supabase.auth.getSession();\n        await fetch(\"/api/orders/create\", {\n            method: \"POST\",\n            headers: {\n                \"Authorization\": \"Bearer \" + session?.access_token,\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n                items: [\n                    { id: \"p1\", name: \"Keraamiline Plaat Retro\", price: 25.50, quantity: 2, unit: \"m2\" },\n                    { id: \"p2\", name: \"Kruvid 5x50mm\", price: 4.20, quantity: 1, unit: \"tk\" }\n                ],\n                totals: { subtotal: 55.20, delivery: 5.00, total: 60.20 },\n                delivery: { method: \"wolt\", split: true, woltItems: [\"p2\"], woltFee: 5.00, secondaryMethod: \"pickup\" },\n                userDetails: { city: \"Tallinn\", address: \"Pärnu mnt 123\", phone: \"+37255555555\", notes: \"Gate code 1234\" }\n            })\n        });\n        window.location.reload();\n    };\n\n    if (loading) return <div>...</div>;\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex justify-between items-center\">\n                <h1 className=\"text-2xl font-bold text-slate-900\">{t.account.welcome_back || \"Tere tulemast tagasi!\"}</h1>\n                <button onClick={createTestOrder} className=\"text-xs bg-slate-200 px-2 py-1 rounded hover:bg-slate-300 transition-colors\">\n                    {t.account.create_test_order}\n                </button>\n            </div>\n\n            <div className=\"grid md:grid-cols-3 gap-6\">\n                <div className=\"bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex items-center justify-between\">\n                    <div>\n                        <div className=\"text-slate-500 text-sm mb-1\">Viimane tellimus</div>\n                        {lastOrder ? (\n                            <div className=\"font-bold text-lg text-slate-900\">\n                                {new Date(lastOrder.created_at).toLocaleDateString()}\n                            </div>\n                        ) : (\n                            <div className=\"text-slate-400 italic\">Puudub</div>\n                        )}\n                    </div>\n                    <div className=\"w-10 h-10 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center\">\n                        <Clock size={20} />\n                    </div>\n                </div>\n            </div>\n\n            <div className=\"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden\">\n                <div className=\"p-6 border-b border-slate-100 flex justify-between items-center\">\n                    <h3 className=\"font-bold text-lg text-slate-900\">Viimane tellimus</h3>\n                    {lastOrder && (\n                        <Link href={`/account/orders/${lastOrder.id}`} className=\"text-emerald-600 text-sm font-bold hover:underline\">\n                            Vaata detaile\n                        </Link>\n                    )}\n                </div>\n                {lastOrder ? (\n                    <div className=\"p-6\">\n                        <div className=\"flex justify-between mb-4\">\n                            <div>\n                                <div className=\"text-xs text-slate-400 uppercase tracking-wider font-bold mb-1\">ORDER #{lastOrder.id.slice(0, 8)}</div>\n                                <div className=\"font-bold text-slate-900\">{lastOrder.total} €</div>\n                            </div>\n                            <div className=\"text-right\">\n                                <span className={`px-3 py-1 rounded-full text-xs font-bold uppercase ${lastOrder.status === 'completed' ? 'bg-green-100 text-green-700' :\n                                    lastOrder.status === 'cancelled' ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700'\n                                    }`}>\n                                    {lastOrder.status}\n                                </span>\n                            </div>\n                        </div>\n                        <div className=\"space-y-2\">\n                            {lastOrder.items?.slice(0, 3).map((item) => (\n                                <div key={item.id} className=\"flex justify-between text-sm\">\n                                    <span className=\"text-slate-600\">{item.qty}x {item.name}</span>\n                                    <span className=\"font-medium text-slate-900\">{item.line_total} €</span>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                ) : (\n                    <div className=\"p-12 text-center text-slate-400\">\n                        {t.account.no_orders || \"Tellimuste ajalugu on tühi.\"}\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/account/partner/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRef' is defined but never used.","line":3,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":50,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useRef"},"fix":{"range":[56,64],"text":""},"desc":"Remove unused variable \"useRef\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState, useEffect, useCallback, useRef } from \"react\";\nimport { createClientComponentClient } from \"@supabase/auth-helpers-nextjs\";\nimport { isPartner } from \"@/app/lib/auth\";\nimport { useRouter } from \"next/navigation\";\n\nimport {\n    LayoutDashboard,\n    Upload,\n    FileSpreadsheet,\n    ListFilter,\n    AlertCircle,\n    CheckCircle2,\n    Loader2,\n    Search,\n    Lock,\n    Boxes\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { savePartnerProducts, getPartnerProducts } from \"@/app/actions/partner\";\nimport { normalizeCsvRow, type PartnerProductDraft, type CsvRowError } from \"@/app/lib/partner/csv\";\n\ninterface PartnerProduct {\n    id: string;\n    product_name: string;\n    category: string;\n    price: number;\n    stock: number;\n    status: string;\n}\n\nexport default function PartnerDashboardPage() {\n    const router = useRouter();\n    const supabase = createClientComponentClient();\n\n    const [authStatus, setAuthStatus] = useState<'loading' | 'authorized' | 'denied'>('loading');\n\n    useEffect(() => {\n        const checkAccess = async () => {\n            const { data: { session } } = await supabase.auth.getSession();\n            if (!session) {\n                router.push(\"/login?next=/account/partner\");\n                return;\n            }\n\n            const authorized = await isPartner(session.user, supabase);\n            setAuthStatus(authorized ? 'authorized' : 'denied');\n        };\n        checkAccess();\n    }, [router, supabase]);\n\n    // Dashboard State\n    const [activeTab, setActiveTab] = useState<'overview' | 'import' | 'products'>('import');\n    const [file, setFile] = useState<File | null>(null);\n    const [preview, setPreview] = useState<PartnerProductDraft[]>([]);\n    const [allData, setAllData] = useState<PartnerProductDraft[]>([]);\n    const [uploading, setUploading] = useState(false);\n    const [uploadStatus, setUploadStatus] = useState<'idle' | 'success' | 'error'>('idle');\n\n    // Products State\n    const [dbProducts, setDbProducts] = useState<PartnerProduct[]>([]);\n    const [loadingProducts, setLoadingProducts] = useState(false);\n\n    // Fetch products\n    const loadProducts = useCallback(async () => {\n        try {\n            const result = await getPartnerProducts();\n            if (result.success && result.data) {\n                setDbProducts(result.data);\n            } else {\n                console.error(\"Failed to load products:\", result.error);\n            }\n        } catch (e) {\n            console.error(e);\n        } finally {\n            setLoadingProducts(false);\n        }\n    }, []);\n\n    // Load on tab change\n    useEffect(() => {\n        if (activeTab === 'products' && authStatus === 'authorized') {\n            loadProducts();\n        }\n    }, [activeTab, authStatus, loadProducts]);\n\n    if (authStatus === 'loading') {\n        return (\n            <div className=\"min-h-screen bg-slate-50 pt-24 pb-12 flex items-center justify-center\">\n                <Loader2 className=\"w-8 h-8 text-slate-400 animate-spin\" />\n            </div>\n        );\n    }\n\n    if (authStatus === 'denied') {\n        return (\n            <div className=\"min-h-screen bg-slate-50 pt-24 pb-12 px-4\">\n                <div className=\"max-w-md mx-auto bg-white rounded-2xl shadow-sm border border-slate-100 p-8 text-center\">\n                    <div className=\"w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4\">\n                        <Lock className=\"text-red-500\" size={32} />\n                    </div>\n                    <h1 className=\"text-2xl font-bold text-slate-900 mb-2\">Access Denied</h1>\n                    <p className=\"text-slate-500 mb-8\">\n                        You do not have the required Partner permissions to access this dashboard.\n                    </p>\n                    <div className=\"space-y-3\">\n                        <Link\n                            href=\"/partners\"\n                            className=\"block w-full px-6 py-3 bg-slate-900 text-white font-bold rounded-xl hover:bg-slate-800 transition-all\"\n                        >\n                            Become a Partner\n                        </Link>\n                        <Link\n                            href=\"/account\"\n                            className=\"block w-full px-6 py-3 bg-white border border-slate-200 text-slate-700 font-bold rounded-xl hover:bg-slate-50 transition-all\"\n                        >\n                            Back to My Account\n                        </Link>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    // Strict CSV Parser\n    const parseCSV = (text: string) => {\n        const lines = text.split('\\n');\n        const headers = lines[0].split(',').map(h => h.trim());\n\n        const validRows: PartnerProductDraft[] = [];\n        const rowErrors: CsvRowError[] = [];\n\n        for (let i = 1; i < lines.length; i++) {\n            if (!lines[i].trim()) continue;\n\n            const currentline = lines[i].split(',');\n            const rawObj: Record<string, string> = {};\n\n            headers.forEach((header, index) => {\n                if (currentline[index] !== undefined) {\n                    rawObj[header] = currentline[index].trim();\n                }\n            });\n\n            const { value, error } = normalizeCsvRow(rawObj, i);\n            if (value) {\n                validRows.push(value);\n            } else if (error) {\n                rowErrors.push(error);\n            }\n        }\n        return { validRows, rowErrors };\n    };\n\n    const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\n        if (e.target.files && e.target.files[0]) {\n            const f = e.target.files[0];\n            setFile(f);\n            setUploadStatus('idle');\n\n            const text = await f.text();\n            const { validRows } = parseCSV(text);\n\n            setAllData(validRows);\n            // setErrors(rowErrors);\n            setPreview(validRows.slice(0, 5));\n        }\n    };\n\n    const handleUpload = async () => {\n        setUploading(true);\n        try {\n            const result = await savePartnerProducts(allData);\n\n            if (result.success) {\n                setUploadStatus('success');\n                setFile(null);\n                setPreview([]);\n                setAllData([]);\n                // Optionally reload products if we switch tabs or show count\n            } else {\n                setUploadStatus('error');\n                console.error(\"Upload failed\", result.error);\n            }\n        } catch (e) {\n            console.error(e);\n            setUploadStatus('error');\n        }\n        setUploading(false);\n    };\n\n    return (\n        <div className=\"min-h-screen bg-slate-50 pt-24 pb-12\">\n            <div className=\"container mx-auto px-4\">\n                <div className=\"flex flex-col md:flex-row gap-8\">\n\n                    {/* Sidebar */}\n                    <div className=\"w-full md:w-64 shrink-0\">\n                        <div className=\"bg-white rounded-2xl shadow-sm border border-slate-100 p-6 sticky top-24\">\n                            <div className=\"flex items-center gap-3 mb-8\">\n                                <div className=\"w-10 h-10 rounded-lg bg-orange-100 flex items-center justify-center text-orange-600 font-bold\">\n                                    SB\n                                </div>\n                                <div>\n                                    <h2 className=\"font-bold text-slate-900\">Partner Portal</h2>\n                                    <p className=\"text-xs text-slate-500\">My Store</p>\n                                </div>\n                            </div>\n\n                            <nav className=\"space-y-2\">\n                                <button\n                                    onClick={() => setActiveTab('overview')}\n                                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === 'overview' ? 'bg-slate-900 text-white shadow-lg shadow-slate-900/10' : 'text-slate-600 hover:bg-slate-50'}`}\n                                >\n                                    <LayoutDashboard size={18} />\n                                    <span className=\"font-medium\">Overview</span>\n                                </button>\n                                <button\n                                    onClick={() => setActiveTab('import')}\n                                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === 'import' ? 'bg-slate-900 text-white shadow-lg shadow-slate-900/10' : 'text-slate-600 hover:bg-slate-50'}`}\n                                >\n                                    <Upload size={18} />\n                                    <span className=\"font-medium\">Import Products</span>\n                                </button>\n                                <button\n                                    onClick={() => {\n                                        setActiveTab('products');\n                                        if (authStatus === 'authorized') setLoadingProducts(true);\n                                    }}\n                                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === 'products' ? 'bg-slate-900 text-white shadow-lg shadow-slate-900/10' : 'text-slate-600 hover:bg-slate-50'}`}\n                                >\n                                    <ListFilter size={18} />\n                                    <span className=\"font-medium\">My Products</span>\n                                </button>\n                            </nav>\n                        </div>\n                    </div>\n\n                    {/* Main Content */}\n                    <div className=\"flex-1\">\n\n                        {activeTab === 'import' && (\n                            <div className=\"bg-white rounded-2xl shadow-sm border border-slate-100 p-8\">\n                                <h1 className=\"text-2xl font-bold text-slate-900 mb-2\">Import Products</h1>\n                                <p className=\"text-slate-500 mb-8\">Upload your product catalog in CSV format. We will validate and sync it with SmartBuild.</p>\n\n                                {/* File Drop */}\n                                <div className=\"border-2 border-dashed border-slate-200 rounded-2xl p-10 text-center hover:border-orange-400 hover:bg-orange-50 transition-all group\">\n                                    <div className=\"w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-white transition-colors\">\n                                        <FileSpreadsheet className=\"text-blue-600\" size={32} />\n                                    </div>\n                                    <h3 className=\"text-lg font-bold text-slate-800 mb-2\">Click to upload CSV</h3>\n                                    <p className=\"text-slate-400 text-sm mb-6\">or drag and drop file here</p>\n                                    <input type=\"file\" accept=\".csv\" onChange={handleFileChange} className=\"absolute inset-0 opacity-0 cursor-pointer\" />\n                                    <div className=\"inline-block px-4 py-2 bg-white border border-slate-200 rounded-lg text-xs font-mono text-slate-500\">\n                                        product_name, category, price, stock, delivery_days\n                                    </div>\n                                </div>\n\n                                {/* Preview */}\n                                {file && (\n                                    <div className=\"mt-8 animate-in fade-in slide-in-from-bottom-4\">\n                                        <div className=\"flex items-center justify-between mb-4\">\n                                            <h3 className=\"font-bold text-slate-900 flex items-center gap-2\">\n                                                <CheckCircle2 size={18} className=\"text-green-500\" />\n                                                Preview: {file.name}\n                                            </h3>\n                                            <span className=\"text-sm text-slate-500\">{(file.size / 1024).toFixed(1)} KB</span>\n                                        </div>\n\n                                        <div className=\"overflow-x-auto border border-slate-200 rounded-xl\">\n                                            <table className=\"w-full text-sm text-left\">\n                                                <thead className=\"bg-slate-50 text-slate-600 font-medium border-b border-slate-200\">\n                                                    <tr>\n                                                        {preview[0] && Object.keys(preview[0]).map((key) => (\n                                                            <th key={key} className=\"px-4 py-3 whitespace-nowrap\">{key}</th>\n                                                        ))}\n                                                    </tr>\n                                                </thead>\n                                                <tbody>\n                                                    {preview.map((row, i: number) => (\n                                                        <tr key={i} className=\"border-b border-slate-100 last:border-0 hover:bg-slate-50\">\n                                                            {Object.values(row).map((val, j) => (\n                                                                <td key={j} className=\"px-4 py-3 text-slate-700 whitespace-nowrap\">{String(val)}</td>\n                                                            ))}\n                                                        </tr>\n                                                    ))}\n                                                </tbody>\n                                            </table>\n                                        </div>\n\n                                        <div className=\"mt-6 flex justify-end\">\n                                            <button\n                                                onClick={handleUpload}\n                                                disabled={uploading}\n                                                className=\"px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl transition-all shadow-lg shadow-blue-600/20 flex items-center gap-2 disabled:opacity-70\"\n                                            >\n                                                {uploading ? <Loader2 className=\"animate-spin\" /> : <Upload size={18} />}\n                                                {uploading ? 'Importing...' : 'Confirm Import'}\n                                            </button>\n                                        </div>\n                                    </div>\n                                )}\n\n                                {uploadStatus === 'success' && !file && (\n                                    <div className=\"mt-6 p-4 bg-green-50 text-green-700 rounded-xl flex items-center gap-3\">\n                                        <CheckCircle2 size={20} />\n                                        <div className=\"font-medium\">Import successful! Products are being processed.</div>\n                                    </div>\n                                )}\n                            </div>\n                        )}\n\n                        {activeTab === 'overview' && (\n                            <div className=\"space-y-6\">\n                                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                                    <StatCard title=\"Total Products\" value=\"1,248\" icon={Boxes} color=\"bg-blue-50 text-blue-600\" />\n                                    <StatCard title=\"Active Orders\" value=\"12\" icon={Boxes} color=\"bg-orange-50 text-orange-600\" />\n                                    <StatCard title=\"Revenue (MTD)\" value=\"€8,420\" icon={ListFilter} color=\"bg-green-50 text-green-600\" />\n                                </div>\n                                <div className=\"bg-white rounded-2xl shadow-sm border border-slate-100 p-8 text-center py-20\">\n                                    <div className=\"w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4\">\n                                        <AlertCircle className=\"text-slate-400\" size={32} />\n                                    </div>\n                                    <h3 className=\"text-lg font-bold text-slate-900\">No recent alerts</h3>\n                                    <p className=\"text-slate-500\">Your integration is running smoothly.</p>\n                                </div>\n                            </div>\n                        )}\n\n                        {activeTab === 'products' && (\n                            <div className=\"bg-white rounded-2xl shadow-sm border border-slate-100 p-8\">\n                                <div className=\"flex justify-between items-center mb-6\">\n                                    <h1 className=\"text-2xl font-bold text-slate-900\">My Products</h1>\n                                    <div className=\"relative\">\n                                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={16} />\n                                        <input className=\"pl-9 pr-4 py-2 border border-slate-200 rounded-lg text-sm\" placeholder=\"Search...\" />\n                                    </div>\n                                </div>\n                                {loadingProducts ? (\n                                    <div className=\"text-center py-12 text-slate-500\">\n                                        <Loader2 className=\"w-8 h-8 animate-spin mx-auto mb-2\" />\n                                        Loading products...\n                                    </div>\n                                ) : (\n                                    <div className=\"overflow-x-auto\">\n                                        <table className=\"w-full text-sm text-left\">\n                                            <thead className=\"bg-slate-50 text-slate-600 font-medium border-b border-slate-200\">\n                                                <tr>\n                                                    <th className=\"px-4 py-3\">Product Name</th>\n                                                    <th className=\"px-4 py-3\">Category</th>\n                                                    <th className=\"px-4 py-3\">Price</th>\n                                                    <th className=\"px-4 py-3\">Stock</th>\n                                                    <th className=\"px-4 py-3\">Status</th>\n                                                </tr>\n                                            </thead>\n                                            <tbody>\n                                                {dbProducts.map((p) => (\n                                                    <tr key={p.id} className=\"border-b border-slate-100 last:border-0 hover:bg-slate-50\">\n                                                        <td className=\"px-4 py-3 font-medium text-slate-900\">{p.product_name}</td>\n                                                        <td className=\"px-4 py-3 text-slate-500\">{p.category}</td>\n                                                        <td className=\"px-4 py-3 text-slate-900\">€{p.price}</td>\n                                                        <td className=\"px-4 py-3 text-slate-500\">{p.stock}</td>\n                                                        <td className=\"px-4 py-3\">\n                                                            <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-50 text-green-700\">\n                                                                {p.status}\n                                                            </span>\n                                                        </td>\n                                                    </tr>\n                                                ))}\n                                                {dbProducts.length === 0 && (\n                                                    <tr>\n                                                        <td colSpan={5} className=\"text-center py-8 text-slate-500\">\n                                                            No products found. Import some using the Import tab.\n                                                        </td>\n                                                    </tr>\n                                                )}\n                                            </tbody>\n                                        </table>\n                                    </div>\n                                )}\n                            </div>\n                        )}\n\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n\ninterface StatCardProps {\n    title: string;\n    value: string;\n    icon: React.ElementType;\n    color: string;\n}\n\nfunction StatCard({ title, value, icon: Icon, color }: StatCardProps) {\n    return (\n        <div className=\"bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-4\">\n            <div className={`w-12 h-12 rounded-xl ${color} flex items-center justify-center shrink-0`}>\n                <Icon size={24} />\n            </div>\n            <div>\n                <p className=\"text-sm text-slate-500\">{title}</p>\n                <div className=\"text-2xl font-bold text-slate-900\">{value}</div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/account/settings/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/actions/auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/actions/partner.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/admin/analytics/AdminDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":11,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TrendingUp"},"fix":{"range":[148,164],"text":""},"desc":"Remove unused variable \"TrendingUp\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used.","line":12,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":10,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Users"},"fix":{"range":[164,175],"text":""},"desc":"Remove unused variable \"Users\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'timeRange' is assigned a value but never used.","line":74,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":74,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setTimeRange' is assigned a value but never used.","line":74,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":74,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState } from \"react\";\nimport {\n    Activity,\n    AlertTriangle,\n    BarChart3,\n    Building2,\n    CheckCircle2,\n    Globe,\n    TrendingUp,\n    Users,\n    ShieldAlert,\n    Clock\n} from \"lucide-react\";\n\n// --- MOCK DATA GENERATION (Simulating Database Aggregation) ---\n\ntype CityStat = {\n    name: string;\n    rfqCount: number;\n    partnersActive: number;\n    managersActive: number;\n    health: 'GOOD' | 'WARNING' | 'CRITICAL';\n    fallbackRate: number; // % of RFQs going to generic email\n};\n\ntype PartnerStat = {\n    name: string;\n    cityCoverage: number;\n    managerCount: number;\n    rfqReceived: number;\n    lastActivity: string;\n    healthScore: number; // 0-100\n};\n\ntype Alert = {\n    id: string;\n    type: 'CRITICAL' | 'WARNING' | 'INFO';\n    message: string;\n    date: string;\n};\n\n// Mocked Snapshot Data\nconst KPI_STATS = {\n    totalRfqs7d: 142,\n    totalRfqs30d: 589,\n    assignedRate: 98.2, // %\n    responseRateApprox: 76, // %\n    activeCities: 4\n};\n\nconst CITY_STATS: CityStat[] = [\n    { name: 'Tallinn', rfqCount: 312, partnersActive: 4, managersActive: 12, health: 'GOOD', fallbackRate: 2 },\n    { name: 'Tartu', rfqCount: 156, partnersActive: 3, managersActive: 8, health: 'GOOD', fallbackRate: 5 },\n    { name: 'Pärnu', rfqCount: 98, partnersActive: 2, managersActive: 5, health: 'WARNING', fallbackRate: 15 },\n    { name: 'Narva', rfqCount: 23, partnersActive: 1, managersActive: 1, health: 'CRITICAL', fallbackRate: 45 },\n];\n\nconst PARTNER_STATS: PartnerStat[] = [\n    { name: 'Espak', cityCoverage: 4, managerCount: 15, rfqReceived: 210, lastActivity: '2 min tagasi', healthScore: 98 },\n    { name: 'Bauhof', cityCoverage: 3, managerCount: 8, rfqReceived: 145, lastActivity: '15 min tagasi', healthScore: 92 },\n    { name: 'Decora', cityCoverage: 2, managerCount: 4, rfqReceived: 89, lastActivity: '1 tund tagasi', healthScore: 85 },\n    { name: 'Ehituse ABC', cityCoverage: 4, managerCount: 10, rfqReceived: 145, lastActivity: '4 tundi tagasi', healthScore: 88 },\n];\n\nconst ALERTS: Alert[] = [\n    { id: '1', type: 'CRITICAL', message: 'Narva: Fallback email usage > 40% (Manager shortage)', date: 'Täna 10:00' },\n    { id: '2', type: 'WARNING', message: 'Pärnu: High load on Manager \"Tiit Kask\" (>20 leads/day)', date: 'Eile 14:30' },\n    { id: '3', type: 'INFO', message: 'New Partner \"Karl Bilder\" onboarding incomplete', date: '14.01.2026' },\n];\n\nexport default function AdminDashboard() {\n    const [timeRange, setTimeRange] = useState<'7d' | '30d'>('30d');\n\n    return (\n        <div className=\"space-y-8\">\n\n            {/* KPI CARDS */}\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\n                <div className=\"bg-white p-6 rounded-2xl border border-slate-200 shadow-sm\">\n                    <div className=\"flex justify-between items-start mb-4\">\n                        <div className=\"p-3 bg-blue-50 text-blue-600 rounded-xl\">\n                            <BarChart3 size={24} />\n                        </div>\n                        <span className=\"text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded\">+12%</span>\n                    </div>\n                    <div className=\"text-3xl font-bold text-slate-900\">{KPI_STATS.totalRfqs30d}</div>\n                    <div className=\"text-sm text-slate-500\">Päringut (30 päeva)</div>\n                </div>\n\n                <div className=\"bg-white p-6 rounded-2xl border border-slate-200 shadow-sm\">\n                    <div className=\"flex justify-between items-start mb-4\">\n                        <div className=\"p-3 bg-emerald-50 text-emerald-600 rounded-xl\">\n                            <CheckCircle2 size={24} />\n                        </div>\n                    </div>\n                    <div className=\"text-3xl font-bold text-slate-900\">{KPI_STATS.assignedRate}%</div>\n                    <div className=\"text-sm text-slate-500\">Edukas suunamine</div>\n                </div>\n\n                <div className=\"bg-white p-6 rounded-2xl border border-slate-200 shadow-sm\">\n                    <div className=\"flex justify-between items-start mb-4\">\n                        <div className=\"p-3 bg-purple-50 text-purple-600 rounded-xl\">\n                            <Activity size={24} />\n                        </div>\n                    </div>\n                    <div className=\"text-3xl font-bold text-slate-900\">~{KPI_STATS.responseRateApprox}%</div>\n                    <div className=\"text-sm text-slate-500\">Hinnanguline vastamismäär</div>\n                </div>\n\n                <div className=\"bg-white p-6 rounded-2xl border border-slate-200 shadow-sm\">\n                    <div className=\"flex justify-between items-start mb-4\">\n                        <div className=\"p-3 bg-amber-50 text-amber-600 rounded-xl\">\n                            <Globe size={24} />\n                        </div>\n                        <span className=\"text-xs font-bold text-slate-500 bg-slate-100 px-2 py-1 rounded\">Eesti</span>\n                    </div>\n                    <div className=\"text-3xl font-bold text-slate-900\">{KPI_STATS.activeCities}</div>\n                    <div className=\"text-sm text-slate-500\">Aktiivset linna</div>\n                </div>\n            </div>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n\n                {/* LEFT COL: ALERTS & CITIES */}\n                <div className=\"lg:col-span-2 space-y-8\">\n\n                    {/* RED FLAGS */}\n                    <div className=\"bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden\">\n                        <div className=\"px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-red-50/50\">\n                            <h3 className=\"font-bold text-slate-800 flex items-center gap-2\">\n                                <ShieldAlert size={18} className=\"text-red-500\" />\n                                Kriitilised Teated (Red Flags)\n                            </h3>\n                        </div>\n                        <div className=\"divide-y divide-slate-100\">\n                            {ALERTS.map(alert => (\n                                <div key={alert.id} className=\"p-4 flex gap-4 items-start hover:bg-slate-50\">\n                                    <div className={`mt-1 p-1.5 rounded-full shrink-0 ${alert.type === 'CRITICAL' ? 'bg-red-100 text-red-600' :\n                                            alert.type === 'WARNING' ? 'bg-amber-100 text-amber-600' :\n                                                'bg-blue-100 text-blue-600'\n                                        }`}>\n                                        <AlertTriangle size={16} />\n                                    </div>\n                                    <div>\n                                        <div className=\"text-sm font-bold text-slate-900\">{alert.message}</div>\n                                        <div className=\"text-xs text-slate-400 flex items-center gap-1 mt-1\">\n                                            <Clock size={10} /> {alert.date}\n                                        </div>\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n\n                    {/* CITY PERFORMANCE */}\n                    <div className=\"bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden\">\n                        <div className=\"px-6 py-4 border-b border-slate-100 flex justify-between items-center\">\n                            <h3 className=\"font-bold text-slate-800 flex items-center gap-2\">\n                                <Globe size={18} className=\"text-slate-400\" />\n                                Linnade Tervis\n                            </h3>\n                        </div>\n                        <div className=\"overflow-x-auto\">\n                            <table className=\"w-full text-left text-sm\">\n                                <thead className=\"bg-slate-50 text-slate-500\">\n                                    <tr>\n                                        <th className=\"px-6 py-3 font-medium\">Linn</th>\n                                        <th className=\"px-6 py-3 font-medium\">RFQs (30p)</th>\n                                        <th className=\"px-6 py-3 font-medium\">Partnerid</th>\n                                        <th className=\"px-6 py-3 font-medium\">Müügijuhid</th>\n                                        <th className=\"px-6 py-3 font-medium text-right\">Fallback %</th>\n                                        <th className=\"px-6 py-3 font-medium text-right\">Staatus</th>\n                                    </tr>\n                                </thead>\n                                <tbody className=\"divide-y divide-slate-100\">\n                                    {CITY_STATS.map(city => (\n                                        <tr key={city.name} className=\"hover:bg-slate-50\">\n                                            <td className=\"px-6 py-4 font-bold text-slate-900\">{city.name}</td>\n                                            <td className=\"px-6 py-4 text-slate-600\">{city.rfqCount}</td>\n                                            <td className=\"px-6 py-4 text-slate-600\">{city.partnersActive}</td>\n                                            <td className=\"px-6 py-4 text-slate-600\">{city.managersActive}</td>\n                                            <td className={`px-6 py-4 text-right font-mono ${city.fallbackRate > 20 ? 'text-red-600 font-bold' : 'text-slate-500'\n                                                }`}>{city.fallbackRate}%</td>\n                                            <td className=\"px-6 py-4 text-right\">\n                                                <span className={`inline-block w-3 h-3 rounded-full ${city.health === 'GOOD' ? 'bg-emerald-500' :\n                                                        city.health === 'WARNING' ? 'bg-amber-500' : 'bg-red-500 animate-pulse'\n                                                    }`}></span>\n                                            </td>\n                                        </tr>\n                                    ))}\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>\n                </div>\n\n                {/* RIGHT COL: PARTNERS */}\n                <div className=\"space-y-8\">\n                    <div className=\"bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden\">\n                        <div className=\"px-6 py-4 border-b border-slate-100\">\n                            <h3 className=\"font-bold text-slate-800 flex items-center gap-2\">\n                                <Building2 size={18} className=\"text-slate-400\" />\n                                Partnerite Edetabel\n                            </h3>\n                        </div>\n                        <div className=\"divide-y divide-slate-100\">\n                            {PARTNER_STATS.map((partner, idx) => (\n                                <div key={partner.name} className=\"p-6 hover:bg-slate-50 transition-colors\">\n                                    <div className=\"flex justify-between items-start mb-2\">\n                                        <div>\n                                            <div className=\"font-bold text-slate-900 text-lg flex items-center gap-2\">\n                                                <span className=\"text-slate-400 font-normal text-xs\">#{idx + 1}</span>\n                                                {partner.name}\n                                            </div>\n                                            <div className=\"text-xs text-slate-500 mt-1\">\n                                                {partner.cityCoverage} linna • {partner.managerCount} müügijuhti\n                                            </div>\n                                        </div>\n                                        <div className={`text-xl font-black ${partner.healthScore >= 90 ? 'text-emerald-500' : 'text-amber-500'\n                                            }`}>\n                                            {partner.healthScore}\n                                        </div>\n                                    </div>\n\n                                    <div className=\"flex justify-between items-end mt-4\">\n                                        <div className=\"text-xs text-slate-400\">\n                                            Viimati: {partner.lastActivity}\n                                        </div>\n                                        <div className=\"text-sm font-bold text-slate-700\">\n                                            {partner.rfqReceived} <span className=\"text-slate-400 font-normal text-xs\">päringut</span>\n                                        </div>\n                                    </div>\n\n                                    {/* Mini Activity Bar */}\n                                    <div className=\"w-full bg-slate-100 h-1.5 rounded-full mt-3 overflow-hidden\">\n                                        <div\n                                            className=\"bg-slate-800 h-full rounded-full\"\n                                            style={{ width: `${(partner.rfqReceived / 250) * 100}%` }}\n                                        ></div>\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/admin/analytics/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/admin/analytics/reasons/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used. Allowed unused args must match /^_/u.","line":5,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextRequest} from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { createClient } from \"@supabase/supabase-js\";\n\nexport async function GET(req: NextRequest) {\n    const supabaseAdmin = createClient(\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\n        process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    // Check permissions if needed (skipping for now as per instructions \"simple aggregate\")\n    // In real app, verify admin session\n\n    // Count per reason_code\n    const { data, error } = await supabaseAdmin\n        .from('shipments')\n        .select('status_reason_code, store_id')\n        .not('status_reason_code', 'is', null);\n\n    if (error) {\n        return NextResponse.json({ error: error.message }, { status: 500 });\n    }\n\n    const simpleCounts: Record<string, number> = {};\n    const storeCounts: Record<string, Record<string, number>> = {};\n\n    data.forEach(row => {\n        const code = row.status_reason_code;\n        const store = row.store_id || 'unknown';\n\n        if (code) {\n            // Total\n            simpleCounts[code] = (simpleCounts[code] || 0) + 1;\n\n            // Per Store\n            if (!storeCounts[store]) storeCounts[store] = {};\n            storeCounts[store][code] = (storeCounts[store][code] || 0) + 1;\n        }\n    });\n\n    return NextResponse.json({\n        total: simpleCounts,\n        by_store: storeCounts\n    });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/analytics/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/contact/partners/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/contact/support/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/cron/keepalive/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'authHeader' is assigned a value but never used.","line":9,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1648,1651],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1648,1651],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextRequest } from 'next/server';\nimport { NextResponse } from 'next/server';\nimport { createClient } from '@supabase/supabase-js';\n\nexport const dynamic = 'force-dynamic';\n\nexport async function GET(req: NextRequest) {\n    // 1. Verify caller (Vercel Cron or Secret)\n    const authHeader = req.headers.get('authorization');\n    const cronHeader = req.headers.get('x-vercel-cron');\n    const { searchParams } = new URL(req.url);\n    const secret = searchParams.get('secret');\n\n    const isValidCron = cronHeader === '1';\n    const isValidSecret = secret === process.env.CRON_SECRET;\n\n    if (!isValidCron && !isValidSecret) {\n        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // 2. Refresh Supabase\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\n    if (!supabaseUrl || !supabaseServiceKey) {\n        return NextResponse.json({ error: 'Missing Supabase credentials' }, { status: 500 });\n    }\n\n    try {\n        const supabase = createClient(supabaseUrl, supabaseServiceKey, {\n            auth: {\n                persistSession: false,\n                autoRefreshToken: false,\n            }\n        });\n\n        const { data, error } = await supabase.rpc('keepalive_ping');\n\n        if (error) {\n            console.error('Supabase KeepAlive Error:', error);\n            return NextResponse.json({ ok: false, error: error.message }, { status: 500 });\n        }\n\n        return NextResponse.json({\n            ok: true,\n            ts: new Date().toISOString(),\n            data\n        });\n\n    } catch (err: any) {\n        console.error('Cron Job Failed:', err);\n        return NextResponse.json({ ok: false, error: err.message }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/cron/refresh/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/delivery/wolt/profile/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'WoltConfig' is defined but never used.","line":2,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":46,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"WoltConfig"},"fix":{"range":[77,89],"text":""},"desc":"Remove unused variable \"WoltConfig\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[826,829],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[826,829],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { checkDeliveryEligibility, WoltConfig, WOLT_CONFIG } from '@/app/lib/wolt';\n\nexport async function POST(request: Request) {\n    try {\n        const body = await request.json();\n        const { items, city } = body;\n\n        if (!items || !Array.isArray(items)) {\n            return NextResponse.json({ error: \"Invalid items\" }, { status: 400 });\n        }\n\n        if (!city) {\n            return NextResponse.json({ error: \"City required\" }, { status: 400 });\n        }\n\n        // Use shared logic\n        const eligibility = checkDeliveryEligibility(items, city);\n\n        return NextResponse.json({\n            eligibility,\n            config: {\n                isDemo: WOLT_CONFIG.isDemo,\n                env: WOLT_CONFIG.env\n            }\n        });\n\n    } catch (e: any) {\n        return NextResponse.json({ error: e.message }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/notifications/send-email/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'locale' is assigned a value but never used.","line":15,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1328,1331],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1328,1331],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fromEmail' is assigned a value but never used.","line":51,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":51,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3129,3132],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3129,3132],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport type { NextRequest} from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { createClient } from \"@supabase/supabase-js\";\n// import { Resend } from 'resend'; // Assumption: user might have it or not. Code defensively.\n\n// const resend = new Resend(process.env.RESEND_API_KEY);\n\nexport async function POST(req: NextRequest) {\n    // 1. Validate Secret or Session? \n    // Since this is internal, maybe just rely on being called? \n    // Ideally this should be protected. \n    // authenticating the service role client logic effectively.\n\n    const { notificationId, locale } = await req.json();\n\n    if (!notificationId) return NextResponse.json({ error: \"Missing ID\" }, { status: 400 });\n\n    const supabase = createClient(\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\n        process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n\n    // 2. Get Notification Data\n    const { data: notif } = await supabase\n        .from('notifications')\n        .select('*, user:user_id(email)') // Get user email if possible via join or separate call\n        .eq('id', notificationId)\n        .single();\n\n    if (!notif) return NextResponse.json({ error: \"Not found\" }, { status: 404 });\n\n    // Ensure we have user email. If foreign key doesn't get it (auth users tricky), fetch via auth admin\n    let userEmail = (notif as any).user?.email;\n\n    if (!userEmail) {\n        const { data: userData } = await supabase.auth.admin.getUserById(notif.user_id);\n        userEmail = userData.user?.email;\n    }\n\n    if (!userEmail) {\n        await supabase.from('notification_events')\n            .update({ status: 'failed', error: 'No user email found' })\n            .eq('notification_id', notificationId)\n            .eq('channel', 'email');\n        return NextResponse.json({ error: \"No email\" }, { status: 400 });\n    }\n\n    // 3. Send Email (Mock or Real)\n    const apiKey = process.env.RESEND_API_KEY || process.env.SENDGRID_API_KEY;\n    const fromEmail = process.env.EMAIL_FROM || 'SmartBuild <noreply@smartbuild.ee>';\n\n    if (!apiKey) {\n        console.warn(\"No Email API Key found. Skipping email send.\");\n        // Mark as failed/skipped\n        await supabase.from('notification_events')\n            .update({ status: 'failed', error: 'Missing API Keys' })\n            .eq('notification_id', notificationId)\n            .eq('channel', 'email');\n\n        return NextResponse.json({ message: \"Skipped (No Keys)\" });\n    }\n\n    try {\n        // Example implementation for Resend\n        /*\n        await resend.emails.send({\n            from: fromEmail,\n            to: userEmail,\n            subject: `SmartBuild Update: ${notif.type}`,\n            html: `<p>Notification content here based on keys...</p>`\n        });\n        */\n\n        // For now, assume success mock\n        console.log(`[MOCK EMAIL] To: ${userEmail}, Subject: ${notif.title_key}`);\n\n        await supabase.from('notification_events')\n            .update({ status: 'sent', provider: 'mock' })\n            .eq('notification_id', notificationId)\n            .eq('channel', 'email');\n\n        return NextResponse.json({ success: true });\n    } catch (e: any) {\n        console.error(\"Email send failed\", e);\n        await supabase.from('notification_events')\n            .update({ status: 'failed', error: e.message })\n            .eq('notification_id', notificationId)\n            .eq('channel', 'email');\n        return NextResponse.json({ error: e.message }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/orders/create/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'shipmentsToCreate' is assigned a value but never used.","line":60,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":60,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2700,2703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2700,2703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2896,2899],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2896,2899],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3354,3357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3354,3357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3393,3396],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3393,3396],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5191,5194],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5191,5194],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":141,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6084,6087],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6084,6087],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextRequest} from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { createClient } from \"@supabase/supabase-js\";\n\n// Use Service Role for safe DB writes (bypassing RLS for creation if needed, or ensuring strict ownership)\n// Actually, for inserting user order, standard Authenticated client is safer for RLS.\n// BUT, creating complex nested relations (Order -> Items -> Shipments) often runs into RLS issues \n// if policies are not perfect for \"insert related\".\n// Plan: Verify user auth via header, then use ADMIN client to do the transactional write, \n// ensuring we force `user_id` to be the authenticated user's ID.\n\n// Lazy init inside handler to prevent build errors\nconst getSupabaseAdmin = () => createClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!\n);\n\nexport async function POST(req: NextRequest) {\n    try {\n        const body = await req.json();\n        const { items, totals, delivery, userDetails } = body;\n        // items: { id, productId, name, price, quantity, ... }[]\n        // totals: { subtotal, delivery, total }\n        // delivery: { method: 'wolt'|'pickup', split?: boolean, woltItems: [], otherItems: [] }\n        // userDetails: { city, address, phone, notes }\n\n        // 1. Auth Check\n        const authHeader = req.headers.get(\"Authorization\");\n        if (!authHeader) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n        const token = authHeader.replace(\"Bearer \", \"\");\n        const supabaseAdmin = getSupabaseAdmin();\n        const { data: { user }, error: authError } = await supabaseAdmin.auth.getUser(token);\n        if (authError || !user) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n\n        // 2. Validate inputs (basic)\n        if (!items || items.length === 0) return NextResponse.json({ error: \"Empty cart\" }, { status: 400 });\n\n        // 3. Create Order\n        const { data: order, error: orderError } = await supabaseAdmin\n            .from(\"orders\")\n            .insert({\n                user_id: user.id,\n                status: \"submitted\",\n                payment_status: \"unpaid\",\n                subtotal: totals.subtotal,\n                delivery_fee: totals.delivery,\n                total: totals.total,\n                city: userDetails.city,\n                address_line: userDetails.address,\n                phone: userDetails.phone,\n                notes: userDetails.notes\n            })\n            .select(\"id\")\n            .single();\n\n        if (orderError) throw orderError;\n\n        // 4. Create Shipments\n        // Logic: If partial split, create 2 shipments. Else 1.\n        const shipmentsToCreate: any[] = [];\n\n        const isSplit = delivery.split === true;\n\n        // Helper to format shipment\n        const createShipmentObj = (type: string, fee: number, status: string, itemsForShipment: any[]) => ({\n            order_id: order.id,\n            type,\n            status, // 'pending' or 'preparing'\n            city: userDetails.city,\n            address_line: userDetails.address,\n            fee,\n            eta_minutes: type === 'wolt' ? 45 : undefined, // Mock ETA\n            items: itemsForShipment\n        });\n\n        let shipmentWoltId: string | null = null;\n        let shipmentOtherId: string | null = null;\n        let shipmentWolt: any = null;\n        let shipmentOther: any = null;\n\n        if (isSplit) {\n            // Shipment 1: Wolt\n            shipmentWolt = await supabaseAdmin.from(\"shipments\").insert({\n                ...createShipmentObj('wolt', delivery.woltFee || 0, 'pending', []),\n                provider: 'wolt'\n            }).select(\"id\").single();\n            if (shipmentWolt.error) throw shipmentWolt.error;\n            shipmentWoltId = shipmentWolt.data.id;\n\n            // Shipment 2: Store/Pickup\n            // If user originally wanted Wolt but got split, the rest is Pickup usually? \n            // Or Store Delivery if configured. Let's assume Pickup for MVP fallback or Store Delivery if \"Partial Delivery\" implies store brings it.\n            // Requirement says: \"if partial split — create 2 shipments (wolt + store/pickup)\"\n            // Let's assume 'pickup' for the heavy stuff if not specified.\n            const secondaryType = delivery.secondaryMethod || 'pickup';\n            shipmentOther = await supabaseAdmin.from(\"shipments\").insert({\n                ...createShipmentObj(secondaryType, 0, 'pending', [])\n            }).select(\"id\").single();\n            if (shipmentOther.error) throw shipmentOther.error;\n            shipmentOtherId = shipmentOther.data.id;\n\n        } else {\n            // Single Shipment\n            shipmentOther = await supabaseAdmin.from(\"shipments\").insert({\n                ...createShipmentObj(delivery.method, totals.delivery, 'pending', []),\n                provider: delivery.method === 'wolt' ? 'wolt' : null\n            }).select(\"id\").single();\n            if (shipmentOther.error) throw shipmentOther.error;\n            shipmentOtherId = shipmentOther.data.id;\n        }\n\n        // 5. Create Order Items\n        // We need to map items to shipment IDs\n        const dbItems = items.map((i: any) => {\n            let shipment_id = shipmentOtherId;\n\n            // If split, check if this item is in woltItems list\n            if (isSplit && delivery.woltItems?.includes(i.id)) {\n                shipment_id = shipmentWoltId;\n            }\n\n            return {\n                order_id: order.id,\n                product_id: i.productId || i.id, // Fallback\n                name: i.name,\n                brand: i.brand,\n                qty: i.quantity,\n                unit: i.unit,\n                price: i.price,\n                line_total: i.price * i.quantity,\n                image_url: i.image,\n                shipment_id\n            };\n        });\n\n        const { error: itemsError } = await supabaseAdmin.from(\"order_items\").insert(dbItems);\n        if (itemsError) throw itemsError;\n\n        return NextResponse.json({ success: true, orderId: order.id });\n\n    } catch (e: any) {\n        console.error(\"Order create error\", e);\n        return NextResponse.json({ error: e.message }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/partner/import/apply/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1796,1799],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1796,1799],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1902,1905],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1902,1905],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2022,2025],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2022,2025],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5143,5146],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5143,5146],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextRequest} from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { createClient } from \"@supabase/supabase-js\";\nimport Papa from \"papaparse\";\n\n// Lazy init inside handler to prevent build errors\nconst getSupabaseAdmin = () => createClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!\n);\n\nexport async function POST(req: NextRequest) {\n    try {\n        const body = await req.json();\n        const { importId } = body;\n        const authHeader = req.headers.get(\"Authorization\");\n\n        if (!authHeader) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n        const token = authHeader.replace(\"Bearer \", \"\");\n        const supabaseAdmin = getSupabaseAdmin();\n        const { data: { user } } = await supabaseAdmin.auth.getUser(token);\n        if (!user) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n\n        // Get Import Record\n        const { data: importJob } = await supabaseAdmin.from(\"imports\").select(\"*\").eq(\"id\", importId).single();\n        if (!importJob) return NextResponse.json({ error: \"Import not found\" }, { status: 404 });\n\n        // Verify Access\n        const { data: membership } = await supabaseAdmin.from(\"store_users\").select(\"*\").eq(\"user_id\", user.id).eq(\"store_id\", importJob.store_id).single();\n        if (!membership) return NextResponse.json({ error: \"Access denied\" }, { status: 403 });\n\n        if (importJob.status === \"applied\") return NextResponse.json({ message: \"Already applied\" });\n\n        // Parse & Apply\n        const fileContent = importJob.file_content;\n        const mapping = importJob.mapping_json;\n        const parsed = Papa.parse(fileContent, { header: true, skipEmptyLines: true });\n        const rows = parsed.data as any[];\n\n        const created = 0;\n        let updated = 0;\n        let failed = 0;\n        const errors: any[] = [];\n\n        for (let i = 0; i < rows.length; i++) {\n            const row = rows[i];\n            const mapped: any = {};\n\n            for (const [dbField, csvHeader] of Object.entries(mapping)) {\n                if (csvHeader) {\n                    let val = row[csvHeader as string];\n\n                    // Formatting\n                    if (dbField === 'price') {\n                        val = val ? parseFloat(String(val).replace(\",\", \".\")) : 0;\n                        if (isNaN(val)) val = 0;\n                    }\n                    if (dbField === 'weight_kg' || dbField.endsWith('_cm')) {\n                        val = val ? parseFloat(String(val).replace(\",\", \".\")) : null;\n                    }\n                    if (dbField === 'delivery_allowed_wolt' || dbField === 'hazmat') {\n                        val = (String(val).toLowerCase() === 'true' || String(val) === '1' || String(val).toLowerCase() === 'yes');\n                    }\n\n                    mapped[dbField] = val;\n                }\n            }\n\n            // LOGIC: Upsert by SKU or EAN\n            // We need at least SKU or EAN or Name to exist?\n            // If SKU exists, upsert on (store_id, sku).\n\n            // Mandatory checks\n            if (!mapped.sku && !mapped.ean) {\n                failed++;\n                errors.push({ row: i + 1, error: \"Missing SKU and EAN\" });\n                continue;\n            }\n            if (!mapped.price) {\n                // Or maybe allow price 0? Warning maybe.\n            }\n            if (!mapped.name_override_et) {\n                // Try to fallback to 'name' column if user mapped 'name' to it?\n                // In schema it is name_override_et.\n                if (row['name']) mapped.name_override_et = row['name']; // Fallback explicit\n            }\n\n            // Calc missing dimensions\n            const hasWeight = mapped.weight_kg !== null && mapped.weight_kg > 0;\n            const hasDims = mapped.length_cm && mapped.width_cm && mapped.height_cm;\n            mapped.missing_dimensions = (!hasWeight || !hasDims);\n\n            // Defaults\n            mapped.store_id = importJob.store_id;\n\n            // UPSERT\n            // We'll try to match by SKU\n            if (mapped.sku) {\n                const { error } = await supabaseAdmin.from(\"store_products\").upsert(mapped, { onConflict: 'store_id, sku' });\n                if (error) { failed++; errors.push({ row: i + 1, error: error.message }); }\n                else updated++; // Simplified count\n            } else if (mapped.ean) {\n                const { error } = await supabaseAdmin.from(\"store_products\").upsert(mapped, { onConflict: 'store_id, ean' });\n                if (error) { failed++; errors.push({ row: i + 1, error: error.message }); }\n                else updated++;\n            }\n        }\n\n        // Finish\n        await supabaseAdmin.from(\"imports\").update({\n            status: \"applied\",\n            summary_json: { total_rows: rows.length, created_count: created, updated_count: updated, error_rows: failed },\n            errors_json: errors.slice(0, 100) // Limit size\n        }).eq(\"id\", importId);\n\n        return NextResponse.json({ success: true, created, updated, failed });\n\n    } catch (e: any) {\n        return NextResponse.json({ error: e.message }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/partner/import/preview/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1901,1904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1901,1904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1935,1938],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1935,1938],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1969,1972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1969,1972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2181,2184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2181,2184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":74,"column":39,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":74,"endColumn":47},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4028,4031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4028,4031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextRequest} from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { createClient } from \"@supabase/supabase-js\";\nimport Papa from \"papaparse\";\n\n// Lazy init inside handler to prevent build errors\nconst getSupabaseAdmin = () => createClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!\n);\n\nexport async function POST(req: NextRequest) {\n    try {\n        const body = await req.json();\n        const { importId, mapping } = body; // mapping: { \"sku\": \"CSV Col 1\", \"price\": \"CSV Col 2\" }\n        const authHeader = req.headers.get(\"Authorization\");\n\n        if (!authHeader) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n        const token = authHeader.replace(\"Bearer \", \"\");\n        const supabaseAdmin = getSupabaseAdmin();\n        const { data: { user } } = await supabaseAdmin.auth.getUser(token);\n        if (!user) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n\n        // Get Import Record\n        const { data: importJob } = await supabaseAdmin.from(\"imports\").select(\"*\").eq(\"id\", importId).single();\n        if (!importJob) return NextResponse.json({ error: \"Import not found\" }, { status: 404 });\n\n        // Verify Access\n        const { data: membership } = await supabaseAdmin.from(\"store_users\").select(\"*\").eq(\"user_id\", user.id).eq(\"store_id\", importJob.store_id).single();\n        if (!membership) return NextResponse.json({ error: \"Access denied\" }, { status: 403 });\n\n        // Parse CSV\n        const fileContent = importJob.file_content;\n        const parsed = Papa.parse(fileContent, { header: true, skipEmptyLines: true });\n\n        if (parsed.errors.length > 0 && parsed.data.length === 0) {\n            return NextResponse.json({ error: \"CSV Parse Error: \" + parsed.errors[0].message }, { status: 400 });\n        }\n\n        const rows = parsed.data as any[];\n        const previewRows: any[] = [];\n        const errors: any[] = [];\n        let validCount = 0;\n\n        // Limit preview to 10 rows\n        const limit = 50;\n\n        rows.slice(0, limit).forEach((row, idx) => {\n            // Apply Mapping\n            const mapped: any = {};\n            let hasError = false;\n            let errorMsg = \"\";\n\n            // Mapping keys: name_override_et, brand, sku, price, etc.\n            // mapping values: CSV header name\n            for (const [dbField, csvHeader] of Object.entries(mapping)) {\n                if (csvHeader) {\n                    mapped[dbField] = row[csvHeader as string];\n                }\n            }\n\n            // Validation (Basic)\n            if (!mapped.name_override_et && !mapped.name) {\n                // If user didn't map a Name field\n                // warning\n            }\n            if (!mapped.price) {\n                // Warning\n            }\n\n            // Format Price\n            if (mapped.price) {\n                const p = parseFloat(mapped.price.replace(\",\", \".\"));\n                if (isNaN(p)) { type: \"error\"; errorMsg = \"Invalid Price\"; hasError = true; }\n                else mapped.price = p;\n            }\n\n            if (!hasError) validCount++;\n            else errors.push({ row: idx + 1, error: errorMsg, data: row });\n\n            if (previewRows.length < 5) previewRows.push(mapped);\n        });\n\n        // Update Import Job with mapping\n        await supabaseAdmin.from(\"imports\").update({\n            mapping_json: mapping,\n            status: \"previewed\",\n            summary_json: { total_rows: rows.length, valid_rows: validCount, error_rows: errors.length }\n        }).eq(\"id\", importId);\n\n        return NextResponse.json({\n            preview: previewRows,\n            totalRows: rows.length,\n            validRows: validCount, // Mock for full file? No, just slice.\n            // Actually for preview we want full stats? \n            // Let's assume Valid Count for the slice for now to be fast. \n            // Or better: validCount is for the slice. User understands.\n        });\n\n    } catch (e: any) {\n        return NextResponse.json({ error: e.message }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/partner/import/upload/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3546,3549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3546,3549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextRequest} from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { createClient } from \"@supabase/supabase-js\";\n\n// Use Service Role for Admin/Backend ops as requested\n// Lazy init inside handler to prevent build errors\nconst getSupabaseAdmin = () => createClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!\n);\n\nexport async function POST(req: NextRequest) {\n    try {\n        // 1. Auth Check (Manually verify user from header or cookie? \n        // Better: use standard Next.js auth helper to get user, then use Admin for DB ops if needed, \n        // or just use the user client if RLS is set up.\n        // Prompt said: \"Use SUPABASE_SERVICE_ROLE_KEY (only there)\".\n        // I'll user standard user fetching to identify, then admin to write if needed (or RLS).\n        // If I use Admin, I must verify permissions.\n\n        // Actually, let's try to trust RLS + User Context first? \n        // No, standard `createServerClient` from `@supabase/ssr` is best for RLS.\n        // But I don't have `@supabase/ssr` configured in `package.json` (I saw `supabase-js`).\n        // I'll stick to manual token verification or just assume the user sends an auth token?\n        // Native Next.js `req.cookies` + `getUser` is safer.\n\n        // Let's use the project's pattern.\n        // I will use `supabaseAdmin` but I need the USER ID to verify access.\n\n        // For MVP speed and hitting the requirement \"use SERVICE_ROLE\", I will do:\n        // 1. Parse request body (FormData)\n        // 2. Get user_id (Mocked or passed? No, must be secure)\n        // CHECK: Does `supabaseClient.ts` have a server helper? No.\n\n        // OK, I'll assume the client sends the session access_token in Authorization header.\n        const authHeader = req.headers.get(\"Authorization\");\n        if (!authHeader) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n\n        const token = authHeader.replace(\"Bearer \", \"\");\n        const supabaseAdmin = getSupabaseAdmin();\n        const { data: { user }, error: authError } = await supabaseAdmin.auth.getUser(token);\n\n        if (authError || !user) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n\n        // 2. Parse Form\n        const formData = await req.formData();\n        const file = formData.get(\"file\") as File;\n        const storeId = formData.get(\"storeId\") as string;\n\n        if (!file || !storeId) return NextResponse.json({ error: \"Missing file or storeId\" }, { status: 400 });\n\n        // 3. Verify Access\n        const { data: membership } = await supabaseAdmin\n            .from(\"store_users\")\n            .select(\"role\")\n            .eq(\"user_id\", user.id)\n            .eq(\"store_id\", storeId)\n            .single();\n\n        if (!membership) return NextResponse.json({ error: \"Access denied to this store\" }, { status: 403 });\n\n        // 4. Read File Content\n        const text = await file.text();\n\n        // 5. Save to Imports table\n        const { data, error } = await supabaseAdmin\n            .from(\"imports\")\n            .insert({\n                store_id: storeId,\n                status: \"uploaded\",\n                file_name: file.name,\n                file_content: text, // Saving raw content\n                mapping_json: {},\n                summary_json: {},\n                errors_json: []\n            })\n            .select(\"id\")\n            .single();\n\n        if (error) throw error;\n\n        return NextResponse.json({ importId: data.id });\n    } catch (e: any) {\n        console.error(\"Upload error\", e);\n        return NextResponse.json({ error: e.message }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/products/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/rfq/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Resend' is defined but never used.","line":2,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":16,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Resend"},"fix":{"range":[44,76],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1192,1195],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1192,1195],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\nimport { Resend } from \"resend\";\n\n// const resend = new Resend(process.env.RESEND_API_KEY); \n// NOTE: Since I don't have the user's API key, I will mock the success but simulate the logic.\n// If the user adds API key later, they can uncomment.\n\nexport async function POST(request: Request) {\n    try {\n        const body = await request.json();\n        const { name, email, phone, city, company, notes, cartItems } = body;\n\n        // Validate\n        if (!name || !email || !city || !cartItems || cartItems.length === 0) {\n            return NextResponse.json({ error: \"Missing required fields\" }, { status: 400 });\n        }\n\n        // 1. Determine recipients based on city\n        // Mock addresses for demo\n        const recipients = [\n            `espak.${city.toLowerCase()}@example.com`,\n            `bauhof.${city.toLowerCase()}@example.com`,\n            `krauta.${city.toLowerCase()}@example.com`\n        ];\n\n        console.log(`[RFQ] Processing request for ${city}`);\n        console.log(`[RFQ] Recipients: ${recipients.join(\", \")}`);\n\n        // 2. Generate Email Content (Simple Text/HTML)\n        const itemsList = cartItems.map((i: any) => `- ${i.name}: ${i.qty} ${i.unit || 'tk'}`).join(\"\\n\");\n\n        const emailContent = `\n      Uus hinnapäring saidilt SmartBuild!\n      \n      Klient: ${name}\n      Ettevõte: ${company || \"-\"}\n      E-post: ${email}\n      Telefon: ${phone}\n      Linn: ${city}\n      Lisainfo: ${notes || \"-\"}\n      \n      Soovitud tooted:\n      ${itemsList}\n      \n      Palun vastake otse kliendile aadressil ${email}.\n    `;\n\n        console.log(\"[RFQ] Email Content Logic Prepared:\\n\", emailContent);\n\n        // 3. Send Email (Mocking Resend for now to ensure no crash without key)\n        // await resend.emails.send({\n        //   from: 'SmartBuild <onboarding@resend.dev>',\n        //   to: recipients,\n        //   subject: `Hinnapäring: ${name} - ${city}`,\n        //   text: emailContent,\n        // });\n\n        // Simulate delay\n        await new Promise(r => setTimeout(r, 1000));\n\n        return NextResponse.json({ success: true });\n    } catch (error) {\n        console.error(\"RFQ Error:\", error);\n        return NextResponse.json({ error: \"Internal Server Error\" }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/rfq/send/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CONTACTS_BY_CITY' is defined but never used.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":26,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CONTACTS_BY_CITY"},"fix":{"range":[147,164],"text":""},"desc":"Remove unused variable \"CONTACTS_BY_CITY\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CityName' is defined but never used.","line":4,"column":46,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":54,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CityName"},"fix":{"range":[181,191],"text":""},"desc":"Remove unused variable \"CityName\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\nimport nodemailer from \"nodemailer\";\nimport type { StoreName} from \"@/app/lib/storeContacts\";\nimport { CONTACTS_BY_CITY, DEFAULT_CONTACTS, CityName } from \"@/app/lib/storeContacts\";\nimport { routeRFQ } from \"@/app/lib/routingEngine\";\nimport { PARTNERS } from \"@/app/lib/partners\";\n\n// Rate Limiting (In-Memory)\nconst RATE_LIMIT_WINDOW = 60 * 1000; // 1 minute\nconst requestLog = new Map<string, number>();\n\nfunction getIp(req: Request) {\n    const forwarded = req.headers.get(\"x-forwarded-for\");\n    return forwarded ? forwarded.split(\",\")[0] : \"127.0.0.1\";\n}\n\nexport async function POST(request: Request) {\n    try {\n        const ip = getIp(request);\n        const now = Date.now();\n\n        // 1. Rate Limiting\n        const lastRequest = requestLog.get(ip) || 0;\n        if (now - lastRequest < RATE_LIMIT_WINDOW) {\n            return NextResponse.json({ error: \"Palun oodake 1 minut enne uue päringu saatmist.\" }, { status: 429 });\n        }\n        requestLog.set(ip, now);\n\n        // 2. Parse Body\n        const body = await request.json();\n        const {\n            name,\n            email,\n            phone,\n            city,\n            selectedStores,\n            cartItems,\n            consent,\n            notes,\n            customerType // [NEW] Soft segmentation\n        } = body;\n\n        // Map customerType to readable text\n        const customerTypeLabel = {\n            'private': 'Eraisik',\n            'builder': 'Ehitaja',\n            'company': 'Ettevõte'\n        }[customerType as string] || 'Määramata';\n\n        // 3. Validation\n        if (!email || !city || !cartItems || cartItems.length === 0 || !selectedStores || selectedStores.length === 0) {\n            return NextResponse.json({ error: \"Palun täitke kohustuslikud väljad.\" }, { status: 400 });\n        }\n        if (!consent) {\n            return NextResponse.json({ error: \"Palun kinnitage nõusolek andmete edastamiseks.\" }, { status: 400 });\n        }\n\n        // 4. Nodemailer Transporter\n        const transporter = nodemailer.createTransport({\n            host: process.env.SMTP_HOST || \"smtp.example.com\",\n            port: Number(process.env.SMTP_PORT) || 587,\n            secure: process.env.SMTP_SECURE === \"true\",\n            auth: {\n                user: process.env.SMTP_USER || \"user\",\n                pass: process.env.SMTP_PASS || \"pass\",\n            },\n        });\n\n        // 5. Generate Email Content\n        const productRows = cartItems.map((item: { name: string; qty: number; unit?: string }) => {\n            return `- ${item.name}: ${item.qty} ${item.unit || 'tk'}`;\n        }).join(\"\\n\");\n\n\n\n        // 6. Send to selected stores (B2B)\n        const sentTo: string[] = [];\n        const errors: string[] = [];\n\n        // Prepare User Email Content\n        const userEmailSubject = `Sinu hinnapäring on saadetud - SmartBuild`;\n        const userEmailBody = `Tere, ${name || \"klient\"}!\n\nSinu hinnapäring on edukalt edastatud.\nOled valinud järgmised poed: ${selectedStores.join(\", \")}.\n\nPäringu sisu:\n${productRows}\n\nLinn: ${city}\n\nPoed vaatavad päringu üle ja vastavad sulle otse e-posti teel (${email}) tavaliselt 24h jooksul.\n\nEdukaid oste soovides,\nSmartBuild Eesti meeskond`;\n\n        // Check if SMTP is configured (simple check)\n        const isSmtpConfigured = process.env.SMTP_HOST && process.env.SMTP_USER;\n\n        console.log(`[RFQ] Processing for City: ${city}, Stores: ${selectedStores.join(\", \")}`);\n\n        // --- A. SEND TO USER (Confirmation) ---\n        if (!isSmtpConfigured) {\n            console.log(`[EMAIL][DRY RUN] ---------------------------------------------------`);\n            console.log(`[EMAIL][DRY RUN] To USER: ${email}`);\n            console.log(`[EMAIL][DRY RUN] Subject: ${userEmailSubject}`);\n            console.log(`[EMAIL][DRY RUN] Body: \\n${userEmailBody}`);\n            console.log(`[EMAIL][DRY RUN] ---------------------------------------------------`);\n        } else {\n            try {\n                await transporter.sendMail({\n                    from: process.env.SMTP_FROM || '\"SmartBuild\" <noreply@smartbuild.ee>',\n                    to: email,\n                    subject: userEmailSubject,\n                    text: userEmailBody,\n                });\n                console.log(`[Email] Confirmation sent to user ${email}`);\n            } catch (err) {\n                console.error(`[Email Error] Failed to send confirmation to user:`, err);\n                // We don't fail the whole request if user email fails, but it's bad.\n            }\n        }\n\n        // --- B. SEND TO STORES (B2B) ---\n        for (const storeName of selectedStores) {\n\n            // NEW: Routing Engine\n            const routingResult = routeRFQ(city, storeName);\n\n            let storeEmail = routingResult?.destinationEmail;\n            const recipientName = routingResult?.targetName || storeName;\n\n            // Fallback (Final Safety Net)\n            if (!storeEmail) {\n                console.warn(`[RFQ] Routing failed for ${storeName} in ${city}. Using global default.`);\n                storeEmail = DEFAULT_CONTACTS[storeName as StoreName];\n            }\n\n            if (!storeEmail) {\n                console.warn(`[RFQ] CRITICAL: No email found for ${storeName}. Skipping.`);\n                errors.push(storeName);\n                continue;\n            }\n\n            console.log(`[RFQ] Dispatching to ${recipientName} (${storeEmail})`);\n\n            // PARTNER LOGIC (Paid Leads)\n            const partnerConfig = PARTNERS[storeName as StoreName];\n            const isPaidLead = partnerConfig?.leadType === \"paid\";\n            const baseLeadPrice = partnerConfig?.leadPrice || 0;\n\n            // Volume Logic (Lead Qualification)\n            const itemCount = cartItems.length;\n            let volumeTag = \"[SMALL]\";\n            let volumeMultiplier = 1.0;\n\n            if (itemCount >= 20) {\n                volumeTag = \"[LARGE]\";\n                volumeMultiplier = 1.5; // Large orders are worth more\n            } else if (itemCount >= 5) {\n                volumeTag = \"[MEDIUM]\";\n                volumeMultiplier = 1.2;\n            }\n\n            // Calculate Estimated Revenue\n            const leadValue = isPaidLead ? (baseLeadPrice * volumeMultiplier) : 0;\n            const leadTag = isPaidLead ? \"[LEAD][PAID]\" : \"[LEAD][FREE]\";\n\n            // Log full qualification and revenue\n            // [REVENUE] tag is important for internal analytics (grep)\n            console.info(`${leadTag}${volumeTag} Store: ${storeName}, City: ${city}, Items: ${itemCount}, Type: ${customerTypeLabel}, Val: €${leadValue.toFixed(2)} [REVENUE:${leadValue.toFixed(2)}]`);\n\n            // @TODO: Integrate analytics event here (e.g. Mixpanel)\n            // @TODO: Add payment gateway logic for [LEAD][PAID] in future\n\n            const storeSubject = `SmartBuild Hinnapäring: ${city} - ${itemCount} toodet (${customerTypeLabel})`;\n            // More business-like body for stores\n            const storeBody = `Tere!\n\nSmartBuild keskkonnast on saabunud uus hinnapäring.\n\nPALUN SAATKE PAKKUMINE KLIENDILE:\nNimi: ${name || \"Eraisik\"}\nE-post: ${email}\nTelefon: ${phone || \"-\"}\nEttevõte: ${body.company || \"-\"}\nKliendi tüüp: ${customerTypeLabel}\nLinn: ${city}\n\nTOOTED:\n${productRows}\n\nLISAINFO:\n${notes || \"-\"}\n\nPalun vastake otse kliendile (${email}).\nSmartBuild`;\n\n            if (!isSmtpConfigured) {\n                // DRY RUN\n                console.log(`[EMAIL][DRY RUN] ---------------------------------------------------`);\n                console.log(`[EMAIL][DRY RUN] To STORE: ${storeName} <${storeEmail}>`);\n                console.log(`[EMAIL][DRY RUN] Subject: ${storeSubject}`);\n                console.log(`[EMAIL][DRY RUN] Reply-To: ${email}`);\n                console.log(`[EMAIL][DRY RUN] Body: \\n${storeBody}`);\n                console.log(`[EMAIL][DRY RUN] ---------------------------------------------------`);\n                sentTo.push(storeName);\n                continue;\n            }\n\n            // REAL SEND\n            try {\n                console.log(`[Email] Sending to ${storeName} (${storeEmail})...`);\n                await transporter.sendMail({\n                    from: process.env.SMTP_FROM || '\"SmartBuild\" <noreply@smartbuild.ee>',\n                    to: storeEmail,\n                    replyTo: email, // Critical for B2B\n                    subject: storeSubject,\n                    text: storeBody,\n                });\n                sentTo.push(storeName);\n            } catch (err) {\n                console.error(`[Email Error] Failed to send to ${storeName}:`, err);\n                errors.push(storeName);\n            }\n        }\n\n        if (sentTo.length === 0 && errors.length > 0) {\n            return NextResponse.json({ error: \"Kirjade saatmine ebaõnnestus.\" }, { status: 500 });\n        }\n\n        // [FUTURE INTEGRATION POINT]\n        // Parallel to success response, we can emit an event or call a Webhook\n        // to sync this lead with the Partner's CRM (e.g. Pipedrive/Hubspot).\n        // await syncToCRM(body, sentTo);\n\n        return NextResponse.json({ success: true, sentTo });\n\n    } catch (error) {\n        console.error(\"RFQ Send Error:\", error);\n        return NextResponse.json({ error: \"Serveri viga päringu töötlemisel.\" }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/shipments/update/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/wolt/create/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/wolt/estimate/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PARNU_WAREHOUSE' is defined but never used.","line":3,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":38,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"PARNU_WAREHOUSE"},"fix":{"range":[145,162],"text":""},"desc":"Remove unused variable \"PARNU_WAREHOUSE\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\nimport type { WoltEstimateRequest, WoltEstimateResponse } from \"@/app/lib/wolt\";\nimport { WOLT_CONFIG, PARNU_WAREHOUSE } from \"@/app/lib/wolt\";\n\nexport async function POST(request: Request) {\n    try {\n        const body = (await request.json()) as WoltEstimateRequest;\n\n        // Basic Validation\n        if (!body.dropoff.street || !body.dropoff.city || !body.dropoff.phone) {\n            return NextResponse.json({ error: \"Missing required address fields\" }, { status: 400 });\n        }\n\n        // DEMO MODE\n        if (WOLT_CONFIG.isDemo) {\n            console.log(\"[Wolt] Using DEMO mode for estimation\");\n\n            // Simulate API delay\n            await new Promise(r => setTimeout(r, 600));\n\n            // Calculate Weight based on mock data lookup\n            const { PRODUCTS } = await import(\"@/app/lib/mockData\");\n            let totalWeight = 0;\n\n            for (const item of body.items) {\n                const product = PRODUCTS.find(p => p.id === item.id || p.name === item.name);\n                if (product) {\n                    totalWeight += (product.weightKg || 1) * item.count;\n                }\n            }\n\n            // Deterministic Factors\n            const city = body.dropoff.city || \"Tallinn\";\n            const cityFactorMap: Record<string, number> = {\n                \"Tallinn\": 0,\n                \"Tartu\": 1.5,\n                \"Pärnu\": 1.0,\n                \"Narva\": 2.5,\n            };\n            const cityFactor = cityFactorMap[city] || 2.0;\n\n            // Price Formula: Base + (Weight * Factor) + City\n            const basePrice = 3.90;\n            const weightPrice = Math.min(totalWeight * 0.15, 5); // Cap weight surcharge at 5€\n            const price = Number((basePrice + weightPrice + cityFactor).toFixed(2));\n\n            // Time Formula: 25-45 base + city offset\n            const baseTime = 25;\n            const timeOffset = (city.length * 3) % 15; // Deterministic \"random\" based on string length\n            const eta = Math.min(45, Math.max(25, baseTime + timeOffset));\n\n            const response: WoltEstimateResponse = {\n                price,\n                currency: \"EUR\",\n                eta_minutes: eta,\n                token: \"demo_binding_token_\" + Date.now(),\n                is_demo: true,\n            };\n\n            return NextResponse.json(response);\n        }\n\n        // TODO: Real API Implementation\n        // For now, even if not demo, we fallback to demo logic because we don't have keys in this env usually\n        return NextResponse.json({ error: \"Real API not configured\" }, { status: 501 });\n\n    } catch (error) {\n        console.error(\"Wolt Estimate Error:\", error);\n        return NextResponse.json({ error: \"Internal Server Error\" }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/api/wolt/webhook/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/auth/callback/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":109,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":112,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1193,1196],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1193,1196],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { supabase } from \"@/app/lib/supabaseClient\";\n\nexport default function AuthCallbackPage() {\n    const router = useRouter();\n\n    useEffect(() => {\n        const handleAuth = async () => {\n            // Check if we have a hash in URL (Implicit flow / legacy) or if supabase detects session\n            // The newer Supabase client handles the token exchange automatically if detectSessionInUrl is true.\n            // We just need to wait a moment or check if session exists, then redirect.\n\n            const { data: { session }, error } = await supabase.auth.getSession();\n\n            if (error) {\n                console.error(\"Auth callback error:\", error);\n                router.push(\"/login?error=auth_callback_error\");\n                return;\n            }\n\n            if (session) {\n                console.log(\"Auth callback success, redirecting to home\");\n                router.push(\"/\");\n            } else {\n                // Wait for the client to process the hash\n                const { data: { subscription } } = supabase.auth.onAuthStateChange((event: string, session: any) => {\n                    if (event === 'SIGNED_IN' && session) {\n                        router.push(\"/\");\n                    }\n                });\n\n                // Fallback timeout\n                setTimeout(() => {\n                    router.push(\"/?warning=auth_timeout\");\n                }, 3000);\n\n                return () => subscription.unsubscribe();\n            }\n        };\n\n        handleAuth();\n    }, [router]);\n\n    return (\n        <div className=\"min-h-screen flex items-center justify-center bg-[#020617] text-white\">\n            <div className=\"flex flex-col items-center gap-4\">\n                <div className=\"w-8 h-8 border-2 border-white/20 border-t-emerald-500 rounded-full animate-spin\"></div>\n                <p className=\"text-slate-400 text-sm\">Finishing login...</p>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/cart/loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/cart/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":215,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13677,13680],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13677,13680],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport Link from \"next/link\";\nimport { useMemo, useState } from \"react\";\nimport { useCart } from \"@/components/cart/CartProvider\";\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\nimport { getTranslatedProduct } from \"@/app/lib/i18n/productUtils\";\nimport WoltDeliveryWidget from \"@/components/cart/WoltDeliveryWidget\";\n\nfunction eur(n: number) {\n    return `${n.toFixed(2)} €`;\n}\n\nexport default function CartPage() {\n    const { items, inc, dec, remove, clear, totalItems } = useCart();\n    const { t } = useLanguage();\n\n    const [deliveryMethod, setDeliveryMethod] = useState(\"pickup\");\n\n    // Индикативная сумма: берём самую дешевую цену в offers * qty\n    const indicativeTotal = useMemo(() => {\n        let sum = 0;\n        for (const it of items) {\n            const best =\n                it.offers?.reduce<number | null>((min, o) => (min === null || o.price < min ? o.price : min), null) ??\n                null;\n            if (best !== null) sum += best * it.qty;\n        }\n        return sum;\n    }, [items]);\n\n    return (\n        <main className=\"bg-pattern-subtle min-h-screen mx-auto max-w-6xl px-4 py-10\">\n            <div className=\"flex items-end justify-between gap-4\">\n                <div>\n                    {/* Stepper */}\n                    <div className=\"flex items-center gap-3 text-sm font-medium mb-6 text-slate-400\">\n                        <span className=\"text-white font-bold bg-slate-800 border border-slate-700 px-3 py-1 rounded-lg shadow-sm ring-1 ring-white/5\">{t.rfq.step_1}</span>\n                        <span className=\"text-slate-600\">→</span>\n                        <span className=\"text-slate-500\">{t.rfq.step_2}</span>\n                        <span className=\"text-slate-600\">→</span>\n                        <span className=\"text-slate-500\">{t.rfq.step_3}</span>\n                    </div>\n\n                    <h1 className=\"text-3xl font-bold tracking-tight text-white drop-shadow-sm\">{t.cart.title}</h1>\n                    <p className=\"mt-2 text-slate-300 font-medium\">\n                        {t.cart.subtitle}\n                    </p>\n                </div>\n\n                <div className=\"flex gap-2\">\n                    <Link\n                        href=\"/products\"\n                        className=\"rounded-xl border border-slate-700 bg-slate-900/80 px-4 py-2 text-sm font-medium text-slate-300 hover:bg-slate-800 hover:text-white transition-all hover:border-slate-600\"\n                    >\n                        ← {t.cart.back_to_shop}\n                    </Link>\n                    <div className=\"flex flex-col items-end gap-1\">\n                        {deliveryMethod === 'pickup' && (\n                            <>\n                                <Link\n                                    href=\"/rfq\"\n                                    className=\"rounded-xl bg-emerald-600 px-4 py-2 text-sm font-bold text-white hover:bg-emerald-700 shadow-sm shadow-emerald-500/20 cursor-pointer\"\n                                >\n                                    {t.cart.request_quote}\n                                </Link>\n                                <span className=\"text-[10px] text-slate-400 font-medium\">\n                                    {t.cart.response_time}\n                                </span>\n                            </>\n                        )}\n                    </div>\n                </div>\n            </div>\n\n            {items.length === 0 ? (\n                <div className=\"mt-8 rounded-3xl bg-surface p-8 text-center\">\n                    <div className=\"text-3xl mb-4\">🛒</div>\n                    <div className=\"text-lg font-bold text-slate-200\">{t.cart.empty_title}</div>\n                    <p className=\"mt-2 text-slate-400\">\n                        {t.cart.empty_text}\n                    </p>\n                    <Link\n                        href=\"/products\"\n                        className=\"mt-6 inline-flex rounded-xl bg-blue-600 px-6 py-3 text-sm font-bold text-white hover:bg-blue-700 transition-colors\"\n                    >\n                        {t.cart.open_catalog}\n                    </Link>\n                </div>\n            ) : (\n                <>\n                    <div className=\"mt-8 grid gap-4\">\n                        {items.map((it) => {\n                            const best =\n                                it.offers?.reduce<{ store: string; price: number } | null>((min, o) => {\n                                    if (!min || o.price < min.price) return { store: o.storeName, price: o.price };\n                                    return min;\n                                }, null) ?? null;\n\n                            const { displayName, categoryName, unitName } = getTranslatedProduct(it, t);\n\n                            return (\n                                <div key={it.id} className=\"rounded-3xl bg-surface p-6\">\n                                    <div className=\"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between\">\n                                        <div>\n                                            <div className=\"text-xs text-slate-500 uppercase tracking-wider font-bold mb-1\">{categoryName ?? t.common.category}</div>\n                                            <div className=\"text-xl font-bold text-slate-100\">{displayName}</div>\n                                            <div className=\"mt-2 text-sm text-slate-400\">\n                                                {t.common.unit}: <span className=\"font-medium text-slate-200\">{unitName ?? t.common.pcs}</span>\n                                            </div>\n\n                                            {best ? (\n                                                <div className=\"mt-3 text-sm flex items-center gap-2\">\n                                                    <span className=\"text-slate-400\">{t.cart.cheapest_indicative} </span>\n                                                    <span className=\"font-bold text-emerald-400 bg-emerald-900/30 px-2 py-0.5 rounded text-base\">{eur(best.price)}</span>\n                                                    <span className=\"text-slate-600\"> — </span>\n                                                    <span className=\"font-medium text-slate-300\">{best.store}</span>\n                                                </div>\n                                            ) : (\n                                                <div className=\"mt-2 text-sm text-slate-500\">\n                                                    {t.cart.no_prices}\n                                                </div>\n                                            )}\n                                        </div>\n\n                                        <div className=\"flex items-center gap-3\">\n                                            <div className=\"flex items-center bg-slate-900 rounded-xl border border-slate-700 p-1\">\n                                                <button\n                                                    onClick={() => dec(it.id)}\n                                                    className=\"h-10 w-10 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white flex items-center justify-center text-lg transition-colors\"\n                                                    aria-label={t.common.decrease}\n                                                >\n                                                    −\n                                                </button>\n                                                <div className=\"min-w-[48px] text-center\">\n                                                    <div className=\"text-sm font-bold text-slate-100 leading-none\">{it.qty}</div>\n                                                </div>\n                                                <button\n                                                    onClick={() => inc(it.id)}\n                                                    className=\"h-10 w-10 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white flex items-center justify-center text-lg transition-colors\"\n                                                    aria-label={t.common.increase}\n                                                >\n                                                    +\n                                                </button>\n                                            </div>\n\n                                            <button\n                                                onClick={() => remove(it.id)}\n                                                className=\"h-12 w-12 rounded-xl bg-slate-900 border border-slate-700 text-slate-400 hover:text-red-400 hover:bg-red-900/20 hover:border-red-900/30 flex items-center justify-center transition-colors\"\n                                                aria-label={t.common.remove}\n                                            >\n                                                <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" /></svg>\n                                            </button>\n                                        </div>\n                                    </div>\n\n                                    {/* Bulk hint */}\n                                    {\n                                        it.qty >= 10 ? (\n                                            <div className=\"mt-4 rounded-2xl border border-emerald-900/30 bg-emerald-900/10 px-4 py-3 text-sm text-emerald-400\">\n                                                {t.cart.bulk_discount_hint}\n                                            </div>\n                                        ) : null\n                                    }\n                                </div>\n                            );\n                        })}\n                    </div>\n\n                    <WoltDeliveryWidget items={items} onDeliveryChange={setDeliveryMethod} />\n\n                    {/* Summary */}\n                    <div className=\"mt-8 rounded-3xl bg-surface p-6\">\n                        <div className=\"flex flex-col gap-6 sm:flex-row sm:items-center sm:justify-between\">\n                            <div>\n                                <div className=\"text-sm text-slate-400\">\n                                    {t.cart.total_items} <span className=\"font-semibold text-slate-100\">{totalItems}</span>\n                                </div>\n                                <div className=\"mt-1 text-sm text-slate-400\">\n                                    {t.cart.total_indicative}{\" \"}\n                                    <span className=\"font-semibold text-slate-100\">{eur(indicativeTotal)}</span>\n                                </div>\n                                <div className=\"mt-2 text-xs text-slate-500\">\n                                    {t.cart.indicative_disclaimer}\n                                </div>\n\n                                {/* Trust Signals */}\n                                <div className=\"mt-4 flex flex-wrap gap-3\">\n                                    <span className=\"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-emerald-900/20 text-emerald-400 text-xs font-medium border border-emerald-500/20\">\n                                        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" className=\"w-3.5 h-3.5\">\n                                            <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z\" clipRule=\"evenodd\" />\n                                        </svg>\n                                        {t.cart.trust_direct}\n                                    </span>\n                                    <span className=\"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-blue-900/20 text-blue-400 text-xs font-medium border border-blue-500/20\">\n                                        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" className=\"w-3.5 h-3.5\">\n                                            <path fillRule=\"evenodd\" d=\"M10 2a4 4 0 00-4 4v1H5a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2V9a2 2 0 00-2-2h-1V6a4 4 0 00-4-4zm-1 5a1 1 0 112 0v1H9V7zm1 6a1 1 0 100-2 1 1 0 000 2z\" clipRule=\"evenodd\" />\n                                        </svg>\n                                        {t.cart.trust_secure}\n                                    </span>\n                                </div>\n                            </div>\n\n                            <div className=\"flex flex-col gap-4 w-full sm:w-auto items-center sm:items-end\">\n                                {deliveryMethod === 'pickup' && (\n                                    <Link\n                                        href=\"/rfq\"\n                                        className=\"inline-flex items-center justify-center rounded-2xl bg-emerald-600 px-8 py-4 text-base font-bold text-white hover:bg-emerald-500 shadow-lg shadow-emerald-900/20 transition-all hover:scale-[1.02]\"\n                                    >\n                                        {t.cart.request_quote} →\n                                    </Link>\n                                )}\n                                {deliveryMethod === 'wolt' && (\n                                    <div className=\"text-sm text-slate-500 italic text-center\">\n                                        {(t as any).wolt?.confirm_delivery} ↑\n                                    </div>\n                                )}\n                                <div className=\"flex gap-4 items-center\">\n                                    <div className=\"text-[10px] text-center text-emerald-400 font-bold bg-emerald-900/20 py-1 px-2 rounded-lg border border-emerald-500/20\">\n                                        {t.cart.save_money_hint}\n                                    </div>\n                                    <button\n                                        onClick={clear}\n                                        className=\"text-xs text-slate-500 hover:text-slate-300 underline decoration-slate-700 transition-colors\"\n                                    >\n                                        {t.cart.clear_cart}\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </>\n            )}\n        </main>\n    );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/contact/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronUp' is defined but never used.","line":13,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ChevronUp"},"fix":{"range":[229,244],"text":""},"desc":"Remove unused variable \"ChevronUp\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8701,8704],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8701,8704],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":185,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":185,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9565,9568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9565,9568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":194,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":194,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10227,10230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10227,10230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":202,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":202,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10650,10653],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10650,10653],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":209,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":209,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11187,11190],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11187,11190],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\nimport { useState } from \"react\";\nimport {\n    Mail,\n    MessageSquare,\n    Send,\n    CheckCircle2,\n    AlertCircle,\n    HelpCircle,\n    ChevronDown,\n    ChevronUp\n} from \"lucide-react\";\n\nexport default function ContactPage() {\n    const { t } = useLanguage();\n    const strings = t.contact;\n\n    // Form State\n    const [loading, setLoading] = useState(false);\n    const [success, setSuccess] = useState(false);\n    const [error, setError] = useState<string | null>(null);\n\n    // FAQ State\n    const [openFaq, setOpenFaq] = useState<number | null>(0);\n\n    const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\n        e.preventDefault();\n        setLoading(true);\n        setError(null);\n\n        const formData = new FormData(e.currentTarget);\n        const data = Object.fromEntries(formData);\n\n        try {\n            const res = await fetch('/api/contact/support', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify(data),\n            });\n\n            const json = await res.json();\n\n            if (!res.ok) throw new Error(json.error || 'Failed to send');\n\n            setSuccess(true);\n        } catch (err) {\n            console.error(err);\n            setError(strings.form.error);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    if (!strings) return null;\n\n    return (\n        <div className=\"min-h-screen bg-slate-50 pt-24 pb-20\">\n            <div className=\"container mx-auto px-4 max-w-6xl\">\n\n                {/* Header */}\n                <div className=\"text-center mb-16\">\n                    <h1 className=\"text-4xl md:text-5xl font-bold text-slate-900 mb-4\">{strings.title}</h1>\n                    <p className=\"text-xl text-slate-500 max-w-2xl mx-auto\">{strings.subtitle}</p>\n                </div>\n\n                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-12 items-start\">\n\n                    {/* Left: Contact Form */}\n                    <div className=\"bg-white rounded-2xl shadow-xl border border-slate-100 p-8\">\n                        <div className=\"flex items-center gap-3 mb-6\">\n                            <div className=\"p-3 bg-blue-50 rounded-xl text-blue-600\">\n                                <Mail size={24} />\n                            </div>\n                            <h2 className=\"text-2xl font-bold text-slate-800\">Saada sõnum</h2>\n                        </div>\n\n                        {success ? (\n                            <div className=\"bg-green-50 border border-green-200 rounded-xl p-8 text-center py-16\">\n                                <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 text-green-600\">\n                                    <CheckCircle2 size={32} />\n                                </div>\n                                <h3 className=\"text-2xl font-bold text-green-800 mb-2\">{strings.form.success}</h3>\n                                <p className=\"text-green-700\">{strings.form.success_desc}</p>\n                                <button\n                                    onClick={() => setSuccess(false)}\n                                    className=\"mt-6 text-sm font-semibold text-green-700 underline hover:text-green-800\"\n                                >\n                                    Saada uus sõnum\n                                </button>\n                            </div>\n                        ) : (\n                            <form onSubmit={handleSubmit} className=\"space-y-5\">\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-5\">\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">{strings.form.name}</label>\n                                        <input\n                                            name=\"name\"\n                                            required\n                                            className=\"w-full px-4 py-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all\"\n                                            placeholder=\"Jaan Tamm\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">{strings.form.email}</label>\n                                        <input\n                                            name=\"email\"\n                                            type=\"email\"\n                                            required\n                                            className=\"w-full px-4 py-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all\"\n                                            placeholder=\"jaan@example.com\"\n                                        />\n                                    </div>\n                                </div>\n\n                                <div>\n                                    <label className=\"block text-sm font-medium text-slate-700 mb-1\">{strings.form.topic}</label>\n                                    <select\n                                        name=\"topic\"\n                                        className=\"w-full px-4 py-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all bg-white\"\n                                    >\n                                        <option value=\"General\">{strings.form.topics.general}</option>\n                                        <option value=\"Orders\">{strings.form.topics.orders}</option>\n                                        <option value=\"Partners\">{strings.form.topics.partners}</option>\n                                        <option value=\"Technical\">{strings.form.topics.technical}</option>\n                                    </select>\n                                </div>\n\n                                <div>\n                                    <label className=\"block text-sm font-medium text-slate-700 mb-1\">{strings.form.message}</label>\n                                    <textarea\n                                        name=\"message\"\n                                        required\n                                        rows={5}\n                                        className=\"w-full px-4 py-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all resize-none\"\n                                        placeholder=\"...\"\n                                    />\n                                </div>\n\n                                {error && (\n                                    <div className=\"flex items-center gap-2 text-red-600 bg-red-50 p-3 rounded-lg text-sm\">\n                                        <AlertCircle size={16} />\n                                        {error}\n                                    </div>\n                                )}\n\n                                <button\n                                    disabled={loading}\n                                    className=\"w-full py-4 bg-slate-900 hover:bg-slate-800 text-white font-bold rounded-xl transition-all shadow-lg flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed\"\n                                >\n                                    {loading ? (\n                                        <span>Thinking...</span>\n                                    ) : (\n                                        <>\n                                            {strings.form.submit}\n                                            <Send size={18} />\n                                        </>\n                                    )}\n                                </button>\n                            </form>\n                        )}\n                    </div>\n\n                    {/* Right: FAQ */}\n                    <div className=\"space-y-6\">\n                        <div className=\"flex items-center gap-3 mb-2\">\n                            <div className=\"p-3 bg-orange-50 rounded-xl text-orange-600\">\n                                <HelpCircle size={24} />\n                            </div>\n                            <h2 className=\"text-2xl font-bold text-slate-800\">{strings.faq.title}</h2>\n                            <p className=\"text-slate-500 mb-6 text-sm\">{(strings.faq as any).intro}</p>\n                        </div>\n\n                        <div className=\"space-y-4\">\n                            {[1, 2, 3, 4, 5, 6, 7, 8].map((i) => (\n                                <div\n                                    key={i}\n                                    className={`bg-white rounded-xl border transition-all duration-200 overflow-hidden ${openFaq === i ? 'border-orange-200 shadow-md' : 'border-slate-200 hover:border-slate-300'}`}\n                                >\n                                    <button\n                                        onClick={() => setOpenFaq(openFaq === i ? null : i)}\n                                        className=\"w-full flex items-center justify-between p-5 text-left font-semibold text-slate-800\"\n                                    >\n                                        {(strings.faq as any)[`q${i}`]}\n                                        <span className={`text-slate-400 transition-transform duration-200 ${openFaq === i ? 'rotate-180' : ''}`}>\n                                            <ChevronDown size={20} />\n                                        </span>\n                                    </button>\n\n                                    <div\n                                        className={`px-5 text-slate-600 overflow-hidden transition-all duration-300 ease-in-out ${openFaq === i ? 'max-h-40 pb-5 opacity-100' : 'max-h-0 opacity-0'}`}\n                                    >\n                                        {(strings.faq as any)[`a${i}`]}\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n\n                        {/* Customer Support CTA */}\n                        <div className=\"bg-blue-50 border border-blue-100 rounded-2xl p-8 text-center mt-10\">\n                            <h3 className=\"font-bold text-slate-900 text-lg mb-2\">{(strings.faq as any).no_answer}</h3>\n                            <button\n                                onClick={() => {\n                                    document.querySelector('input[name=\"topic\"]')?.scrollIntoView({ behavior: 'smooth' });\n                                }}\n                                className=\"inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl font-bold transition-colors shadow-lg shadow-blue-500/20\"\n                            >\n                                {(strings.faq as any).contact_us} <MessageSquare size={18} />\n                            </button>\n                        </div>\n\n                        <div className=\"bg-slate-900 rounded-2xl p-8 text-white mt-6\">\n                            <h3 className=\"font-bold text-xl mb-2\">Oled ettevõte?</h3>\n                            <p className=\"text-slate-300 mb-6\">Pakume erilahendusi ehituspoodidele ja transpordifirmadele.</p>\n                            <a\n                                href=\"/partners\"\n                                className=\"inline-flex items-center gap-2 bg-orange-500 hover:bg-orange-600 text-white px-5 py-2.5 rounded-lg font-bold transition-colors text-sm\"\n                            >\n                                Vaata partnerprogrammi <ArrowRightIcon size={16} />\n                            </a>\n                        </div>\n                    </div>\n\n                </div>\n            </div>\n        </div>\n    );\n}\n\nfunction ArrowRightIcon({ size }: { size: number }) {\n    return (\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M5 12h14\" /><path d=\"m12 5 7 7-7 7\" /></svg>\n    )\n}","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/delivery-partners/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Dictionary' is defined but never used.","line":20,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":20,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Dictionary"},"fix":{"range":[317,367],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\nimport {\n    ShieldCheck,\n    Scale,\n    Route,\n    Truck,\n    Ban,\n    Split,\n    CheckCircle2,\n    ArrowRight,\n    AlertTriangle,\n    Boxes,\n    ServerCog,\n    BadgeCheck,\n    Send\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { Dictionary } from \"@/app/lib/i18n/types\";\n\nexport default function DeliveryPartnersPage() {\n    const { t } = useLanguage();\n    // Use type assertion carefully or assume t is typed. If t is Dictionary, access should be safe?\n    // If t is unknown, assert as Dictionary.\n    const txt = t.delivery_partners;\n\n    if (!txt) return null;\n\n    return (\n        <div className=\"min-h-screen bg-slate-50\">\n            {/* Hero Section */}\n            <section className=\"bg-[#0f172a] text-white pt-24 pb-32 relative overflow-hidden\">\n                {/* Tech Background Grid */}\n                <div className=\"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 pointer-events-none\"></div>\n                <div className=\"absolute inset-0 bg-gradient-to-b from-blue-900/20 to-slate-900 pointer-events-none\"></div>\n\n                <div className=\"container mx-auto px-4 relative z-10 text-center max-w-4xl\">\n                    <div className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-blue-500/10 border border-blue-500/30 text-blue-400 text-xs font-bold uppercase tracking-wide mb-8\">\n                        <Route size={14} />\n                        <span>Logistics Partner Program</span>\n                    </div>\n                    <h1 className=\"text-4xl md:text-6xl font-extrabold tracking-tight mb-8 leading-tight\">\n                        Fewer failed deliveries. <br /> Higher efficiency.\n                    </h1>\n                    <p className=\"text-xl text-slate-400 mb-12 max-w-2xl mx-auto leading-relaxed\">\n                        SmartBuild filters orders before they reach delivery platforms. We ensure every pickup is feasible and every drop-off is successful.\n                    </p>\n                    <div className=\"flex flex-col items-center justify-center gap-4\">\n                        <Link\n                            href=\"/partners/contact?type=delivery\"\n                            className=\"px-8 py-4 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-xl transition-all shadow-lg shadow-blue-600/20 flex items-center gap-2 cursor-pointer z-20\"\n                        >\n                            {txt.cta}\n                            <ArrowRight size={20} />\n                        </Link>\n\n                        <a href=\"mailto:info@smartbuild.ee\" className=\"text-sm text-slate-500 hover:text-slate-300 transition-colors flex items-center gap-2 cursor-pointer z-20\">\n                            <Send size={12} /> info@smartbuild.ee\n                        </a>\n                    </div>\n                    <p className=\"mt-4 text-xs text-slate-500\">{txt.cta_sub}</p>\n                </div>\n            </section>\n\n            {/* Smart Delivery Gate Visualization */}\n            <section className=\"py-24 -mt-20 relative z-20\">\n                <div className=\"container mx-auto px-4\">\n                    <div className=\"bg-white rounded-3xl shadow-xl border border-slate-100 p-8 md:p-12\">\n                        <div className=\"text-center mb-16\">\n                            <h2 className=\"text-2xl font-bold text-slate-900 flex items-center justify-center gap-2\">\n                                <ShieldCheck className=\"text-blue-600\" />\n                                {txt.gate.title}\n                            </h2>\n                        </div>\n\n                        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-8 relative\">\n                            {/* Connectors */}\n                            <div className=\"hidden md:block absolute top-12 left-[12%] right-[12%] h-0.5 bg-gradient-to-r from-blue-100 via-blue-200 to-green-200 -z-10\"></div>\n\n                            {/* Step 1 */}\n                            <div className=\"flex flex-col items-center text-center\">\n                                <div className=\"w-24 h-24 rounded-2xl bg-white border-2 border-slate-100 shadow-sm flex flex-col items-center justify-center mb-6 z-10\">\n                                    <Boxes size={32} className=\"text-slate-400 mb-2\" />\n                                    <div className=\"text-[10px] font-mono text-slate-400\">INPUT</div>\n                                </div>\n                                <h3 className=\"font-bold text-slate-900 mb-2\">{txt.gate.step1}</h3>\n                                <p className=\"text-sm text-slate-500\">Items, Qty, Location</p>\n                            </div>\n\n                            {/* Step 2 */}\n                            <div className=\"flex flex-col items-center text-center\">\n                                <div className=\"w-24 h-24 rounded-2xl bg-blue-50 border-2 border-blue-100 shadow-sm flex flex-col items-center justify-center mb-6 z-10 animate-pulse\">\n                                    <ServerCog size={32} className=\"text-blue-600 mb-2\" />\n                                    <div className=\"text-[10px] font-mono text-blue-600\">PROCESSING</div>\n                                </div>\n                                <h3 className=\"font-bold text-slate-900 mb-2\">{txt.gate.step2}</h3>\n                                <p className=\"text-sm text-slate-500\">Weight, Volume, Lift</p>\n                            </div>\n\n                            {/* Step 3 */}\n                            <div className=\"flex flex-col items-center text-center\">\n                                <div className=\"w-24 h-24 rounded-2xl bg-white border-2 border-slate-100 shadow-sm flex flex-col items-center justify-center mb-6 z-10 p-2\">\n                                    <div className=\"w-full text-left space-y-1\">\n                                        <div className=\"h-1.5 w-3/4 bg-green-400 rounded-full\"></div>\n                                        <div className=\"h-1.5 w-1/2 bg-slate-200 rounded-full\"></div>\n                                        <div className=\"h-1.5 w-full bg-slate-200 rounded-full\"></div>\n                                    </div>\n                                    <div className=\"text-[9px] font-mono text-slate-400 mt-2\">CLASSIFY</div>\n                                </div>\n                                <h3 className=\"font-bold text-slate-900 mb-2\">{txt.gate.step3}</h3>\n                                <div className=\"flex flex-wrap justify-center gap-1\">\n                                    <span className=\"text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded\">{txt.gate.types.wolt}</span>\n                                    <span className=\"text-[10px] bg-orange-100 text-orange-700 px-1.5 py-0.5 rounded\">{txt.gate.types.split}</span>\n                                </div>\n                            </div>\n\n                            {/* Step 4 */}\n                            <div className=\"flex flex-col items-center text-center\">\n                                <div className=\"w-24 h-24 rounded-2xl bg-green-50 border-2 border-green-200 shadow-lg flex flex-col items-center justify-center mb-6 z-10\">\n                                    <BadgeCheck size={36} className=\"text-green-600 mb-1\" />\n                                    <div className=\"text-[10px] font-bold text-green-700\">APPROVED</div>\n                                </div>\n                                <h3 className=\"font-bold text-slate-900 mb-2\">{txt.gate.step4}</h3>\n                                <p className=\"text-sm font-semibold text-green-600\">{txt.gate.caption}</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </section>\n\n            {/* Why Orders Fail (Reason Codes) */}\n            <section className=\"py-16 bg-white\">\n                <div className=\"container mx-auto px-4 max-w-5xl\">\n                    <h2 className=\"text-3xl font-bold text-slate-900 text-center mb-16\">{txt.reasons.title}</h2>\n\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                        <ReasonCard code=\"OVER_WEIGHT_LIMIT\" icon={Scale} text={txt.reasons.over_weight} />\n                        <ReasonCard code=\"OVER_VOLUME_LIMIT\" icon={Boxes} text={txt.reasons.over_volume} />\n                        <ReasonCard code=\"STAIRS_NO_ELEVATOR\" icon={AlertTriangle} text={txt.reasons.stairs} />\n                        <ReasonCard code=\"FRAGILE_ITEMS\" icon={Ban} text={txt.reasons.fragile} />\n                        <ReasonCard code=\"NOT_SUPPORTED_CATEGORY\" icon={Ban} text={txt.reasons.category} />\n                    </div>\n                </div>\n            </section>\n\n            {/* Partial Delivery Split */}\n            <section className=\"py-20 bg-slate-50 border-y border-slate-200\">\n                <div className=\"container mx-auto px-4\">\n                    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-16 items-center\">\n                        <div>\n                            <div className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-orange-100 text-orange-700 text-xs font-bold mb-6\">\n                                <Split size={14} />\n                                <span>Unique Logic</span>\n                            </div>\n                            <h2 className=\"text-4xl font-bold text-slate-900 mb-6\">{txt.split.title}</h2>\n                            <p className=\"text-lg text-slate-600 leading-relaxed mb-8\">\n                                {txt.split.desc}\n                            </p>\n                        </div>\n\n                        {/* Visual Cart Split */}\n                        <div className=\"bg-white p-8 rounded-3xl shadow-lg border border-slate-200\">\n                            <div className=\"text-sm font-bold text-slate-400 mb-4 uppercase tracking-wider\">Shopping Cart</div>\n\n                            {/* Store Delivery Part */}\n                            <div className=\"bg-slate-50 rounded-xl p-4 mb-4 border border-slate-100 opacity-60\">\n                                <div className=\"flex items-center gap-3 mb-2\">\n                                    <Truck size={18} className=\"text-slate-500\" />\n                                    <span className=\"font-semibold text-slate-700\">Store Delivery (3 days)</span>\n                                </div>\n                                <div className=\"pl-8 text-sm text-slate-600\">\n                                    {txt.split.example_store}\n                                </div>\n                            </div>\n\n                            {/* Divider with Split Icon */}\n                            <div className=\"relative flex items-center justify-center -my-2 z-10\">\n                                <div className=\"bg-white border border-slate-200 rounded-full p-2 text-slate-400\">\n                                    <Split size={16} />\n                                </div>\n                            </div>\n\n                            {/* Express Delivery Part */}\n                            <div className=\"bg-blue-50 rounded-xl p-4 mt-2 border border-blue-100 ring-2 ring-blue-500/10\">\n                                <div className=\"flex items-center gap-3 mb-2\">\n                                    <div className=\"w-5 h-5 rounded bg-blue-500 flex items-center justify-center\">\n                                        <Route size={12} className=\"text-white\" />\n                                    </div>\n                                    <span className=\"font-bold text-blue-900\">Express Partner (30-60 min)</span>\n                                </div>\n                                <div className=\"pl-8 text-sm font-medium text-blue-800\">\n                                    {txt.split.example_express}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </section>\n\n            {/* Benefits */}\n            <section className=\"py-20 bg-white\">\n                <div className=\"container mx-auto px-4 max-w-4xl\">\n                    <h2 className=\"text-3xl font-bold text-slate-900 text-center mb-12\">{txt.benefits.title}</h2>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6\">\n                        {[\n                            \"Cleaner order stream (ready-to-ship)\",\n                            \"Reduced cancellations & failed pickups\",\n                            \"Higher courier success rate\",\n                            \"Lower support cost\",\n                            \"New revenue stream (Construction)\",\n                            \"Predictable load & dimensions\"\n                        ].map((item, idx) => (\n                            <div key={idx} className=\"flex items-center gap-4\">\n                                <CheckCircle2 className=\"text-blue-600 shrink-0\" size={24} />\n                                <span className=\"text-lg text-slate-700 font-medium\">{item}</span>\n                            </div>\n                        ))}\n                    </div>\n                </div>\n            </section>\n\n            {/* Pitch */}\n            <section className=\"py-20 bg-slate-900 text-white\">\n                <div className=\"container mx-auto px-4 max-w-3xl text-center\">\n                    <h2 className=\"text-2xl font-bold mb-6 text-blue-400\">{txt.pitch.title}</h2>\n                    <p className=\"text-xl leading-relaxed text-slate-300\">\n                        &quot;{txt.pitch.text}&quot;\n                    </p>\n\n                    <div className=\"mt-12 p-6 bg-slate-800/50 rounded-2xl border border-slate-700 inline-block\">\n                        <Link href=\"/partners/contact?type=delivery\" className=\"inline-flex items-center gap-3 px-10 py-4 bg-white hover:bg-slate-200 text-slate-900 font-bold rounded-xl transition-colors text-lg mx-auto cursor-pointer\">\n                            {txt.cta}\n                            <ArrowRight size={20} />\n                        </Link>\n                        <p className=\"mt-4 text-xs text-slate-500\">{txt.cta_sub}</p>\n                    </div>\n                </div>\n            </section>\n        </div>\n    );\n}\n\nfunction ReasonCard({ code, icon: Icon, text }: { code: string, icon: React.ElementType, text: string }) {\n    return (\n        <div className=\"p-6 rounded-xl border border-rose-100 bg-rose-50/30 flex items-start gap-4 hover:border-rose-200 transition-colors\">\n            <div className=\"shrink-0 p-2 bg-rose-100 rounded-lg text-rose-600\">\n                <Icon size={20} />\n            </div>\n            <div>\n                <div className=\"text-[10px] font-mono text-rose-400 uppercase tracking-wide mb-1 opacity-70\">\n                    {code}\n                </div>\n                <div className=\"font-semibold text-slate-800\">\n                    {text}\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Link"},"fix":{"range":[24,53],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import \"./globals.css\";\nimport Link from \"next/link\";\nimport type { Metadata } from \"next\";\nimport { Providers } from \"@/app/providers\";\nimport Header from \"@/components/layout/Header\";\nimport Footer from \"@/components/layout/Footer\";\nimport BottomNav from \"@/components/layout/BottomNav\";\nimport { Analytics } from \"@vercel/analytics/react\";\nimport { UserProvider } from \"@/components/auth/UserProvider\";\nimport { LanguageProvider } from \"@/components/i18n/LanguageProvider\";\n\n// Estonian Metadata\nexport const metadata: Metadata = {\n    metadataBase: new URL(process.env.NEXT_PUBLIC_SITE_URL || 'https://smartbuild.ee'),\n    title: {\n        default: \"SmartBuild - Ehitusmaterjalide Hinnavõrdlus\",\n        template: \"%s | SmartBuild Eesti\"\n    },\n    description: \"Eesti suurim ehitusmaterjalide hinnavõrdlus. Leia parim pakkumine Espakist, Bauhofist, K-Rautast ja mujalt. Säästa aega ja raha.\",\n    keywords: [\"ehitusmaterjalid\", \"ehitusmaterjalide hind\", \"hinnavõrdlus\", \"ehituspood\", \"bauhof\", \"k-rauta\", \"espak\", \"ehitus\", \"remont\"],\n    authors: [{ name: \"SmartBuild Eesti\" }],\n    creator: \"SmartBuild\",\n    publisher: \"SmartBuild\",\n    robots: {\n        index: true,\n        follow: true,\n    },\n    openGraph: {\n        type: 'website',\n        locale: 'et_EE',\n        url: 'https://smartbuild.ee',\n        siteName: 'SmartBuild Eesti',\n        title: \"SmartBuild - Ehitusmaterjalide Hinnavõrdlus\",\n        description: \"Leia parim hind Espakist, Bauhofist, K-Rautast ja mujalt.\",\n        images: [\n            {\n                url: '/opengraph-image',\n                width: 1200,\n                height: 630,\n                alt: 'SmartBuild Ehitusmaterjalide Hinnavõrdlus',\n            },\n        ],\n    },\n    twitter: {\n        card: 'summary_large_image',\n        title: \"SmartBuild Eesti\",\n        description: \"Ehitusmaterjalide hinnavõrdlus. Säästa aega ja raha.\",\n        images: ['/opengraph-image'],\n    },\n    icons: {\n        icon: '/favicon.ico',\n        apple: '/apple-icon.png',\n    },\n};\n\nexport default function RootLayout({\n    children,\n}: {\n    children: React.ReactNode;\n}) {\n    const jsonLd = {\n        '@context': 'https://schema.org',\n        '@graph': [\n            {\n                '@type': 'Organization',\n                '@id': 'https://smartbuild.ee/#organization',\n                name: 'SmartBuild Eesti',\n                url: 'https://smartbuild.ee',\n                logo: 'https://smartbuild.ee/logo.png', // Placeholder\n                sameAs: [\n                    'https://facebook.com/smartbuild', // Placeholder\n                ]\n            },\n            {\n                '@type': 'WebSite',\n                '@id': 'https://smartbuild.ee/#website',\n                url: 'https://smartbuild.ee',\n                name: 'SmartBuild',\n                publisher: {\n                    '@id': 'https://smartbuild.ee/#organization'\n                }\n            }\n        ]\n    };\n\n    return (\n        <html lang=\"et\">\n            <head>\n                <script\n                    type=\"application/ld+json\"\n                    dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}\n                />\n            </head>\n\n            {/* ... */}\n\n            <body className=\"flex flex-col min-h-screen bg-[#020617] text-slate-100 font-sans antialiased selection:bg-emerald-500/30\">\n                <Providers>\n                    <LanguageProvider>\n                        <UserProvider>\n                            {/* Header extracted to client component */}\n                            <Header />\n\n                            {/* Main Content */}\n                            <main className=\"flex-grow\">\n                                {children}\n                            </main>\n\n                            {/* Footer extracted to client component */}\n                            <Footer />\n                            <BottomNav />\n                        </UserProvider>\n                    </LanguageProvider>\n                </Providers>\n                <Analytics />\n            </body>\n        </html>\n    );\n}\n\n// This tool call is cancelled in favor of extraction strategy.","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/analytics.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[370,373],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[370,373],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'startDate' is defined but never used. Allowed unused args must match /^_/u.","line":34,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'endDate' is defined but never used. Allowed unused args must match /^_/u.","line":34,"column":57,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":64}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport { supabase } from './supabaseServer';\n\nexport type AnalyticsEventName =\n    | 'view_home'\n    | 'view_product'\n    | 'cart_add'\n    | 'checkout_start'\n    | 'order_placed'\n    | 'delivery_check_failed'\n    | 'partner_signup_click';\n\nexport async function trackEvent(\n    eventName: string, // Relaxed type to allow flexible events\n    properties: Record<string, any> = {},\n    userId?: string\n) {\n    try {\n        await supabase.from('analytics_events').insert({\n            event_name: eventName,\n            user_id: userId || null,\n            properties\n        });\n    } catch (e) {\n        console.error(\"Analytics Error:\", e);\n        // Fail silently to not block user flow\n    }\n}\n\nexport const track = trackEvent;\n\n// Aggregation Helpers (SQL Wrappers)\n\nexport async function getFunnelStats(startDate: string, endDate: string) {\n    // In a real scenario, this would be a complex SQL Group By or multiple queries.\n    // For MVP, we'll mock or doing simple counts if table populated.\n    // Ideally use Supabase RPC or just Count queries.\n\n    // Pseudo-implementation:\n    /*\n    const views = await supabase.from('analytics_events').select('*', { count: 'exact' }).eq('event_name', 'view_home');\n    const carts = ...\n    */\n\n    // Just returning structure for now as per instructions \"helpers\".\n    return {\n        views: 0,\n        carts: 0,\n        checkouts: 0,\n        orders: 0\n    };\n}\n\nexport async function getDeliveryRefusals() {\n    // Breakdown of 'delivery_check_failed' events by 'reason' property\n    return {\n        over_weight: 0,\n        no_service: 0,\n        other: 0\n    };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/catalog.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'STORES' is defined but never used.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"STORES"},"fix":{"range":[82,89],"text":""},"desc":"Remove unused variable \"STORES\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/lib/catalog.ts\n\nimport type { Product, Offer } from \"./products\";\nimport { STORES, type StoreName } from \"./stores\";\n\nimport { fetchEhitusABCOffer, EABC_URLS } from \"./providers/ehituseabc\";\nimport { fetchBauhofOffer, BAUHOF_URLS } from \"./providers/bauhof\";\nimport { fetchKRautaOffer, KRAUTA_URLS } from \"./providers/krauta\";\n\n/**\n* Вспомогательная структура результата от провайдера\n*/\ntype ProviderResult = {\n    id: string;\n    name: string;\n    category: string;\n    offer: Offer & { store: StoreName | string };\n} | null;\n\n/**\n* Нормализация текста (для склейки одинаковых товаров)\n*/\nfunction normalizeKey(s: string) {\n    return s\n        .toLowerCase()\n        .replace(/\\u00a0/g, \" \")\n        .replace(/[()]/g, \"\")\n        .replace(/\\s+/g, \" \")\n        .trim();\n}\n\n/**\n* Главная функция сборки каталога\n* Ее вызывает API /api/products\n*/\nexport async function buildCatalog(): Promise<Product[]> {\n    const tasks: Promise<ProviderResult>[] = [];\n\n    // Ehituse ABC\n    for (const url of EABC_URLS) {\n        tasks.push(fetchEhitusABCOffer(url));\n    }\n\n    // Bauhof\n    for (const url of BAUHOF_URLS) {\n        tasks.push(fetchBauhofOffer(url));\n    }\n\n    // K-Rauta\n    for (const url of KRAUTA_URLS) {\n        tasks.push(fetchKRautaOffer(url));\n    }\n\n    const results = await Promise.allSettled(tasks);\n\n    const map = new Map<string, Product>();\n\n    for (const r of results) {\n        if (r.status !== \"fulfilled\" || !r.value) continue;\n\n        const { id, name, category, offer } = r.value;\n\n        const key = normalizeKey(name + \"|\" + category);\n\n        if (!map.has(key)) {\n            map.set(key, {\n                id,\n                name,\n                category,\n                offers: [],\n            });\n        }\n\n        map.get(key)!.offers.push({\n            store: offer.store as StoreName,\n            price: offer.price,\n            url: offer.url,\n        });\n    }\n\n    return Array.from(map.values());\n}","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/categorization.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/delivery/reasonCodes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/delivery/ux.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ShipmentEvent' is defined but never used.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":23,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"ShipmentEvent"},"fix":{"range":[173,221],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[439,442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[439,442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'criticalShipment' is assigned a value but never used.","line":95,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":95,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { DeliveryReasonCode, DeliverySeverity, DeliveryAction, REASON_SEVERITY, REASON_ACTION } from \"./reasonCodes\";\nimport type { Order, Shipment} from \"@/app/lib/types\";\nimport { ShipmentEvent } from \"@/app/lib/types\";\n\nexport interface DeliveryUXState {\n    severity: DeliverySeverity;\n    titleKey: string;\n    descriptionKey: string;\n    action: DeliveryAction;\n    showCard: boolean;\n    reasonCode?: DeliveryReasonCode;\n    meta?: any;\n}\n\n// SLA Thresholds in milliseconds\nconst SLA_THRESHOLDS = {\n    PENDING: 30 * 60 * 1000, // 30 mins\n    PREPARING: 2 * 60 * 60 * 1000, // 2 hours\n    DISPATCHED_NO_ETA: 2 * 60 * 60 * 1000, // 2 hours\n    ETA_OVERDUE: 30 * 60 * 1000 // 30 mins\n};\n\nexport function getDeliveryUXState(order: Order, shipments: Shipment[]): DeliveryUXState {\n    // 0. Default State (Happy Path)\n    const state: DeliveryUXState = {\n        severity: DeliverySeverity.INFO,\n        titleKey: \"delivery.ux.status.normal.title\",\n        descriptionKey: \"delivery.ux.status.normal.desc\",\n        action: DeliveryAction.NONE,\n        showCard: false\n    };\n\n    if (!shipments || shipments.length === 0) return state;\n\n    // 1. Find the most critical shipment (based on priority/severity)\n    // We prioritize \"active\" problems over completed ones, unless everything is failed.\n\n    // Sort shipments by \"badness\"\n    const activeShipments = shipments.filter(s => s.status !== 'delivered' && s.status !== 'cancelled');\n\n    // If all delivered, show success? Or just hide card (logic says hide unless eta changes etc)\n    if (activeShipments.length === 0) {\n        // Check if there was a problem recently? For now, if all delivered, we are good.\n        // Exception: Partial delivery where one part is later?\n        return { ...state, severity: DeliverySeverity.SUCCESS, showCard: false };\n    }\n\n    // Logic: finding the single most important reason\n    // Use the getReasonPriority from reasonCodes.ts logic implicitly via manual checks or reuse\n    // Here we define a custom finder.\n\n    let criticalShipment: Shipment | null = null;\n    let criticalReason: DeliveryReasonCode | null = null;\n\n    // A) Check for Explicit Reason Codes in active shipments\n    for (const s of activeShipments) {\n        if (s.status_reason_code) {\n            const code = s.status_reason_code as DeliveryReasonCode;\n            // If we found one, and it's \"worse\" or same, take it.\n            // We can use severity comparison. ACTION > ERROR > WARNING > INFO\n            if (!criticalReason) {\n                criticalReason = code;\n                criticalShipment = s;\n            } else {\n                const currentSev = REASON_SEVERITY[criticalReason];\n                const newSev = REASON_SEVERITY[code];\n                if (getSeverityWeight(newSev) > getSeverityWeight(currentSev)) {\n                    criticalReason = code;\n                    criticalShipment = s;\n                }\n            }\n        }\n    }\n\n    // B) SLA Checks (if no explicit critical reason found yet OR if SLA breach is severe)\n    // If we have an explicit reason, we usually use that. SLA breaches are for \"UNKNOWN\" causes.\n    if (!criticalReason) {\n        const now = new Date().getTime();\n        for (const s of activeShipments) {\n            const createdAt = new Date(s.created_at).getTime();\n            const status = s.status;\n            let breach = false;\n\n            if (status === 'pending' && (now - createdAt > SLA_THRESHOLDS.PENDING)) breach = true;\n            else if (status === 'preparing' && (now - createdAt > SLA_THRESHOLDS.PREPARING)) breach = true;\n            // CHECK ETA\n            if (s.eta_minutes) {\n                // Approximate calc\n                const etaTime = createdAt + s.eta_minutes * 60000;\n                if (now > etaTime + SLA_THRESHOLDS.ETA_OVERDUE) breach = true;\n            }\n\n            if (breach) {\n                criticalReason = DeliveryReasonCode.UNKNOWN;\n                criticalShipment = s;\n                break; // First breach is enough for now\n            }\n        }\n    }\n\n    // C) Construct State\n    if (criticalReason) {\n        state.reasonCode = criticalReason;\n        state.severity = REASON_SEVERITY[criticalReason];\n        state.action = REASON_ACTION[criticalReason];\n        state.showCard = true; // By default show card for any reason found\n\n        // Special overrides\n        if (criticalReason === DeliveryReasonCode.WEATHER_DELAY) {\n            // If ETA not changed significantly, might stay info? \n            // Implementing user rule: info -> warning if ETA changed. \n            // For now assume warning to be safe if code acts up.\n            if (state.severity === DeliverySeverity.INFO) state.severity = DeliverySeverity.WARNING;\n        }\n\n        state.titleKey = `delivery.ux.${criticalReason}.title`;\n        state.descriptionKey = `delivery.ux.${criticalReason}.description`;\n    }\n\n    // D) Hide card if everything is actually fine and reason is just INFO?\n    // User rule: \"Poaskazat reason-kartochku TOLKO esli...\"\n    // If severity is INFO and current status is progressing, maybe hide?\n    // But our Info codes (Weather, Customer Reschedule) imply a deviation.\n    // So we keep showCard = true for them.\n\n    return state;\n}\n\nfunction getSeverityWeight(sev: DeliverySeverity): number {\n    switch (sev) {\n        case DeliverySeverity.ACTION_REQUIRED: return 4;\n        case DeliverySeverity.ERROR: return 3;\n        case DeliverySeverity.WARNING: return 2;\n        case DeliverySeverity.INFO: return 1;\n        default: return 0;\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/i18n/dictionary.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/i18n/productUtils.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[107,110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[107,110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Product } from \"@/app/lib/types\";\n\nexport function getTranslatedProduct(product: Product, t: any) {\n    const categoryName = t.categories?.[product.categoryKey] || product.category;\n    const genericName = t.prod_generics?.[product.genericNameKey];\n\n    const displayName = genericName\n        ? `${genericName} ${product.brand || \"\"} ${product.specification || \"\"}`.trim().replace(/\\s+/g, \" \")\n        : product.name;\n\n    const unitName = t.units?.[product.unitKey || \"\"] || product.unit;\n\n    return {\n        displayName,\n        categoryName,\n        unitName\n    };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/i18n/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/imageUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/leadScoring.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/mockData.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ValidationStatus' is defined but never used.","line":2,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":43,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ValidationStatus"},"fix":{"range":[64,82],"text":""},"desc":"Remove unused variable \"ValidationStatus\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Product } from \"./types\";\nimport { validateProduct, ValidationStatus } from \"./productValidator\";\n\nexport type StoreOffer = {\n    storeName: string;\n    price: number;\n    currency: string;\n    availability: \"Laos\" | \"Piiratud kogus\" | \"Tellimisel\";\n    logoColor: string; // Mock visual distinction\n};\n\nconst RAW_PRODUCTS: Product[] = [\n    {\n        id: \"gyproc-normal\",\n        genericNameKey: \"prod_gypsum_standard\",\n        brand: \"Gyproc\",\n        specification: \"GN 13 Standard 12.5mm\",\n        name: \"Kipsplaat Gyproc GN 13 Standard 12.5mm\", // fallback\n        categoryKey: \"cat_general\",\n        subcategoryKey: \"sub_gypsum\",\n        category: \"Üldehitus\", // fallback\n        unit: \"tk\",\n        unitKey: \"unit_pcs\",\n        image: \"/images/products/gypsum-sheet.png\",\n        weightKg: 25,\n        lengthCm: 250, widthCm: 120, heightCm: 1.25, // Too big for Wolt\n        volumeM3: 0.039,\n        bulky: true, // 1200x2500 is very large\n        deliveryClass: \"oversize\",\n        offers: [\n            { storeName: \"Ehituse ABC\", price: 8.95, currency: \"€\", availability: \"Laos\", logoColor: \"bg-red-500\" },\n            { storeName: \"Espak\", price: 8.50, currency: \"€\", availability: \"Laos\", logoColor: \"bg-red-600\" },\n            { storeName: \"Bauhof\", price: 9.20, currency: \"€\", availability: \"Laos\", logoColor: \"bg-orange-500\" },\n            { storeName: \"K-Rauta\", price: 8.90, currency: \"€\", availability: \"Laos\", logoColor: \"bg-blue-600\" },\n            { storeName: \"Decora\", price: 8.85, currency: \"€\", availability: \"Piiratud kogus\", logoColor: \"bg-green-600\" },\n            { storeName: \"Karl Bilder\", price: 9.50, currency: \"€\", availability: \"Tellimisel\", logoColor: \"bg-black\" },\n        ]\n    },\n    {\n        id: \"osb-3\",\n        genericNameKey: \"prod_osb3\",\n        specification: \"12mm 2500x1250mm\",\n        name: \"OSB-3 Plaat 12mm 2500x1250mm\",\n        categoryKey: \"cat_timber\",\n        subcategoryKey: \"sub_osb\",\n        category: \"Puitmaterjal\",\n        unit: \"tk\",\n        unitKey: \"unit_pcs\",\n        image: \"/images/products/osb-sheet.png\",\n        weightKg: 22,\n        lengthCm: 250, widthCm: 125, heightCm: 1.2, // Too big for Wolt\n        volumeM3: 0.037,\n        bulky: true,\n        deliveryClass: \"oversize\",\n        offers: [\n            { storeName: \"Espak\", price: 14.90, currency: \"€\", availability: \"Laos\", logoColor: \"bg-red-600\" },\n            { storeName: \"Bauhof\", price: 15.50, currency: \"€\", availability: \"Laos\", logoColor: \"bg-orange-500\" },\n            { storeName: \"K-Rauta\", price: 14.20, currency: \"€\", availability: \"Laos\", logoColor: \"bg-blue-600\" },\n            { storeName: \"Decora\", price: 15.00, currency: \"€\", availability: \"Laos\", logoColor: \"bg-green-600\" },\n            { storeName: \"Karl Bilder\", price: 14.80, currency: \"€\", availability: \"Laos\", logoColor: \"bg-black\" },\n        ]\n    },\n    {\n        id: \"fibo-3\",\n        genericNameKey: \"prod_fibo_block\",\n        specification: \"3 200mm\",\n        name: \"Fibo plokk 3 200mm\",\n        categoryKey: \"cat_masonry\",\n        subcategoryKey: \"sub_blocks\",\n        category: \"Müür\",\n        unit: \"tk\",\n        unitKey: \"unit_pcs\",\n        image: \"/images/products/fibo-block.png\",\n        weightKg: 6,\n        lengthCm: 20, widthCm: 20, heightCm: 30, // Fits\n        volumeM3: 0.005,\n        bulky: false,\n        deliveryClass: \"medium\",\n        offers: [\n            { storeName: \"Espak\", price: 2.85, currency: \"€\", availability: \"Laos\", logoColor: \"bg-red-600\" },\n            { storeName: \"Bauhof\", price: 3.10, currency: \"€\", availability: \"Piiratud kogus\", logoColor: \"bg-orange-500\" },\n            { storeName: \"K-Rauta\", price: 2.95, currency: \"€\", availability: \"Laos\", logoColor: \"bg-blue-600\" },\n            { storeName: \"Decora\", price: 2.90, currency: \"€\", availability: \"Laos\", logoColor: \"bg-green-600\" },\n            { storeName: \"Karl Bilder\", price: 3.20, currency: \"€\", availability: \"Tellimisel\", logoColor: \"bg-black\" },\n        ]\n    },\n    {\n        id: \"wool-100\",\n        genericNameKey: \"prod_stone_wool\",\n        brand: \"Paroc\",\n        specification: \"eXtra 100mm\",\n        name: \"Kivivill Paroc eXtra 100mm\",\n        categoryKey: \"cat_insulation\",\n        subcategoryKey: \"sub_wool\",\n        category: \"Soojustus\",\n        unit: \"pakk\",\n        unitKey: \"unit_pack\",\n        image: \"/images/products/paroc-slabs.png\",\n        weightKg: 15,\n        lengthCm: 120, widthCm: 60, heightCm: 40, // Too big (120 > 100)\n        volumeM3: 0.3, // Large volume\n        bulky: true,\n        deliveryClass: \"oversize\",\n        offers: [\n            { storeName: \"Espak\", price: 24.50, currency: \"€\", availability: \"Laos\", logoColor: \"bg-red-600\" },\n            { storeName: \"Bauhof\", price: 26.90, currency: \"€\", availability: \"Laos\", logoColor: \"bg-orange-500\" },\n            { storeName: \"K-Rauta\", price: 23.90, currency: \"€\", availability: \"Laos\", logoColor: \"bg-blue-600\" },\n            { storeName: \"Decora\", price: 25.50, currency: \"€\", availability: \"Piiratud kogus\", logoColor: \"bg-green-600\" },\n            { storeName: \"Karl Bilder\", price: 24.90, currency: \"€\", availability: \"Laos\", logoColor: \"bg-black\" },\n        ]\n    },\n    {\n        id: \"cement-standard\",\n        genericNameKey: \"prod_cement\",\n        brand: \"Kunda\",\n        specification: \"Tsement CEM I 42,5N\",\n        name: \"Tsement Kunda Standard 35kg\",\n        categoryKey: \"cat_mixtures\",\n        subcategoryKey: \"sub_cement\",\n        category: \"Segud\",\n        unit: \"kott\",\n        unitKey: \"unit_bag\",\n        image: \"/images/products/cement-bag.png\",\n        weightKg: 35,\n        lengthCm: 50, widthCm: 30, heightCm: 15,\n        volumeM3: 0.02,\n        bulky: false,\n        deliveryClass: \"heavy\",\n        offers: [\n            { storeName: \"Ehituse ABC\", price: 5.90, currency: \"€\", availability: \"Laos\", logoColor: \"bg-red-500\" },\n            { storeName: \"Espak\", price: 6.20, currency: \"€\", availability: \"Laos\", logoColor: \"bg-red-600\" },\n            { storeName: \"Bauhof\", price: 6.50, currency: \"€\", availability: \"Laos\", logoColor: \"bg-orange-500\" },\n        ]\n    },\n    {\n        id: \"timber-2x4\",\n        genericNameKey: \"prod_timber\",\n        specification: \"C24 45x95mm 3m\",\n        name: \"Höövelmaterjal C24 45x95mm 3000mm\",\n        categoryKey: \"cat_timber\",\n        subcategoryKey: \"sub_sawn\",\n        category: \"Puitmaterjal\",\n        unit: \"tk\",\n        unitKey: \"unit_pcs\",\n        image: \"/images/products/timber-plank.png\",\n        weightKg: 6,\n        lengthCm: 300, widthCm: 9.5, heightCm: 4.5, // Too Long\n        volumeM3: 0.012,\n        bulky: true, // Long > 1.2m\n        deliveryClass: \"oversize\",\n        offers: [\n            { storeName: \"PuuMarket\", price: 4.50, currency: \"€\", availability: \"Laos\", logoColor: \"bg-green-700\" },\n            { storeName: \"Espak\", price: 4.80, currency: \"€\", availability: \"Laos\", logoColor: \"bg-red-600\" },\n        ]\n    },\n    // NEW: Small Items for Wolt Eligibility\n    {\n        id: \"screws-box\",\n        genericNameKey: \"prod_generics.prod_screws\", // Needs key added\n        brand: \"Essve\",\n        specification: \"4.2x55mm 500tk\",\n        name: \"Kruvid puidule 4.2x55mm 500tk\",\n        categoryKey: \"cat_general\",\n        subcategoryKey: \"sub_fasteners\", // Needs key added\n        category: \"Kinnitused\",\n        unit: \"karp\",\n        unitKey: \"unit_pack\",\n        image: \"/images/products/screws.png\",\n        weightKg: 1.5,\n        lengthCm: 15, widthCm: 10, heightCm: 8, // Fits perfectly\n        volumeM3: 0.002,\n        bulky: false,\n        deliveryClass: \"small\", // ELIGIBLE\n        offers: [\n            { storeName: \"Espak\", price: 12.50, currency: \"€\", availability: \"Laos\", logoColor: \"bg-red-600\" },\n            { storeName: \"Bauhof\", price: 13.20, currency: \"€\", availability: \"Laos\", logoColor: \"bg-orange-500\" },\n        ]\n    },\n    {\n        id: \"tape-measure\",\n        genericNameKey: \"prod_generics.prod_tape\",\n        brand: \"Stanley\",\n        specification: \"5m\",\n        name: \"Mõõdulint 5m\",\n        categoryKey: \"cat_general\",\n        subcategoryKey: \"sub_tools\",\n        category: \"Tööriistad\",\n        unit: \"tk\",\n        unitKey: \"unit_pcs\",\n        image: \"/images/products/tape.png\",\n        weightKg: 0.3,\n        lengthCm: 8, widthCm: 8, heightCm: 4, // Fits perfectly\n        volumeM3: 0.001,\n        bulky: false,\n        deliveryClass: \"small\", // ELIGIBLE\n        offers: [\n            { storeName: \"Espak\", price: 6.50, currency: \"€\", availability: \"Laos\", logoColor: \"bg-red-600\" },\n            { storeName: \"K-Rauta\", price: 5.90, currency: \"€\", availability: \"Laos\", logoColor: \"bg-blue-600\" },\n        ]\n    },\n    {\n        id: \"ceramic-tile-retro\",\n        genericNameKey: \"prod_tiles_retro\",\n        specification: \"20x20cm\",\n        name: \"Keraamiline plaat Retro 20x20cm\",\n        categoryKey: \"cat_finishing\",\n        subcategoryKey: \"sub_tiles\",\n        category: \"Viimistlus\",\n        unit: \"pakk\",\n        unitKey: \"unit_pack\",\n        image: \"/images/products/tile-retro.png\",\n        weightKg: 8,\n        // Dimensions MISSING to test \"Unknown Dimensions\" rule\n        // lengthCm: 20, widthCm: 20, heightCm: 5,\n        volumeM3: 0.015,\n        bulky: false,\n        fragile: true, // INELIGIBLE\n        deliveryClass: \"medium\",\n        offers: [\n            { storeName: \"Bauhof\", price: 18.50, currency: \"€\", availability: \"Laos\", logoColor: \"bg-orange-500\" },\n            { storeName: \"Decora\", price: 19.00, currency: \"€\", availability: \"Laos\", logoColor: \"bg-green-600\" },\n        ]\n    }\n];\n\n// Automatically apply Quality Gate\nexport const PRODUCTS = RAW_PRODUCTS.map(product => {\n    const validation = validateProduct(product);\n    return {\n        ...product,\n        status: validation.status,\n        qualityScore: validation.qualityScore,\n        rejectionReasons: validation.reasons\n    };\n});\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/notifications/service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/partner/csv.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/partners.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/productValidator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/products.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/providers/bauhof.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/providers/ehituseabc.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/providers/krauta.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/routingEngine.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CityName' is defined but never used.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":18,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CityName"},"fix":{"range":[66,85],"text":""},"desc":"Remove unused variable \"CityName\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'StoreName' is defined but never used.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":19,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"StoreName"},"fix":{"range":[85,105],"text":""},"desc":"Remove unused variable \"StoreName\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Manager' is defined but never used.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":17,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Manager"},"fix":{"range":[105,123],"text":""},"desc":"Remove unused variable \"Manager\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n    BRANDS,\n    CITIES,\n    STORE_LOCATIONS,\n    MANAGERS,\n    type CityName,\n    type StoreName,\n    type Manager,\n    type StoreLocation,\n    type ManagerId\n} from \"./storeContacts\";\n\n// In-Memory state for Load Balancing (Since no DB)\n// In production (serverless), this mimics state but resets on cold start.\n// For true persistence, this would be Redis or SQL.\nconst MANAGER_LOAD_STATE = new Map<ManagerId, number>();\n\n/**\n * Result of the Routing Process\n */\nexport type RoutingResult = {\n    destinationEmail: string;\n    targetName: string; // Manager Name or Store General\n    locationId: string;\n    managerId?: string;\n    method: 'MANAGER_ASSIGNED' | 'STORE_FALLBACK' | 'DEFAULT_FALLBACK';\n};\n\n/**\n * Resolves the Store Location based on City Name and Brand Name (from UI)\n */\nexport function resolveLocation(cityName: string, storeName: string): StoreLocation | null {\n    const city = CITIES.find(c => c.name === cityName);\n    const brand = BRANDS.find(b => b.name === storeName);\n\n    if (!city || !brand) return null;\n\n    return STORE_LOCATIONS.find(loc => loc.cityId === city.id && loc.brandId === brand.id) || null;\n}\n\n/**\n * Selects the best available manager for a given location.\n * Logic:\n * 1. Filter for ACTIVE managers at this location.\n * 2. Sort by 'Last Assigned' time (Ascending = Oldest first).\n * 3. Pick the first one.\n * 4. Update the 'Last Assigned' time to now.\n */\nexport function routeToManager(location: StoreLocation): RoutingResult {\n    const locationManagers = MANAGERS.filter(m =>\n        m.locationId === location.id &&\n        m.status === 'ACTIVE'\n    );\n\n    if (locationManagers.length === 0) {\n        // Fallback to Store General Email\n        return {\n            destinationEmail: location.generalEmail,\n            targetName: \"Üldine Osakond\", // \"General Department\"\n            locationId: location.id,\n            method: 'STORE_FALLBACK'\n        };\n    }\n\n    // Load Balancing Logic\n    // Sort by last assigned time (from memory state or 0)\n    locationManagers.sort((a, b) => {\n        const timeA = MANAGER_LOAD_STATE.get(a.id) || 0;\n        const timeB = MANAGER_LOAD_STATE.get(b.id) || 0;\n        return timeA - timeB;\n    });\n\n    const selectedManager = locationManagers[0];\n\n    // \"Update\" state\n    MANAGER_LOAD_STATE.set(selectedManager.id, Date.now());\n\n    return {\n        destinationEmail: selectedManager.email,\n        targetName: selectedManager.name,\n        locationId: location.id,\n        managerId: selectedManager.id,\n        method: 'MANAGER_ASSIGNED'\n    };\n}\n\n/**\n * Main Entry Point for RFQ Routing\n */\nexport function routeRFQ(cityName: string, storeName: string): RoutingResult | null {\n    console.log(`[Routing] Resolving: ${cityName} -> ${storeName}`);\n\n    // 1. Find Location\n    const location = resolveLocation(cityName, storeName);\n    if (!location) {\n        console.warn(`[Routing] Location not found for ${cityName} / ${storeName}`);\n        return null;\n    }\n\n    // 2. Select Manager (with Load Balancing)\n    const result = routeToManager(location);\n\n    // [FUTURE INTEGRATION POINT]\n    // Here we can fetch Partner-specific configuration to decide transmission method.\n    // Example:\n    // if (location.integrationType === 'DIRECTO_API') {\n    //    return { method: 'API', endpoint: location.apiUrl, ... }\n    // }\n\n    console.log(`[Routing] Routed to: ${result.destinationEmail} via ${result.method}`);\n    return result;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/storeContacts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/stores.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/supabaseClient.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1544,1547],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1544,1547],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\nexport const isDemoMode = !supabaseUrl || !supabaseKey;\n\n// Robust client creation: if env vars are missing, return a mock client or a limited one.\n// This prevents build/runtime crashes on Vercel if Supabase is not configured.\n\n// Mock Supabase Client for \"No-Backend\" mode\nconst mockSupabase = {\n    auth: {\n        signInWithPassword: async () => ({ error: { message: \"Sisselogimine pole hetkel aktiivne (Demo)\" } }),\n        signUp: async () => ({ error: { message: \"Registreerimine pole hetkel aktiivne (Demo)\" }, data: {} }),\n        signOut: async () => ({ error: null }),\n        getUser: async () => ({ data: { user: null }, error: null }),\n        getSession: async () => ({ data: { session: null }, error: null }),\n        onAuthStateChange: () => ({ data: { subscription: { unsubscribe: () => { } } } }),\n        signInWithOAuth: async () => ({ error: { message: \"Demo režiim: OAuth pole seadistatud\" } }),\n    },\n    from: () => ({\n        insert: async () => ({ error: null }),\n        select: async () => ({ data: [], error: null }),\n    })\n};\n\nexport const supabase = (supabaseUrl && supabaseKey)\n    ? createClient(supabaseUrl, supabaseKey, {\n        auth: {\n            persistSession: true,\n            autoRefreshToken: true,\n            detectSessionInUrl: true,\n            storageKey: 'smartbuild-auth',\n        }\n    })\n    : (mockSupabase as any);\n\nexport async function signInWithOAuth(provider: 'google' | 'facebook' | 'apple') {\n    if (isDemoMode) {\n        // In demo mode, we simulate a delay then throw error or return mock\n        await new Promise(r => setTimeout(r, 800));\n        alert(\"Demo Mode: Social Login is not configured without env vars.\");\n        return { error: { message: \"Demo Mode\" } };\n    }\n\n    const { data, error } = await supabase.auth.signInWithOAuth({\n        provider,\n        options: {\n            redirectTo: typeof window !== 'undefined' ? `${window.location.origin}/auth/callback` : undefined,\n        },\n    });\n    return { data, error };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/supabaseServer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/types.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":112,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3484,3487],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3484,3487],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":231,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6410,6413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6410,6413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { ValidationStatus } from \"./productValidator\";\n\nexport type StoreOffer = {\n    storeName: string;\n    price: number;\n    currency: string;\n    availability: \"Laos\" | \"Piiratud kogus\" | \"Tellimisel\";\n    logoColor: string;\n};\n\nexport interface Product {\n    id: string;\n    // UI rendering: t(genericNameKey) + (brand ? \" \" + brand : \"\") + (specification ? \" \" + specification : \"\")\n    genericNameKey: string;     // e.g. \"prod_gypsum_standard\" -> \"Kipsplaat\"\n    brand?: string;             // e.g. \"Gyproc\", \"Knauf\" (Keeping as-is)\n    specification?: string;     // e.g. \"12.5mm 1200x2500\" or \"GN 13\"\n\n    // Logistics (Optional - used for Delivery Eligibility)\n    weightKg?: number;          // Single unit weight\n    volumeM3?: number;          // Single unit volume\n    lengthCm?: number;          // New: Side 1\n    widthCm?: number;           // New: Side 2\n    heightCm?: number;          // New: Side 3\n    deliveryAllowedWolt?: boolean; // New: Manual override\n    bulky?: boolean;            // True if dimensions exceed standard courier limits (e.g. > 1.2m)\n    fragile?: boolean;          // True if requires special handling (glass, ceramics)\n    deliveryClass?: \"small\" | \"medium\" | \"heavy\" | \"oversize\"; // Logistics class\n    hazmat?: boolean;           // True if hazardous (paint, chemicals)\n\n    // Fallback/Legacy\n    name: string;               // Keeping for now to avoid break, but should use above in UI\n\n    // Categories\n    categoryKey: string;        // e.g. \"cat_construction\" -> \"Üldehitus\"\n    subcategoryKey?: string;    // e.g. \"sub_drywall\" -> \"Kipsplaadid\"\n    category: string;           // Legacy fallback\n\n    unit: string;               // Legacy fallback\n    unitKey?: string;           // e.g. \"unit_pcs\", \"unit_pack\"\n    unitLabel?: string;\n    image: string;\n    offers: StoreOffer[];\n    // Quality Gate Fields\n    status?: ValidationStatus;\n    qualityScore?: number;\n    rejectionReasons?: string[];\n}\n\nexport interface Store {\n    id: string;\n    name: string;\n    brand_name: string;\n    city: string;\n    address: string;\n    contact_email: string;\n    phone: string;\n    status: 'active' | 'pending' | 'disabled';\n}\n\nexport type StoreRole = 'partner_admin' | 'partner_manager' | 'platform_admin';\n\nexport interface StoreUser {\n    user_id: string;\n    store_id: string;\n    role: StoreRole;\n}\n\nexport interface StoreProduct {\n    id: string;\n    store_id: string;\n    product_master_id?: string;\n    name_override_et?: string;\n    name_override_ru?: string;\n    brand: string;\n    sku?: string;\n    ean?: string;\n    price: number;\n    currency: string;\n    stock_status: 'in_stock' | 'out_of_stock' | 'limited' | 'preorder';\n    stock_qty?: number;\n\n    // Logistics\n    weight_kg?: number;\n    length_cm?: number;\n    width_cm?: number;\n    height_cm?: number;\n    hazmat: boolean;\n    missing_dimensions: boolean;\n\n    // Toggles\n    delivery_allowed_wolt: boolean;\n    pickup_allowed: boolean;\n    store_delivery_allowed: boolean;\n\n    image_url?: string;\n    updated_at: string;\n}\n\nexport interface ImportJob {\n    id: string;\n    store_id: string;\n    status: 'uploaded' | 'previewed' | 'applied' | 'failed';\n    file_name: string;\n    mapping_json: Record<string, string>;\n    summary_json: {\n        total_rows?: number;\n        valid_rows?: number;\n        error_rows?: number;\n        created_count?: number;\n        updated_count?: number;\n    };\n    errors_json: Array<{ row: number; error: string; data?: any }>;\n    created_at: string;\n}\n\nexport interface StoreDeliverySettings {\n    store_id: string;\n    pickup_enabled: boolean;\n    wolt_enabled: boolean;\n    store_delivery_enabled: boolean;\n    cities: string[];\n    prep_time_min: number;\n    partial_delivery_enabled: boolean;\n    store_delivery_rules_json: {\n        min_order_eur?: number;\n        fee_eur?: number;\n        free_shipping_from_eur?: number;\n    };\n}\n\n// User Dashboard Types\nexport interface UserProfile {\n    id: string; // auth.uid\n    full_name: string;\n    phone: string;\n    default_city: string;\n}\n\nexport type OrderStatus = 'draft' | 'submitted' | 'confirmed' | 'cancelled' | 'completed';\nexport type PaymentStatus = 'unpaid' | 'paid' | 'refunded';\n\nexport interface Order {\n    id: string;\n    user_id: string;\n    status: OrderStatus;\n    payment_status: PaymentStatus;\n    currency: string;\n    subtotal: number;\n    delivery_fee: number;\n    total: number;\n    city: string;\n    address_line: string;\n    phone: string;\n    notes?: string;\n    created_at: string;\n    // Relations\n    items?: OrderItem[];\n    shipments?: Shipment[];\n}\n\nexport interface OrderItem {\n    id: string;\n    order_id: string;\n    store_id?: string;\n    product_id: string;\n    name: string;\n    brand?: string;\n    qty: number;\n    unit?: string;\n    price: number;\n    line_total: number;\n    image_url?: string;\n    shipment_id?: string;\n}\n\nexport type ShipmentType = 'wolt' | 'store_delivery' | 'pickup';\nexport type ShipmentStatus = 'pending' | 'quoted' | 'accepted' | 'preparing' | 'dispatched' | 'delivered' | 'failed' | 'cancelled';\n\nexport interface Shipment {\n    id: string;\n    order_id: string;\n    type: ShipmentType;\n    status: ShipmentStatus;\n    store_id?: string;\n    city?: string;\n    address_line?: string;\n    eta_minutes?: number;\n    fee: number;\n    provider?: string;\n    provider_reference?: string;\n    // Reason Codes\n    status_reason_code?: string;\n    status_reason_details?: string;\n\n    created_at: string;\n    // Relations\n    events?: ShipmentEvent[];\n}\n\nexport interface ShipmentEvent {\n    id: string;\n    shipment_id: string;\n    event_status: string;\n    message?: string;\n    reason_code?: string;\n    visibility?: 'public' | 'internal';\n    created_at: string;\n}\n\nexport interface NotificationSettings {\n    user_id: string;\n    email_enabled: boolean;\n    inapp_enabled: boolean;\n    notify_all_updates: boolean;\n    quiet_hours_start?: number;\n    quiet_hours_end?: number;\n    language_preference?: 'et' | 'ru';\n    created_at: string;\n    updated_at: string;\n}\n\nexport interface Notification {\n    id: string;\n    user_id: string;\n    type: 'order_submitted' | 'shipment_status' | 'eta_change' | 'action_required' | 'partial_delivery' | 'system';\n    severity: 'info' | 'warning' | 'action_required' | 'error';\n    title_key?: string;\n    body_key?: string;\n    title_text?: string;\n    body_text?: string;\n    payload?: any;\n    is_read: boolean;\n    channels: string[];\n    dedup_key?: string;\n    created_at: string;\n}\n\nexport interface NotificationEvent {\n    id: string;\n    notification_id: string;\n    channel: 'inapp' | 'email';\n    status: 'queued' | 'sent' | 'failed';\n    provider?: string;\n    provider_id?: string;\n    error?: string;\n    created_at: string;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/verifyCategorization.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/lib/wolt.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":272,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":272,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10156,10159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10156,10159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n\nexport interface WoltConfig {\n    merchantKey: string;\n    env: \"staging\" | \"production\";\n    merchantId: string;\n    venueId: string;\n    isDemo: boolean;\n}\n\nexport interface WoltEstimateRequest {\n    pickup: {\n        location: { lat: number; lng: number };\n        formatted_address: string;\n    };\n    dropoff: {\n        location?: { lat: number; lng: number };\n        street: string;\n        city: string;\n        post_code: string;\n        flat_number?: string;\n        comment?: string;\n        phone: string;\n    };\n    items: {\n        id?: string; // For server-side validation\n        name: string;\n        count: number;\n    }[];\n}\n\nexport interface WoltEstimateResponse {\n    price: number; // EUR\n    currency: string;\n    eta_minutes: number;\n    token?: string; // For binding the order\n    is_demo: boolean;\n}\n\nexport interface WoltOrderResponse {\n    wolt_order_reference_id: string;\n    tracking_url: string;\n    status: string;\n    is_demo: boolean;\n}\n\nconst ENV_KEY = process.env.WOLT_DRIVE_MERCHANT_KEY;\n\nexport const WOLT_CONFIG: WoltConfig = {\n    merchantKey: ENV_KEY || \"\",\n    env: (process.env.WOLT_DRIVE_ENV as \"staging\" | \"production\") || \"staging\",\n    merchantId: process.env.WOLT_DRIVE_MERCHANT_ID || \"\",\n    venueId: process.env.WOLT_DRIVE_VENUE_ID || \"\",\n    isDemo: !ENV_KEY, // Auto-enable demo if no key\n};\n\nexport const WOLT_BASE_URL = WOLT_CONFIG.env === \"production\"\n    ? \"https://image-upload.wolt.com/api/v1\"\n    : \"https://daas-public-api.wolt.com/v1\";\n\n// Using generic standard Pärnu location as warehouse\nexport const PARNU_WAREHOUSE = {\n    lat: 58.385880,\n    lng: 24.497110,\n    address: \"Suur-Jõe 52, 80042 Pärnu\",\n};\n\nexport const DELIVERY_LIMITS = {\n    maxWeightKg: 20,          // Total Cart Limit (Strict 20kg)\n    maxVolumeM3: 0.06,        // Total Cart Limit (60L = 0.06m3)\n    itemMaxWeightKg: 20,      // Per Item Limit (implicitly constrained by total)\n    itemMaxVolumeM3: 0.06,    // Per Item Limit\n    maxSingleSideCm: 80,      // Max length for any side except longest? Or strict 80x80x100?\n    // Prompt: max_single_side_cm=80, max_longest_side_cm=100\n    maxLongestSideCm: 100,\n    maxItems: 12,\n    disallowBulky: true,\n    disallowHazmat: true,\n    disallowFragile: true,    // Strict rule\n    requireKnownLogistics: true, // \"unknown_dimensions_block=true\"\n    allowedCities: [\"Pärnu\", \"Tallinn\", \"Tartu\", \"Narva\"]\n};\n\nexport enum ResolutionCode {\n    ELIGIBLE = \"ELIGIBLE\",\n    CITY_NOT_SUPPORTED = \"CITY_NOT_SUPPORTED\",\n    ITEM_TOO_HEAVY = \"ITEM_TOO_HEAVY\", // Per item limit\n    ITEM_TOO_LARGE = \"ITEM_TOO_LARGE\", // Per item limit\n    CART_TOO_HEAVY = \"CART_TOO_HEAVY\", // Total limit\n    CART_TOO_LARGE = \"CART_TOO_LARGE\", // Total limit\n    OVER_ITEMS = \"OVER_ITEMS\", // Count limit\n    BULKY_ITEMS = \"BULKY_ITEMS\",\n    FRAGILE_ITEMS = \"FRAGILE_ITEMS\",\n    HAZMAT_ITEMS = \"HAZMAT_ITEMS\",\n    UNKNOWN_LOGISTICS = \"UNKNOWN_LOGISTICS\", // Generic unknown\n    MISSING_DIMENSIONS = \"MISSING_DIMENSIONS\", // Specific missing dims\n    MANUAL_BLOCK = \"MANUAL_BLOCK\", // deliveryAllowedWolt === false\n}\n\nexport interface WoltEligibility {\n    state: \"eligible\" | \"partial\" | \"blocked\";\n    reason_code: string | null; // Top level reason\n    reasons?: Array<{ code: string; message_key?: string }>;\n    totals: {\n        weight_kg: number;\n        volume_cm3: number;\n        longest_side_cm: number;\n        max_side_cm: number;\n    };\n    limits: typeof DELIVERY_LIMITS;\n    eligibleItems: Array<{ id?: string; sku?: string; qty: number }>; // Minimal item ref\n    ineligibleItems: Array<{ id?: string; reasons: string[] }>;\n}\n\nexport function checkDeliveryEligibility<T extends { weightKg?: number; volumeM3?: number; lengthCm?: number; widthCm?: number; heightCm?: number; deliveryAllowedWolt?: boolean; bulky?: boolean; hazmat?: boolean; sensitive?: boolean; fragile?: boolean; deliveryClass?: string; qty: number; name: string; id?: string }>(items: T[], city: string): WoltEligibility {\n\n    // 1. Calculate Totals\n    let totalWeight = 0;\n    let totalVolume = 0;\n    let maxLongest = 0;\n    let maxSide = 0;\n\n    items.forEach(item => {\n        totalWeight += (item.weightKg || 0) * item.qty;\n        totalVolume += (item.volumeM3 || 0) * item.qty;\n\n        if (item.lengthCm && item.widthCm && item.heightCm) {\n            const sides = [item.lengthCm, item.widthCm, item.heightCm].sort((a, b) => b - a);\n            if (sides[0] > maxLongest) maxLongest = sides[0];\n            if (sides[1] > maxSide) maxSide = sides[1];\n        }\n    });\n\n    const totals = {\n        weight_kg: totalWeight,\n        volume_cm3: totalVolume * 1000000, // m3 to cm3 if needed, or keep m3? Prompt said volume_cm3. 0.06m3 = 60000cm3\n        longest_side_cm: maxLongest,\n        max_side_cm: maxSide\n    };\n\n    // 2. City Check\n    if (!DELIVERY_LIMITS.allowedCities.includes(city)) {\n        return {\n            state: \"blocked\",\n            reason_code: ResolutionCode.CITY_NOT_SUPPORTED,\n            reasons: [{ code: ResolutionCode.CITY_NOT_SUPPORTED, message_key: \"city_not_supported\" }],\n            totals,\n            limits: DELIVERY_LIMITS,\n            eligibleItems: [],\n            ineligibleItems: items.map(i => ({ id: i.id, reasons: [ResolutionCode.CITY_NOT_SUPPORTED] }))\n        };\n    }\n\n    // 3. Item Level Analysis (Split)\n    const splitResult = splitCart(items);\n\n    // 4. Cart Level Checks\n    const cartReasons: string[] = [];\n\n    // Check if TOTALS exceed limits (even if individual items are fine, the sum might be too heavy)\n    if (totalWeight > DELIVERY_LIMITS.maxWeightKg) cartReasons.push(ResolutionCode.CART_TOO_HEAVY);\n    if (totalVolume > DELIVERY_LIMITS.maxVolumeM3) cartReasons.push(ResolutionCode.CART_TOO_LARGE);\n    if (items.reduce((acc, i) => acc + i.qty, 0) > DELIVERY_LIMITS.maxItems) cartReasons.push(ResolutionCode.OVER_ITEMS);\n\n    // Determine State\n    let state: \"eligible\" | \"partial\" | \"blocked\" = \"eligible\";\n\n    // If cart limits exceeded -> Blocked (usually) or Partial if we assume splitting works for cart limits too?\n    // User logic: \"If state=partial... split cart automatically\". \n    // Usually CART_TOO_HEAVY means the WHOLE order is too heavy. But maybe we can split?\n    // For now, if cart global limits are exceeded, it's often BLOCKED unless we split into multiple Wolt orders (not supported yet).\n    // Let's assume CART_TOO_HEAVY blocks the whole specific delivery unless items are split.\n\n    // Logic:\n    // If ANY ineligible items exist -> PARTIAL (unless all are ineligible -> BLOCKED/PARTIAL?)\n    // If NO ineligible items, but CART limits exceeded -> BLOCKED (or split required)\n\n    if (splitResult.ineligibleItems.length > 0) {\n        state = splitResult.eligibleItems.length > 0 ? \"partial\" : \"blocked\";\n    }\n\n    // If perfectly clean split said OK, but total weight is huge?\n    // Actually splitCart handles item limits. Global limits are separate.\n    // If global cart weight > 20kg, even if all items are small, we can't send it in ONE wolt order.\n    // We'll mark it as BLOCKED or PARTIAL? The prompt says \"Split cart into Wolt package and Store package\".\n    // So if it's too heavy, maybe we just take as much as fits? \n    // Complex. Let's keep it simple: If Global Totals exceeded -> BLOCKED (User has to manually reduce).\n    // OR we could technically support partial split for weight too, but that requires knapsack algo.\n    // Current simple logic:\n    if (cartReasons.length > 0) {\n        state = \"blocked\";\n    }\n\n    // Override: If items were split out (e.g. oversize), but the REMAINDER is valid -> PARTIAL.\n    // If we have cartReasons (e.g. Total Weight 50kg), we are blocked. \n    // BUT maybe the user inteded: \"If I have 50kg of items, put 20kg to Wolt and 30kg to Pickup\".\n    // That is complex. Let's stick to: \"Ineligible items are those PHYSICALLY incapable (too big/heavy)\".\n    // If the SUM of ELIGIBLE items is > 20kg, then we are BLOCKED (Total Limit).\n\n    // Check eligible items total weight\n    const eligibleWeight = splitResult.eligibleItems.reduce((s, i) => s + (i.weightKg || 0) * i.qty, 0);\n    if (eligibleWeight > DELIVERY_LIMITS.maxWeightKg) {\n        state = \"blocked\";\n        cartReasons.push(ResolutionCode.CART_TOO_HEAVY);\n    }\n\n    const formattedEligible = splitResult.eligibleItems.map(i => ({ id: i.id, sku: i.id, qty: i.qty }));\n\n    // Ineligible map\n    const formattedIneligible = splitResult.ineligibleItems.map(i => ({\n        id: i.item.id,\n        reasons: i.reasons\n    }));\n\n    // If state is blocked because of cart limits, but we have valid items?\n    // If we have ANY ineligible items, we are at least PARTIAL.\n    // If ALL items are valid but Total Weight > 20kg -> BLOCKED (cannot split a bag of sand easily or multiple bags in one go logic missing).\n\n    let mainReason = \"ELIGIBLE\";\n    if (state !== \"eligible\") {\n        if (cartReasons.length > 0) mainReason = cartReasons[0];\n        else if (formattedIneligible.length > 0) mainReason = formattedIneligible[0].reasons[0]; // Grab first reason of first bad item\n    }\n\n    // If completely blocked (eligible is empty), state is blocked\n    if (formattedEligible.length === 0) state = \"blocked\";\n\n    return {\n        state,\n        reason_code: state === \"eligible\" ? null : mainReason,\n        reasons: cartReasons.map(c => ({ code: c })),\n        totals,\n        limits: DELIVERY_LIMITS,\n        eligibleItems: formattedEligible,\n        ineligibleItems: formattedIneligible\n    };\n}\n\nexport interface SplitItem<T> {\n    item: T;\n    originalQty: number;\n}\n\nexport interface IneligibleItem<T> {\n    item: T;\n    reasons: ResolutionCode[];\n    originalQty: number;\n}\n\n// Output Types\nexport interface SplitResult<T> {\n    eligibleItems: T[];\n    ineligibleItems: IneligibleItem<T>[];\n    eligibleTotals: {\n        totalWeightKg: number;\n        totalVolumeM3: number;\n        totalItems: number;\n    };\n    ineligibleTotals: {\n        totalWeightKg: number;\n        totalVolumeM3: number;\n        totalItems: number;\n    };\n}\n\ninterface ItemTotals {\n    totalWeightKg: number;\n    totalVolumeM3: number;\n    totalItems: number;\n}\n\nexport interface SplitResult<T = any> {\n    eligibleItems: T[];\n    ineligibleItems: IneligibleItem<T>[];\n    eligibleTotals: ItemTotals;\n    ineligibleTotals: ItemTotals;\n    cartTotals: ItemTotals;\n}\n\n/**\n * Splits cart into eligible (Wolt) and ineligible (Pickup/RFQ) items.\n * Handles quantity splitting (e.g. 5 bags ok, 6th bag too heavy).\n */\nexport function splitCart<T extends { weightKg?: number; volumeM3?: number; lengthCm?: number; widthCm?: number; heightCm?: number; deliveryAllowedWolt?: boolean; bulky?: boolean; hazmat?: boolean; fragile?: boolean; deliveryClass?: string; qty: number; id?: string; name: string }>(items: T[]): SplitResult<T> {\n    const eligibleItems: T[] = [];\n    const ineligibleItems: IneligibleItem<T>[] = [];\n\n    let currentWeight = 0;\n    let currentVolume = 0;\n    let currentCount = 0;\n\n    const cartTotals = { totalWeightKg: 0, totalVolumeM3: 0, totalItems: 0 };\n\n    for (const originalItem of items) {\n        // Safe defaults\n        const unitWeight = originalItem.weightKg || 1;\n        const unitVolume = originalItem.volumeM3 || 0.01;\n\n        // Update cart totals\n        cartTotals.totalWeightKg += unitWeight * originalItem.qty;\n        cartTotals.totalVolumeM3 += unitVolume * originalItem.qty;\n        cartTotals.totalItems += originalItem.qty;\n\n        // 1. Check PER-UNIT disqualifiers\n        const reasons: ResolutionCode[] = [];\n\n        // Manual Block\n        if (originalItem.deliveryAllowedWolt === false) reasons.push(ResolutionCode.MANUAL_BLOCK);\n\n        // Logical Constraints (Fragile, Hazmat, Class)\n        if (DELIVERY_LIMITS.disallowBulky && (originalItem.bulky || originalItem.deliveryClass === \"oversize\" || originalItem.deliveryClass === \"heavy\")) reasons.push(ResolutionCode.BULKY_ITEMS);\n        if (DELIVERY_LIMITS.disallowHazmat && originalItem.hazmat) reasons.push(ResolutionCode.HAZMAT_ITEMS);\n        if (DELIVERY_LIMITS.disallowFragile && originalItem.fragile) reasons.push(ResolutionCode.FRAGILE_ITEMS);\n\n        // Dimensions Check\n        if (DELIVERY_LIMITS.requireKnownLogistics) {\n            if (originalItem.lengthCm === undefined || originalItem.widthCm === undefined || originalItem.heightCm === undefined || originalItem.weightKg === undefined) {\n                reasons.push(ResolutionCode.MISSING_DIMENSIONS);\n            }\n        }\n\n        // If dimensions exist, check side limits\n        if (originalItem.lengthCm && originalItem.widthCm && originalItem.heightCm) {\n            const sides = [originalItem.lengthCm, originalItem.widthCm, originalItem.heightCm].sort((a, b) => b - a);\n            const longest = sides[0];\n            const others = sides.slice(1);\n\n            if (longest > DELIVERY_LIMITS.maxLongestSideCm) reasons.push(ResolutionCode.ITEM_TOO_LARGE);\n            if (others.some(s => s > DELIVERY_LIMITS.maxSingleSideCm)) reasons.push(ResolutionCode.ITEM_TOO_LARGE);\n        }\n\n        // Single Unit Limits\n        if (unitWeight > DELIVERY_LIMITS.itemMaxWeightKg) reasons.push(ResolutionCode.ITEM_TOO_HEAVY);\n        if (unitVolume > DELIVERY_LIMITS.itemMaxVolumeM3) reasons.push(ResolutionCode.ITEM_TOO_LARGE);\n\n        if (!DELIVERY_LIMITS.requireKnownLogistics && (originalItem.weightKg === undefined || originalItem.volumeM3 === undefined)) {\n            // Only if we DON'T require strict logs, we might still flag unknown generic\n            reasons.push(ResolutionCode.UNKNOWN_LOGISTICS);\n        }\n\n        // If item is fundamentally ineligible, move WHOLE line to ineligible\n        if (reasons.length > 0) {\n            ineligibleItems.push({ item: originalItem, originalQty: originalItem.qty, reasons });\n            continue;\n        }\n\n        // 2. Try to fit generic items (checking generic limits: Total Weight, Total Volume, Count)\n        let fitQty = 0;\n        let rejectQty = 0;\n\n        for (let i = 0; i < originalItem.qty; i++) {\n            const nextWeight = currentWeight + unitWeight;\n            const nextVolume = currentVolume + unitVolume;\n            const nextCount = currentCount + 1;\n\n            if (nextWeight <= DELIVERY_LIMITS.maxWeightKg &&\n                nextVolume <= DELIVERY_LIMITS.maxVolumeM3 &&\n                nextCount <= DELIVERY_LIMITS.maxItems) {\n\n                // Fits\n                currentWeight = nextWeight;\n                currentVolume = nextVolume;\n                currentCount = nextCount;\n                fitQty++;\n            } else {\n                // Reached limit\n                rejectQty = originalItem.qty - fitQty;\n                break;\n            }\n        }\n\n        // 3. Distribute\n        if (fitQty > 0) {\n            if (fitQty === originalItem.qty) {\n                eligibleItems.push(originalItem);\n            } else {\n                eligibleItems.push({ ...originalItem, qty: fitQty });\n            }\n        }\n\n        if (rejectQty > 0) {\n            const failReasons: ResolutionCode[] = [];\n\n            // Check specific reasons for rejection\n            if (currentWeight + unitWeight > DELIVERY_LIMITS.maxWeightKg) failReasons.push(ResolutionCode.CART_TOO_HEAVY);\n            if (currentVolume + unitVolume > DELIVERY_LIMITS.maxVolumeM3) failReasons.push(ResolutionCode.CART_TOO_LARGE);\n            if (currentCount + 1 > DELIVERY_LIMITS.maxItems) failReasons.push(ResolutionCode.OVER_ITEMS);\n\n            // Fallback\n            if (failReasons.length === 0) failReasons.push(ResolutionCode.CART_TOO_HEAVY);\n\n            ineligibleItems.push({\n                item: { ...originalItem, qty: rejectQty },\n                originalQty: originalItem.qty,\n                reasons: failReasons\n            });\n        }\n    }\n\n    // Helper to sum totals\n    const calcTotals = (list: T[]) => ({\n        totalWeightKg: Number(list.reduce((sum, i) => sum + (i.weightKg || 1) * i.qty, 0).toFixed(2)),\n        totalVolumeM3: Number(list.reduce((sum, i) => sum + (i.volumeM3 || 0.01) * i.qty, 0).toFixed(3)),\n        totalItems: list.reduce((sum, i) => sum + i.qty, 0)\n    });\n\n    const calcIneligibleTotals = (list: IneligibleItem<T>[]) => ({\n        totalWeightKg: Number(list.reduce((sum, i) => sum + (i.item.weightKg || 1) * i.item.qty, 0).toFixed(2)),\n        totalVolumeM3: Number(list.reduce((sum, i) => sum + (i.item.volumeM3 || 0.01) * i.item.qty, 0).toFixed(3)),\n        totalItems: list.reduce((sum, i) => sum + i.item.qty, 0)\n    });\n\n\n    return {\n        eligibleItems,\n        ineligibleItems,\n        eligibleTotals: calcTotals(eligibleItems),\n        ineligibleTotals: calcIneligibleTotals(ineligibleItems),\n        cartTotals: {\n            totalWeightKg: Number(cartTotals.totalWeightKg.toFixed(2)),\n            totalVolumeM3: Number(cartTotals.totalVolumeM3.toFixed(3)),\n            totalItems: cartTotals.totalItems\n        }\n    };\n}\n\nexport type SuggestionType = \"REDUCE_QTY\" | \"MOVE_TO_NONWOLT\" | \"REMOVE_ITEM\";\n\nexport interface SmartSuggestion {\n    type: SuggestionType;\n    itemId: string;\n    itemName: string;\n    fromQty?: number;\n    toQty?: number;\n    reason: ResolutionCode;\n    originalTotals: ItemTotals;\n    newTotals: ItemTotals;\n}\n\n/**\n * Generates a smart suggestion to make the cart eligible for Wolt delivery.\n * Tries to find the minimal change (reduce qty, move item) to satisfy limits.\n */\nexport function getSmartSuggestion<T extends { id?: string; name: string; weightKg?: number; volumeM3?: number; bulky?: boolean; hazmat?: boolean; qty: number }>(\n    items: T[]\n): SmartSuggestion | null {\n    // 1. Calculate current state to see what's wrong\n    const currentWeight = items.reduce((sum, i) => sum + (i.weightKg || 1) * i.qty, 0);\n    const currentVolume = items.reduce((sum, i) => sum + (i.volumeM3 || 0.01) * i.qty, 0);\n    const currentItems = items.reduce((sum, i) => sum + i.qty, 0);\n\n    const totals = { totalWeightKg: currentWeight, totalVolumeM3: currentVolume, totalItems: currentItems };\n\n    // Helper to calculate totals for a hypothetical cart\n    const calcHypotheticalTotals = (list: T[]) => ({\n        totalWeightKg: Number(list.reduce((sum, i) => sum + (i.weightKg || 1) * i.qty, 0).toFixed(2)),\n        totalVolumeM3: Number(list.reduce((sum, i) => sum + (i.volumeM3 || 0.01) * i.qty, 0).toFixed(3)),\n        totalItems: list.reduce((sum, i) => sum + i.qty, 0)\n    });\n\n    // Strategy 1: Bulky Items (Must move)\n    if (DELIVERY_LIMITS.disallowBulky) {\n        const bulkyItem = items.find(i => i.bulky);\n        if (bulkyItem) {\n            // Suggest moving the largest bulky item (or first found)\n            const remainingItems = items.filter(i => i !== bulkyItem);\n            return {\n                type: \"MOVE_TO_NONWOLT\",\n                itemId: bulkyItem.id || bulkyItem.name, // Fallback to name if id missing\n                itemName: bulkyItem.name,\n                reason: ResolutionCode.BULKY_ITEMS,\n                originalTotals: totals,\n                newTotals: calcHypotheticalTotals(remainingItems)\n            };\n        }\n    }\n\n    // Strategy 2: Hazmat Items (Must move)\n    if (DELIVERY_LIMITS.disallowHazmat) {\n        const hazmatItem = items.find(i => i.hazmat);\n        if (hazmatItem) {\n            const remainingItems = items.filter(i => i !== hazmatItem);\n            return {\n                type: \"MOVE_TO_NONWOLT\",\n                itemId: hazmatItem.id || hazmatItem.name,\n                itemName: hazmatItem.name,\n                reason: ResolutionCode.HAZMAT_ITEMS,\n                originalTotals: totals,\n                newTotals: calcHypotheticalTotals(remainingItems)\n            };\n        }\n    }\n\n    // Strategy 3: Over Weight\n    if (currentWeight > DELIVERY_LIMITS.maxWeightKg) {\n        // Find item with highest total weight contribution\n        const heaviestItem = [...items].sort((a, b) => ((b.weightKg || 1) * b.qty) - ((a.weightKg || 1) * a.qty))[0];\n\n        if (heaviestItem) {\n            const unitWeight = heaviestItem.weightKg || 1;\n            const overweightAmount = currentWeight - DELIVERY_LIMITS.maxWeightKg;\n            const minRemoveQty = Math.ceil(overweightAmount / unitWeight);\n\n            if (minRemoveQty < heaviestItem.qty) {\n                // We can reduce quantity\n                const newQty = heaviestItem.qty - minRemoveQty;\n                const modifiedItem = { ...heaviestItem, qty: newQty };\n                const otherItems = items.filter(i => i !== heaviestItem);\n                const newCart = [...otherItems, modifiedItem];\n\n                return {\n                    type: \"REDUCE_QTY\",\n                    itemId: heaviestItem.id || heaviestItem.name,\n                    itemName: heaviestItem.name,\n                    fromQty: heaviestItem.qty,\n                    toQty: newQty,\n                    reason: ResolutionCode.CART_TOO_HEAVY,\n                    originalTotals: totals,\n                    newTotals: calcHypotheticalTotals(newCart)\n                };\n            } else {\n                // Must remove entire item to fix weight (or it's single item)\n                const remainingItems = items.filter(i => i !== heaviestItem);\n                return {\n                    type: \"REMOVE_ITEM\",\n                    itemId: heaviestItem.id || heaviestItem.name,\n                    itemName: heaviestItem.name,\n                    reason: ResolutionCode.CART_TOO_HEAVY,\n                    originalTotals: totals,\n                    newTotals: calcHypotheticalTotals(remainingItems)\n                };\n            }\n        }\n    }\n\n    // Strategy 4: Over Volume\n    if (currentVolume > DELIVERY_LIMITS.maxVolumeM3) {\n        // Find item with highest total volume\n        const largestItem = [...items].sort((a, b) => ((b.volumeM3 || 0.01) * b.qty) - ((a.volumeM3 || 0.01) * a.qty))[0];\n\n        if (largestItem) {\n            const unitVol = largestItem.volumeM3 || 0.01;\n            const overVol = currentVolume - DELIVERY_LIMITS.maxVolumeM3;\n            const minRemoveQty = Math.ceil(overVol / unitVol);\n\n            if (minRemoveQty < largestItem.qty) {\n                const newQty = largestItem.qty - minRemoveQty;\n                const modifiedItem = { ...largestItem, qty: newQty };\n                const newCart = [...items.filter(i => i !== largestItem), modifiedItem];\n\n                return {\n                    type: \"REDUCE_QTY\",\n                    itemId: largestItem.id || largestItem.name,\n                    itemName: largestItem.name,\n                    fromQty: largestItem.qty,\n                    toQty: newQty,\n                    reason: ResolutionCode.CART_TOO_LARGE,\n                    originalTotals: totals,\n                    newTotals: calcHypotheticalTotals(newCart)\n                };\n            } else {\n                const remainingItems = items.filter(i => i !== largestItem);\n                return {\n                    type: \"REMOVE_ITEM\",\n                    itemId: largestItem.id || largestItem.name,\n                    itemName: largestItem.name,\n                    reason: ResolutionCode.CART_TOO_LARGE,\n                    originalTotals: totals,\n                    newTotals: calcHypotheticalTotals(remainingItems)\n                };\n            }\n        }\n    }\n\n    // Strategy 5: Over Items (Count)\n    if (currentItems > DELIVERY_LIMITS.maxItems) {\n        // Reduced logic as per prompt\n        const sorted = [...items].sort((a, b) => {\n            const scoreA = (a.weightKg || 0) + (a.volumeM3 || 0) * 1000;\n            const scoreB = (b.weightKg || 0) + (b.volumeM3 || 0) * 1000;\n            return scoreA - scoreB;\n        });\n\n        const targetItem = sorted[0];\n        const overCount = currentItems - DELIVERY_LIMITS.maxItems;\n        // Try to reduce its qty\n        if (targetItem.qty > overCount) {\n            const newQty = targetItem.qty - overCount;\n            const modifiedItem = { ...targetItem, qty: newQty };\n            const newCart = [...items.filter(i => i !== targetItem), modifiedItem];\n            return {\n                type: \"REDUCE_QTY\",\n                itemId: targetItem.id || targetItem.name,\n                itemName: targetItem.name,\n                fromQty: targetItem.qty,\n                toQty: newQty,\n                reason: ResolutionCode.OVER_ITEMS,\n                originalTotals: totals,\n                newTotals: calcHypotheticalTotals(newCart)\n            };\n        } else {\n            // Remove whole item\n            const remainingItems = items.filter(i => i !== targetItem);\n            return {\n                type: \"REMOVE_ITEM\",\n                itemId: targetItem.id || targetItem.name,\n                itemName: targetItem.name,\n                reason: ResolutionCode.OVER_ITEMS,\n                originalTotals: totals,\n                newTotals: calcHypotheticalTotals(remainingItems)\n            };\n        }\n    }\n\n    return null;\n}\n\nexport const CITIES = [\"Tallinn\", \"Tartu\", \"Narva\", \"Pärnu\", \"Kohtla-Järve\", \"Viljandi\", \"Rakvere\", \"Haapsalu\", \"Kuressaare\"];\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/login/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[972,975],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[972,975],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1573,1576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1573,1576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2994,2997],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2994,2997],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3947,3950],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3947,3950],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5163,5166],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5163,5166],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5681,5684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5681,5684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { supabase, signInWithOAuth } from '../lib/supabaseClient';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport { useLanguage } from '@/components/i18n/LanguageProvider';\n\nexport default function LoginPage() {\n    const { t } = useLanguage();\n    const [email, setEmail] = useState('');\n    const [password, setPassword] = useState('');\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState<string | null>(null);\n    const router = useRouter();\n\n    const handleLogin = async (e: React.FormEvent) => {\n        e.preventDefault();\n        setLoading(true);\n        setError(null);\n\n        try {\n            const { error } = await supabase.auth.signInWithPassword({\n                email,\n                password,\n            });\n\n            if (error) throw error;\n            router.push('/');\n            router.refresh();\n        } catch (err: any) {\n            // Basic error translation\n            const msg = err.message === 'Invalid login credentials'\n                ? 'Vale e-post või parool'\n                : 'Viga sisenemisel: ' + err.message;\n            setError(msg);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"min-h-[calc(100vh-64px)] flex items-center justify-center bg-slate-50 px-4\">\n            <div className=\"bg-white p-8 rounded-2xl shadow-sm border border-slate-100 w-full max-w-md\">\n                <h1 className=\"text-2xl font-bold text-center mb-6\">{(t as any).auth?.login || \"Sisene kontole\"}</h1>\n\n                {/* Social Login Buttons */}\n                <div className=\"space-y-3 mb-6\">\n                    <button\n                        onClick={() => signInWithOAuth('google')}\n                        disabled={loading}\n                        className=\"w-full flex items-center justify-center gap-3 px-4 py-2.5 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors text-slate-700 font-medium disabled:opacity-50\"\n                    >\n                        {/* Google Icon */}\n                        <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\">\n                            <path d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\" fill=\"#4285F4\" />\n                            <path d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\" fill=\"#34A853\" />\n                            <path d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.26.81-.58z\" fill=\"#FBBC05\" />\n                            <path d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\" fill=\"#EA4335\" />\n                        </svg>\n                        {(t as any).auth?.continue_with_google || \"Jätka Google’iga\"}\n                    </button>\n\n                    <button\n                        onClick={() => signInWithOAuth('facebook')}\n                        disabled={loading}\n                        className=\"w-full flex items-center justify-center gap-3 px-4 py-2.5 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors text-slate-700 font-medium disabled:opacity-50\"\n                    >\n                        {/* Facebook Icon */}\n                        <svg className=\"w-5 h-5 text-[#1877F2]\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path d=\"M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.581c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a8.68 8.68 0 0 1 1.141.195v3.325a8.623 8.623 0 0 0-.653-.036c-2.148 0-2.797 1.603-2.797 4.16v1.922h5.083l-1.109 3.667h-3.974v7.98h-5.026z\" />\n                        </svg>\n                        {(t as any).auth?.continue_with_facebook || \"Jätka Facebook’iga\"}\n                    </button>\n\n                    <button\n                        onClick={() => signInWithOAuth('apple')}\n                        disabled={loading}\n                        className=\"w-full flex items-center justify-center gap-3 px-4 py-2.5 bg-black text-white rounded-lg hover:bg-slate-800 transition-colors font-medium disabled:opacity-50\"\n                    >\n                        {/* Apple Icon */}\n                        <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path d=\"M12.152 6.896c-.948 0-2.415-1.078-3.96-1.04-2.04.027-3.91 1.183-4.961 3.014-2.117 3.675-.546 9.103 1.519 12.09 1.013 1.454 2.208 3.09 3.792 3.039 1.52-.065 2.09-.987 3.935-.987 1.831 0 2.35.987 3.96.948 1.637-.026 2.676-1.48 3.676-2.948 1.156-1.688 1.636-3.325 1.662-3.415-.039-.013-3.182-1.221-3.22-4.857-.027-3.04 2.48-4.508 2.597-4.598-1.429-2.09-3.623-2.324-4.403-2.363-2-.08-3.675 1.04-4.61 1.04zm4.961-4.47c.546 1.052.701 2.325.701 3.597 1.182.027 2.455-.494 3.013-1.48.559-1.027.676-2.287.676-3.443-1.324.013-2.52.545-3.091 1.325z\" />\n                        </svg>\n                        {(t as any).auth?.continue_with_apple || \"Jätka Apple’iga\"}\n                    </button>\n                </div>\n\n                <div className=\"relative my-6\">\n                    <div className=\"absolute inset-0 flex items-center\">\n                        <div className=\"w-full border-t border-slate-200\"></div>\n                    </div>\n                    <div className=\"relative flex justify-center text-sm\">\n                        <span className=\"px-2 bg-white text-slate-500\">\n                            {(t as any).auth?.or_email || \"või e-postiga\"}\n                        </span>\n                    </div>\n                </div>\n\n                {error && (\n                    <div className=\"bg-red-50 text-red-600 p-3 rounded-lg mb-4 text-sm\">\n                        {error}\n                    </div>\n                )}\n\n                <form onSubmit={handleLogin} className=\"space-y-4\">\n                    <div>\n                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">E-post</label>\n                        <input\n                            type=\"email\"\n                            value={email}\n                            onChange={(e) => setEmail(e.target.value)}\n                            className=\"w-full px-4 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-orange-500\"\n                            required\n                        />\n                    </div>\n                    <div>\n                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">Parool</label>\n                        <input\n                            type=\"password\"\n                            value={password}\n                            onChange={(e) => setPassword(e.target.value)}\n                            className=\"w-full px-4 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-orange-500\"\n                            required\n                        />\n                    </div>\n                    <button\n                        type=\"submit\"\n                        disabled={loading}\n                        className=\"w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 rounded-lg transition-colors disabled:opacity-50\"\n                    >\n                        {loading ? 'Sisenemine...' : 'Logi sisse'}\n                    </button>\n                </form>\n\n                <p className=\"mt-4 text-center text-sm text-slate-600\">\n                    Pole kontot?{' '}\n                    <Link href=\"/register\" className=\"text-orange-600 hover:text-orange-700 font-medium\">\n                        Loo konto\n                    </Link>\n                </p>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/meist/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[271,274],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[271,274],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport Link from \"next/link\";\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\nimport { ArrowRight, Mail, Phone, MapPin } from \"lucide-react\";\n\nexport default function AboutPage() {\n    const { t } = useLanguage();\n    const about = (t as any).about || {};\n\n    return (\n        <div className=\"bg-slate-50 min-h-screen\">\n            {/* Hero */}\n            <div className=\"bg-slate-900 text-white py-20 px-6 text-center bg-pattern-subtle\">\n                <div className=\"max-w-3xl mx-auto space-y-4\">\n                    <h1 className=\"text-4xl md:text-5xl font-bold tracking-tight\">\n                        {about.title || \"SmartBuildist\"}\n                    </h1>\n                    <p className=\"text-slate-400 text-lg md:text-xl\">\n                        {about.subtitle || \"Sõltumatu hinnavõrdlusportaal targale ehitajale.\"}\n                    </p>\n                </div>\n            </div>\n\n            {/* Content */}\n            <div className=\"container mx-auto px-4 py-16 grid md:grid-cols-2 gap-12 max-w-5xl\">\n                <div className=\"space-y-6 text-lg text-slate-700 leading-relaxed\">\n                    <p>{about.desc_1}</p>\n                    <p>{about.desc_2}</p>\n\n                    <div className=\"pt-6\">\n                        <Link\n                            href=\"/products\"\n                            className=\"inline-flex items-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold px-8 py-3 rounded-xl transition-all shadow-lg shadow-emerald-600/20\"\n                        >\n                            {about.back_catalog || \"Tagasi kataloogi\"}\n                            <ArrowRight size={20} />\n                        </Link>\n                    </div>\n                </div>\n\n                {/* Contact Card */}\n                <div className=\"bg-white p-8 rounded-2xl shadow-sm border border-slate-200 h-fit\">\n                    <h3 className=\"text-xl font-bold text-slate-900 mb-6\">{about.contact_title || \"Kontakt\"}</h3>\n                    <div className=\"space-y-4\">\n                        <div className=\"flex items-center gap-4 text-slate-600\">\n                            <div className=\"w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center text-slate-500 shrink-0\">\n                                <Mail size={20} />\n                            </div>\n                            <span className=\"font-medium\">{about.email}</span>\n                        </div>\n                        <div className=\"flex items-center gap-4 text-slate-600\">\n                            <div className=\"w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center text-slate-500 shrink-0\">\n                                <Phone size={20} />\n                            </div>\n                            <span className=\"font-medium\">{about.phone}</span>\n                        </div>\n                        <div className=\"flex items-center gap-4 text-slate-600\">\n                            <div className=\"w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center text-slate-500 shrink-0\">\n                                <MapPin size={20} />\n                            </div>\n                            <span className=\"font-medium\">{about.address}</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/not-found.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/opengraph-image.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Link"},"fix":{"range":[0,29],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Link from \"next/link\";\nimport type { Metadata } from \"next\";\nimport ClientHomeTracker from \"./ClientHomeTracker\";\nimport TrustLogos from \"@/components/home/TrustLogos\";\nimport HowItWorks from \"@/components/home/HowItWorks\";\nimport Hero from \"@/components/home/Hero\";\nimport SeoBlock from \"@/components/home/SeoBlock\";\nimport FinalCTA from \"@/components/home/FinalCTA\";\n\nexport const metadata: Metadata = {\n    title: \"Ehitusmaterjalide hinnavõrdlus — SmartBuild Eesti\",\n    description: \"Võrdle ehitusmaterjalide hindu: Bauhof, K-Rauta, Espak, Decora. Leia parim pakkumine ja säästa aega. Tasuta hinnapäring kõigile poodidele.\",\n};\n\nexport default function HomePage() {\n    return (\n        <main className=\"min-h-screen bg-white\">\n            <ClientHomeTracker />\n\n            {/* HERO Section (Client Component) */}\n            <Hero />\n\n            {/* SEO Text Block (Client Component) */}\n            <SeoBlock />\n\n            {/* TRUST LOGOS */}\n            <TrustLogos />\n\n            {/* PROCESS */}\n            <HowItWorks />\n\n            {/* Final CTA link (Client Component) */}\n            <FinalCTA />\n        </main>\n    );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/partner-dashboard/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/partner/dashboard/DashboardClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle2' is defined but never used.","line":9,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":17,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CheckCircle2"},"fix":{"range":[109,127],"text":""},"desc":"Remove unused variable \"CheckCircle2\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertCircle' is defined but never used.","line":10,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"AlertCircle"},"fix":{"range":[127,144],"text":""},"desc":"Remove unused variable \"AlertCircle\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setLeads' is assigned a value but never used.","line":58,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":58,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState } from \"react\";\nimport {\n    Users,\n    FileText,\n    TrendingUp,\n    MapPin,\n    CheckCircle2,\n    AlertCircle,\n    PauseCircle,\n    PlayCircle,\n    Search\n} from \"lucide-react\";\n\n// --- MOCKED DATA TYPES ---\n\ntype Manager = {\n    id: string;\n    name: string;\n    email: string;\n    city: string;\n    status: 'ACTIVE' | 'PAUSED';\n    leadsCount: number;\n    lastActive: string;\n};\n\ntype Lead = {\n    id: string;\n    date: string;\n    city: string;\n    customerType: 'B2C' | 'B2B';\n    productCount: number;\n    summary: string;\n    assignedTo: string; // Manager Name\n    status: 'NEW' | 'OPEN' | 'WON' | 'LOST';\n};\n\n// --- MOCKED INITIAL STATE (Simulation of DB) ---\n\nconst INITIAL_MANAGERS: Manager[] = [\n    { id: '1', name: 'Tiit Kask', email: 'tiit@espak.ee', city: 'Pärnu', status: 'ACTIVE', leadsCount: 142, lastActive: '10 min tagasi' },\n    { id: '2', name: 'Leida Pärn', email: 'leida@espak.ee', city: 'Pärnu', status: 'ACTIVE', leadsCount: 138, lastActive: '2 min tagasi' },\n    { id: '3', name: 'Mart Mets', email: 'mart@espak.ee', city: 'Tallinn', status: 'PAUSED', leadsCount: 89, lastActive: '2 päeva tagasi' },\n    { id: '4', name: 'Anna Tamm', email: 'anna@espak.ee', city: 'Tallinn', status: 'ACTIVE', leadsCount: 201, lastActive: 'Nüüd' },\n];\n\nconst INITIAL_LEADS: Lead[] = [\n    { id: 'L-2024-001', date: '16.01.2026', city: 'Pärnu', customerType: 'B2B', productCount: 45, summary: 'Fibo plokid + armatuur', assignedTo: 'Tiit Kask', status: 'NEW' },\n    { id: 'L-2024-002', date: '16.01.2026', city: 'Tallinn', customerType: 'B2C', productCount: 12, summary: 'Vannitoa plaadid', assignedTo: 'Anna Tamm', status: 'OPEN' },\n    { id: 'L-2024-003', date: '15.01.2026', city: 'Pärnu', customerType: 'B2B', productCount: 120, summary: 'Katusetarvikud (Suur)', assignedTo: 'Leida Pärn', status: 'WON' },\n    { id: 'L-2024-004', date: '15.01.2026', city: 'Tallinn', customerType: 'B2C', productCount: 5, summary: 'Värvid ja pintslid', assignedTo: 'Anna Tamm', status: 'LOST' },\n    { id: 'L-2024-005', date: '14.01.2026', city: 'Pärnu', customerType: 'B2B', productCount: 30, summary: 'Soojustusvill', assignedTo: 'Tiit Kask', status: 'WON' },\n];\n\nexport default function DashboardClient() {\n    const [managers, setManagers] = useState<Manager[]>(INITIAL_MANAGERS);\n    const [leads, setLeads] = useState<Lead[]>(INITIAL_LEADS);\n    const [filterCity, setFilterCity] = useState<string>('all');\n\n    const toggleManagerStatus = (id: string) => {\n        setManagers(prev => prev.map(m =>\n            m.id === id\n                ? { ...m, status: m.status === 'ACTIVE' ? 'PAUSED' : 'ACTIVE' }\n                : m\n        ));\n    };\n\n    const activeManagersCount = managers.filter(m => m.status === 'ACTIVE').length;\n    const totalLeadsToday = leads.filter(l => l.date === '16.01.2026').length;\n\n    const filteredLeads = filterCity === 'all' ? leads : leads.filter(l => l.city.toLowerCase() === filterCity.toLowerCase());\n    const filteredManagers = filterCity === 'all' ? managers : managers.filter(m => m.city.toLowerCase() === filterCity.toLowerCase());\n\n    return (\n        <div className=\"space-y-8\">\n            {/* STATS ROW */}\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                <div className=\"bg-white p-6 rounded-2xl border border-slate-200 shadow-sm flex items-center gap-4\">\n                    <div className=\"w-12 h-12 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center\">\n                        <FileText size={24} />\n                    </div>\n                    <div>\n                        <div className=\"text-2xl font-bold text-slate-900\">{totalLeadsToday}</div>\n                        <div className=\"text-sm text-slate-500\">Uut päringut täna</div>\n                    </div>\n                </div>\n                <div className=\"bg-white p-6 rounded-2xl border border-slate-200 shadow-sm flex items-center gap-4\">\n                    <div className=\"w-12 h-12 rounded-full bg-emerald-50 text-emerald-600 flex items-center justify-center\">\n                        <Users size={24} />\n                    </div>\n                    <div>\n                        <div className=\"text-2xl font-bold text-slate-900\">{activeManagersCount} / {managers.length}</div>\n                        <div className=\"text-sm text-slate-500\">Müügijuhti aktiivsed</div>\n                    </div>\n                </div>\n                <div className=\"bg-white p-6 rounded-2xl border border-slate-200 shadow-sm flex items-center gap-4\">\n                    <div className=\"w-12 h-12 rounded-full bg-purple-50 text-purple-600 flex items-center justify-center\">\n                        <TrendingUp size={24} />\n                    </div>\n                    <div>\n                        <div className=\"text-2xl font-bold text-slate-900\">42%</div>\n                        <div className=\"text-sm text-slate-500\">B2B osakaal</div>\n                    </div>\n                </div>\n            </div>\n\n            {/* FILTERS */}\n            <div className=\"flex gap-2\">\n                <button\n                    onClick={() => setFilterCity('all')}\n                    className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${filterCity === 'all' ? 'bg-slate-800 text-white' : 'bg-white text-slate-600 border border-slate-200 hover:bg-slate-50'}`}\n                >\n                    Kõik linnad\n                </button>\n                <button\n                    onClick={() => setFilterCity('Tallinn')}\n                    className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${filterCity === 'Tallinn' ? 'bg-slate-800 text-white' : 'bg-white text-slate-600 border border-slate-200 hover:bg-slate-50'}`}\n                >\n                    Tallinn\n                </button>\n                <button\n                    onClick={() => setFilterCity('Pärnu')}\n                    className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${filterCity === 'Pärnu' ? 'bg-slate-800 text-white' : 'bg-white text-slate-600 border border-slate-200 hover:bg-slate-50'}`}\n                >\n                    Pärnu\n                </button>\n            </div>\n\n            {/* MANAGERS TABLE */}\n            <div className=\"bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden\">\n                <div className=\"px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50\">\n                    <h3 className=\"font-bold text-slate-800 flex items-center gap-2\">\n                        <Users size={18} />\n                        Müügimeeskond ja Staatus\n                    </h3>\n                    <div className=\"text-xs text-slate-400\">\n                        Automaatne tööjaotus (Round-Robin)\n                    </div>\n                </div>\n                <div className=\"overflow-x-auto\">\n                    <table className=\"w-full text-left text-sm\">\n                        <thead className=\"bg-slate-50 text-slate-500\">\n                            <tr>\n                                <th className=\"px-6 py-3 font-medium\">Nimi</th>\n                                <th className=\"px-6 py-3 font-medium\">Linn</th>\n                                <th className=\"px-6 py-3 font-medium\">Päringuid kokku</th>\n                                <th className=\"px-6 py-3 font-medium\">Staatus</th>\n                                <th className=\"px-6 py-3 font-medium text-right\">Tegevus</th>\n                            </tr>\n                        </thead>\n                        <tbody className=\"divide-y divide-slate-100\">\n                            {filteredManagers.map(m => (\n                                <tr key={m.id} className=\"hover:bg-slate-50/50\">\n                                    <td className=\"px-6 py-4\">\n                                        <div className=\"font-medium text-slate-900\">{m.name}</div>\n                                        <div className=\"text-xs text-slate-500\">{m.email}</div>\n                                    </td>\n                                    <td className=\"px-6 py-4 text-slate-600\">\n                                        <div className=\"inline-flex items-center gap-1 bg-slate-100 px-2 py-1 rounded text-xs\">\n                                            <MapPin size={10} /> {m.city}\n                                        </div>\n                                    </td>\n                                    <td className=\"px-6 py-4 font-mono text-slate-600\">{m.leadsCount}</td>\n                                    <td className=\"px-6 py-4\">\n                                        {m.status === 'ACTIVE' ? (\n                                            <span className=\"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-bold bg-emerald-100 text-emerald-700\">\n                                                <span className=\"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse\"></span>\n                                                AKTIIVNE\n                                            </span>\n                                        ) : (\n                                            <span className=\"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-bold bg-amber-100 text-amber-700\">\n                                                <span className=\"w-1.5 h-1.5 rounded-full bg-amber-500\"></span>\n                                                PAUSIL\n                                            </span>\n                                        )}\n                                    </td>\n                                    <td className=\"px-6 py-4 text-right\">\n                                        <button\n                                            onClick={() => toggleManagerStatus(m.id)}\n                                            className={`text-xs font-bold px-3 py-1.5 rounded-lg transition-colors border ${m.status === 'ACTIVE'\n                                                    ? 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50'\n                                                    : 'bg-emerald-50 border-emerald-200 text-emerald-700 hover:bg-emerald-100'\n                                                }`}\n                                        >\n                                            {m.status === 'ACTIVE' ? (\n                                                <span className=\"flex items-center gap-1\"><PauseCircle size={14} /> Pane pausile</span>\n                                            ) : (\n                                                <span className=\"flex items-center gap-1\"><PlayCircle size={14} /> Aktiveeri</span>\n                                            )}\n                                        </button>\n                                    </td>\n                                </tr>\n                            ))}\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n\n            {/* RECENT LEADS TABLE */}\n            <div className=\"bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden\">\n                <div className=\"px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50\">\n                    <h3 className=\"font-bold text-slate-800 flex items-center gap-2\">\n                        <FileText size={18} />\n                        Viimased hinnapäringud\n                    </h3>\n                    <div className=\"relative\">\n                        <input\n                            placeholder=\"Otsi...\"\n                            className=\"pl-8 pr-3 py-1.5 text-xs rounded-lg border border-slate-200 outline-none focus:border-blue-400 w-48\"\n                        />\n                        <Search size={14} className=\"absolute left-2.5 top-1.5 text-slate-400\" />\n                    </div>\n                </div>\n                <div className=\"overflow-x-auto\">\n                    <table className=\"w-full text-left text-sm\">\n                        <thead className=\"bg-slate-50 text-slate-500\">\n                            <tr>\n                                <th className=\"px-6 py-3 font-medium\">Kuupäev</th>\n                                <th className=\"px-6 py-3 font-medium\">Linn</th>\n                                <th className=\"px-6 py-3 font-medium\">Klient</th>\n                                <th className=\"px-6 py-3 font-medium\">Sisu</th>\n                                <th className=\"px-6 py-3 font-medium\">Vastutaja</th>\n                                <th className=\"px-6 py-3 font-medium text-right\">Staatus</th>\n                            </tr>\n                        </thead>\n                        <tbody className=\"divide-y divide-slate-100\">\n                            {filteredLeads.map(lead => (\n                                <tr key={lead.id} className=\"hover:bg-slate-50/50\">\n                                    <td className=\"px-6 py-4 text-slate-500 font-mono text-xs\">{lead.date}</td>\n                                    <td className=\"px-6 py-4 text-slate-600\">{lead.city}</td>\n                                    <td className=\"px-6 py-4\">\n                                        {lead.customerType === 'B2B' ? (\n                                            <span className=\"text-xs font-bold bg-blue-100 text-blue-700 px-2 py-0.5 rounded\">ÄRIKLIENT</span>\n                                        ) : (\n                                            <span className=\"text-xs font-bold bg-slate-100 text-slate-600 px-2 py-0.5 rounded\">ERAISIK</span>\n                                        )}\n                                    </td>\n                                    <td className=\"px-6 py-4 text-slate-900 font-medium\">\n                                        {lead.summary}\n                                        <div className=\"text-xs text-slate-400\">{lead.productCount} toodet</div>\n                                    </td>\n                                    <td className=\"px-6 py-4 text-slate-600 flex items-center gap-2\">\n                                        <div className=\"w-6 h-6 rounded-full bg-slate-200 flex items-center justify-center text-xs font-bold text-slate-600\">\n                                            {lead.assignedTo.substring(0, 1)}\n                                        </div>\n                                        {lead.assignedTo}\n                                    </td>\n                                    <td className=\"px-6 py-4 text-right\">\n                                        {lead.status === 'NEW' && <span className=\"text-xs font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded\">UUS</span>}\n                                        {lead.status === 'OPEN' && <span className=\"text-xs font-bold text-slate-600 bg-slate-100 px-2 py-1 rounded\">TÖÖS</span>}\n                                        {lead.status === 'WON' && <span className=\"text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded\">MÜÜDUD</span>}\n                                        {lead.status === 'LOST' && <span className=\"text-xs font-bold text-red-600 bg-red-50 px-2 py-1 rounded\">LOOBUD</span>}\n                                    </td>\n                                </tr>\n                            ))}\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n\n            <div className=\"text-center text-xs text-slate-400 mt-8\">\n                Andmed uuenevad reaalajas. Viimane sünkroniseerimine: {new Date().toLocaleTimeString()}\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/partner/dashboard/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/partner/delivery/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/partner/import/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used.","line":5,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":41,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CheckCircle"},"fix":{"range":[140,153],"text":""},"desc":"Remove unused variable \"CheckCircle\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertTriangle' is defined but never used.","line":5,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":56,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"AlertTriangle"},"fix":{"range":[153,168],"text":""},"desc":"Remove unused variable \"AlertTriangle\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used.","line":5,"column":58,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":66,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"FileText"},"fix":{"range":[168,178],"text":""},"desc":"Remove unused variable \"FileText\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'REQUIRED_FIELDS' is assigned a value but never used.","line":7,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1215,1218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1215,1218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1270,1273],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1270,1273],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3365,3368],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3365,3368],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4288,4291],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4288,4291],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5337,5340],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5337,5340],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { supabase } from \"@/app/lib/supabaseClient\";\nimport { Upload, ArrowRight, CheckCircle, AlertTriangle, FileText, Loader2 } from \"lucide-react\";\n\nconst REQUIRED_FIELDS = ['name_override_et', 'price', 'sku']; // Basic checks on UI side\n\nexport default function PartnerImportPage() {\n    const [step, setStep] = useState<1 | 2 | 3>(1);\n    const [file, setFile] = useState<File | null>(null);\n    const [storeId, setStoreId] = useState<string | null>(null);\n    const [importId, setImportId] = useState<string | null>(null);\n    const [loading, setLoading] = useState(false);\n\n    // Mapping: keys are DB fields, values are CSV headers\n    const [csvHeaders, setCsvHeaders] = useState<string[]>([]);\n    const [mapping, setMapping] = useState<Record<string, string>>({\n        sku: 'SKU',\n        ean: 'EAN',\n        name_override_et: 'Nimi',\n        brand: 'Bränd',\n        price: 'Hind',\n        stock_status: 'Laoseis',\n        weight_kg: 'Kaal',\n        length_cm: 'Pikkus',\n        width_cm: 'Laius',\n        height_cm: 'Kõrgus',\n        hazmat: 'Ohtlik',\n        delivery_allowed_wolt: 'Wolt'\n    });\n\n    const [preview, setPreview] = useState<any[]>([]);\n    const [summary, setSummary] = useState<any>({});\n\n    useEffect(() => {\n        const init = async () => {\n            const { data: { user } } = await supabase.auth.getUser();\n            if (!user) return;\n            const { data: membership } = await supabase.from(\"store_users\").select(\"store_id\").eq(\"user_id\", user.id).single();\n            if (membership) setStoreId(membership.store_id);\n        };\n        init();\n    }, []);\n\n    const handleUpload = async () => {\n        if (!file || !storeId) return;\n        setLoading(true);\n        try {\n            const formData = new FormData();\n            formData.append(\"file\", file);\n            formData.append(\"storeId\", storeId);\n\n            const { data: { session } } = await supabase.auth.getSession();\n            const res = await fetch(\"/api/partner/import/upload\", {\n                method: \"POST\",\n                headers: { \"Authorization\": `Bearer ${session?.access_token}` },\n                body: formData\n            });\n            const json = await res.json();\n            if (json.error) throw new Error(json.error);\n\n            setImportId(json.importId);\n\n            // Read headers for mapping step (simple local read)\n            const text = await file.text();\n            const firstLine = text.split('\\n')[0];\n            const headers = firstLine.split(',').map(h => h.trim().replace(/\"/g, ''));\n            setCsvHeaders(headers);\n\n            // Auto-map if possible\n            const newMap = { ...mapping };\n            headers.forEach(h => {\n                const hl = h.toLowerCase();\n                if (hl.includes('sku')) newMap.sku = h;\n                if (hl.includes('ean')) newMap.ean = h;\n                if (hl.includes('nimi') || hl.includes('name')) newMap.name_override_et = h;\n                if (hl.includes('hind') || hl.includes('price')) newMap.price = h;\n                if (hl.includes('bränd') || hl.includes('brand')) newMap.brand = h;\n                if (hl.includes('kaal') || hl.includes('weight')) newMap.weight_kg = h;\n            });\n            setMapping(newMap);\n\n            setStep(2);\n        } catch (e: any) {\n            alert(e.message);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handlePreview = async () => {\n        if (!importId) return;\n        setLoading(true);\n        try {\n            const { data: { session } } = await supabase.auth.getSession();\n            const res = await fetch(\"/api/partner/import/preview\", {\n                method: \"POST\",\n                headers: {\n                    \"Authorization\": `Bearer ${session?.access_token}`,\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({ importId, mapping })\n            });\n            const json = await res.json();\n            if (json.error) throw new Error(json.error);\n\n            setPreview(json.preview);\n            setSummary({ total: json.totalRows, valid: json.validRows });\n            setStep(3); // Go to preview/apply\n        } catch (e: any) {\n            alert(e.message);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleApply = async () => {\n        if (!importId) return;\n        setLoading(true);\n        try {\n            const { data: { session } } = await supabase.auth.getSession();\n            const res = await fetch(\"/api/partner/import/apply\", {\n                method: \"POST\",\n                headers: {\n                    \"Authorization\": `Bearer ${session?.access_token}`,\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({ importId })\n            });\n            const json = await res.json();\n            if (json.error) throw new Error(json.error);\n\n            setSummary({ ...summary, created: json.created, updated: json.updated, failed: json.failed });\n            alert(`Import tehtud! Lisatud: ${json.created}, Uuendatud: ${json.updated}, Ebaõnnestus: ${json.failed}`);\n            // Reset or Redirect\n            setStep(1); setFile(null);\n        } catch (e: any) {\n            alert(e.message);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"max-w-4xl mx-auto\">\n            <h1 className=\"text-2xl font-bold text-slate-900 mb-2\">Import</h1>\n            <p className=\"text-slate-500 mb-8\">Lae üles CSV fail toodetega.</p>\n\n            {/* Stepper */}\n            <div className=\"flex items-center gap-4 mb-8 text-sm font-bold border-b border-slate-200 pb-4\">\n                <div className={`${step >= 1 ? 'text-emerald-600' : 'text-slate-300'}`}>1. Vali fail</div>\n                <ArrowRight size={16} className=\"text-slate-300\" />\n                <div className={`${step >= 2 ? 'text-emerald-600' : 'text-slate-300'}`}>2. Seadista veerud</div>\n                <ArrowRight size={16} className=\"text-slate-300\" />\n                <div className={`${step >= 3 ? 'text-emerald-600' : 'text-slate-300'}`}>3. Kinnita</div>\n            </div>\n\n            {/* Step 1: Upload */}\n            {step === 1 && (\n                <div className=\"bg-white p-12 rounded-xl border-2 border-dashed border-slate-300 text-center hover:bg-slate-50 transition-colors\">\n                    <input type=\"file\" accept=\".csv\" onChange={e => setFile(e.target.files?.[0] || null)} className=\"hidden\" id=\"file\" />\n                    <label htmlFor=\"file\" className=\"cursor-pointer block\">\n                        <div className=\"w-16 h-16 bg-blue-50 text-blue-500 rounded-full flex items-center justify-center mx-auto mb-4\">\n                            <Upload size={32} />\n                        </div>\n                        <div className=\"font-bold text-lg text-slate-900 mb-2\">\n                            {file ? file.name : \"Vali arvutist CSV fail\"}\n                        </div>\n                        <p className=\"text-slate-500\">\n                            Toetatud formaadid: CSV. Maksimaalselt 5MB.\n                        </p>\n                    </label>\n                    {file && (\n                        <button onClick={handleUpload} disabled={loading} className=\"mt-6 bg-emerald-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-emerald-700 transition-colors flex items-center gap-2 mx-auto\">\n                            {loading ? <Loader2 className=\"animate-spin\" /> : \"Lae üles ja jätka\"}\n                        </button>\n                    )}\n                </div>\n            )}\n\n            {/* Step 2: Mapping */}\n            {step === 2 && (\n                <div className=\"bg-white p-8 rounded-xl border border-slate-200 shadow-sm\">\n                    <h3 className=\"font-bold text-lg mb-6\">Veergude vastavus</h3>\n                    <div className=\"grid md:grid-cols-2 gap-x-12 gap-y-4\">\n                        {Object.keys(mapping).map(key => (\n                            <div key={key} className=\"flex flex-col\">\n                                <label className=\"text-xs font-bold text-slate-500 uppercase mb-1\">{key}</label>\n                                <select\n                                    className=\"p-3 border border-slate-200 rounded-lg bg-slate-50\"\n                                    value={mapping[key]}\n                                    onChange={e => setMapping({ ...mapping, [key]: e.target.value })}\n                                >\n                                    <option value=\"\">-- Ignoreeri --</option>\n                                    {csvHeaders.map(h => (\n                                        <option key={h} value={h}>{h}</option>\n                                    ))}\n                                </select>\n                            </div>\n                        ))}\n                    </div>\n                    <div className=\"mt-8 flex justify-end\">\n                        <button onClick={handlePreview} disabled={loading} className=\"bg-emerald-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-emerald-700 transition-colors flex items-center gap-2\">\n                            {loading ? <Loader2 className=\"animate-spin\" /> : \"Eelvaade ->\"}\n                        </button>\n                    </div>\n                </div>\n            )}\n\n            {/* Step 3: Preview */}\n            {step === 3 && (\n                <div className=\"bg-white p-8 rounded-xl border border-slate-200 shadow-sm\">\n                    <div className=\"flex justify-between items-center mb-6\">\n                        <h3 className=\"font-bold text-lg\">Impordi eelvaade</h3>\n                        <div className=\"flex gap-4 text-sm\">\n                            <div className=\"px-3 py-1 bg-slate-100 rounded-full\">Kokku: <b>{summary.total}</b> rida</div>\n                            {/* In real app, valid is calculated better */}\n                        </div>\n                    </div>\n\n                    <div className=\"overflow-x-auto mb-8 border rounded-lg\">\n                        <table className=\"w-full text-left text-sm\">\n                            <thead className=\"bg-slate-50 text-slate-500 font-bold\">\n                                <tr>\n                                    <th className=\"p-3\">SKU</th>\n                                    <th className=\"p-3\">Nimi</th>\n                                    <th className=\"p-3\">Bränd</th>\n                                    <th className=\"p-3\">Hind</th>\n                                    <th className=\"p-3\">Mõõdud</th>\n                                </tr>\n                            </thead>\n                            <tbody className=\"divide-y\">\n                                {preview.map((row, i) => (\n                                    <tr key={i}>\n                                        <td className=\"p-3 font-mono\">{row.sku || row.ean || \"-\"}</td>\n                                        <td className=\"p-3\">{row.name_override_et}</td>\n                                        <td className=\"p-3\">{row.brand}</td>\n                                        <td className=\"p-3\">{row.price}</td>\n                                        <td className=\"p-3 text-xs text-slate-400\">\n                                            {row.weight_kg}kg, {row.length_cm}x{row.width_cm}x{row.height_cm}\n                                        </td>\n                                    </tr>\n                                ))}\n                            </tbody>\n                        </table>\n                    </div>\n\n                    <div className=\"flex gap-4 justify-end\">\n                        <button onClick={() => setStep(2)} className=\"px-6 py-3 text-slate-600 font-bold hover:bg-slate-100 rounded-lg\">\n                            Tagasi\n                        </button>\n                        <button onClick={handleApply} disabled={loading} className=\"bg-emerald-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-emerald-700 transition-colors flex items-center gap-2\">\n                            {loading ? <Loader2 className=\"animate-spin\" /> : \"Kinnita Import\"}\n                        </button>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/partner/join/JoinForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2533,2536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2533,2536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState } from \"react\";\nimport { Plus, Trash2, CheckCircle2, Building2, User, MapPin, ArrowRight, ArrowLeft, ShieldCheck } from \"lucide-react\";\nimport Link from \"next/link\";\n\n// Predefined cities for quick selection\nconst PREDEFINED_CITIES = [\"Tallinn\", \"Tartu\", \"Pärnu\", \"Narva\", \"Rakvere\", \"Viljandi\"];\n\ntype Manager = {\n    id: string;\n    name: string;\n    email: string;\n    isActive: boolean;\n};\n\ntype StoreDraft = {\n    city: string;\n    storeName: string;\n    generalEmail: string;\n    managers: Manager[];\n};\n\nexport default function JoinForm() {\n    // Wizard State\n    const [currentStep, setCurrentStep] = useState(1);\n    const [isSubmitting, setIsSubmitting] = useState(false);\n    const [isSuccess, setIsSuccess] = useState(false);\n\n    // Form Data\n    const [companyName, setCompanyName] = useState(\"\");\n    const [brandName, setBrandName] = useState(\"\");\n    const [adminEmail, setAdminEmail] = useState(\"\");\n    const [selectedCities, setSelectedCities] = useState<string[]>([]);\n    const [stores, setStores] = useState<Record<string, StoreDraft>>({});\n\n    // --- LOGIC ---\n\n    const toggleCity = (city: string) => {\n        if (selectedCities.includes(city)) {\n            setSelectedCities(prev => prev.filter(c => c !== city));\n            const newStores = { ...stores };\n            delete newStores[city];\n            setStores(newStores);\n        } else {\n            setSelectedCities(prev => [...prev, city]);\n            setStores(prev => ({\n                ...prev,\n                [city]: {\n                    city,\n                    storeName: `${brandName} ${city}`,\n                    generalEmail: \"\",\n                    managers: [\n                        { id: crypto.randomUUID(), name: \"\", email: \"\", isActive: true }\n                    ]\n                }\n            }));\n        }\n    };\n\n    const addManager = (city: string) => {\n        setStores(prev => ({\n            ...prev,\n            [city]: {\n                ...prev[city],\n                managers: [...prev[city].managers, { id: crypto.randomUUID(), name: \"\", email: \"\", isActive: true }]\n            }\n        }));\n    };\n\n    const removeManager = (city: string, managerId: string) => {\n        setStores(prev => ({\n            ...prev,\n            [city]: {\n                ...prev[city],\n                managers: prev[city].managers.filter(m => m.id !== managerId)\n            }\n        }));\n    };\n\n    const updateManager = (city: string, managerId: string, field: keyof Manager, value: any) => {\n        setStores(prev => ({\n            ...prev,\n            [city]: {\n                ...prev[city],\n                managers: prev[city].managers.map(m => m.id === managerId ? { ...m, [field]: value } : m)\n            }\n        }));\n    };\n\n    const handleNext = () => {\n        if (currentStep === 1) {\n            if (!companyName || !brandName || !adminEmail) return alert(\"Palun täitke kõik väljad.\");\n        }\n        if (currentStep === 2) {\n            if (selectedCities.length === 0) return alert(\"Valige vähemalt üks linn.\");\n        }\n        setCurrentStep(prev => prev + 1);\n        window.scrollTo(0, 0);\n    };\n\n    const handleSubmit = async () => {\n        setIsSubmitting(true);\n        // Simulate API\n        await new Promise(r => setTimeout(r, 1500));\n        console.log(\"ACTIVATING PARTNER:\", { companyName, brandName, stores });\n        setIsSuccess(true);\n        setIsSubmitting(false);\n        window.scrollTo(0, 0);\n    };\n\n    // --- RENDER ---\n\n    if (isSuccess) {\n        return (\n            <div className=\"bg-emerald-50 border border-emerald-100 p-10 rounded-3xl text-center max-w-2xl mx-auto shadow-sm animate-in zoom-in-50 duration-500\">\n                <div className=\"w-20 h-20 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center mx-auto mb-6\">\n                    <CheckCircle2 size={40} />\n                </div>\n                <h2 className=\"text-3xl font-bold text-slate-900 mb-4\">Partnerlus aktiveeritud!</h2>\n                <div className=\"text-lg text-slate-600 mb-8 leading-relaxed\">\n                    Täname, <strong>{companyName}</strong>.<br />\n                    Teie kontod on loodud ja süsteem on valmis päringuid vastu võtma.\n                </div>\n\n                <div className=\"flex flex-col gap-4 max-w-sm mx-auto\">\n                    <Link\n                        href=\"/partner/trust-dashboard\"\n                        className=\"bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-8 rounded-xl transition-all shadow-lg shadow-emerald-500/20 flex items-center justify-center gap-2\"\n                    >\n                        <ShieldCheck size={20} />\n                        Ava Usaldusportaal (Dashboard)\n                    </Link>\n                    <Link href=\"/\" className=\"text-slate-500 text-sm hover:text-slate-800 underline\">\n                        Tagasi avalehele\n                    </Link>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"max-w-3xl mx-auto\">\n\n            {/* PROGRESS INDICATOR */}\n            <div className=\"flex justify-between mb-8 px-4\">\n                {[1, 2, 3, 4].map(step => (\n                    <div key={step} className=\"flex flex-col items-center gap-2\">\n                        <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm transition-colors ${step <= currentStep ? 'bg-emerald-600 text-white' : 'bg-slate-200 text-slate-500'\n                            }`}>\n                            {step}\n                        </div>\n                        <span className=\"text-[10px] uppercase font-bold text-slate-400\">\n                            {step === 1 && \"Start\"}\n                            {step === 2 && \"Linnad\"}\n                            {step === 3 && \"Inimesed\"}\n                            {step === 4 && \"Kinnitus\"}\n                        </span>\n                    </div>\n                ))}\n            </div>\n\n            <div className=\"bg-white p-8 rounded-3xl shadow-sm border border-slate-200 min-h-[400px]\">\n\n                {/* STEP 1: INFO */}\n                {currentStep === 1 && (\n                    <div className=\"space-y-6 animate-in fade-in slide-in-from-right-4 duration-300\">\n                        <h2 className=\"text-2xl font-bold text-slate-900 flex items-center gap-2\">\n                            <Building2 className=\"text-emerald-500\" />\n                            Ettevõtte andmed\n                        </h2>\n                        <div className=\"grid md:grid-cols-2 gap-6\">\n                            <div>\n                                <label className=\"block text-sm font-medium text-slate-700 mb-2\">Juriidiline nimi *</label>\n                                <input\n                                    required\n                                    value={companyName}\n                                    onChange={e => setCompanyName(e.target.value)}\n                                    className=\"w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-emerald-500 outline-none\"\n                                    placeholder=\"OÜ Ehitusmeister\"\n                                />\n                            </div>\n                            <div>\n                                <label className=\"block text-sm font-medium text-slate-700 mb-2\">Bränd (Poe nimi) *</label>\n                                <input\n                                    required\n                                    value={brandName}\n                                    onChange={e => setBrandName(e.target.value)}\n                                    className=\"w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-emerald-500 outline-none\"\n                                    placeholder=\"nt. ProfiEhitus\"\n                                />\n                            </div>\n                            <div className=\"md:col-span-2\">\n                                <label className=\"block text-sm font-medium text-slate-700 mb-2\">Konto administraatori e-post *</label>\n                                <input\n                                    required\n                                    type=\"email\"\n                                    value={adminEmail}\n                                    onChange={e => setAdminEmail(e.target.value)}\n                                    className=\"w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-emerald-500 outline-none\"\n                                    placeholder=\"tegevjuht@firma.ee\"\n                                />\n                                <p className=\"text-xs text-slate-500 mt-2\">Kasutame seda partnerlepingu ja igakuise statistika saatmiseks.</p>\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {/* STEP 2: CITIES */}\n                {currentStep === 2 && (\n                    <div className=\"space-y-6 animate-in fade-in slide-in-from-right-4 duration-300\">\n                        <h2 className=\"text-2xl font-bold text-slate-900 flex items-center gap-2\">\n                            <MapPin className=\"text-emerald-500\" />\n                            Tegevuspiirkonnad\n                        </h2>\n                        <p className=\"text-slate-600\">Valige linnad, kus soovite ehitusmaterjalide hinnapäringuid vastu võtta.</p>\n\n                        <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\n                            {PREDEFINED_CITIES.map(city => (\n                                <button\n                                    key={city}\n                                    type=\"button\"\n                                    onClick={() => toggleCity(city)}\n                                    className={`p-4 rounded-xl border text-left transition-all ${selectedCities.includes(city)\n                                            ? 'bg-emerald-50 border-emerald-500 ring-2 ring-emerald-500/20'\n                                            : 'bg-white border-slate-200 hover:bg-slate-50'\n                                        }`}\n                                >\n                                    <div className=\"font-bold text-lg mb-1\">{city}</div>\n                                    <div className=\"text-xs text-slate-500\">\n                                        {selectedCities.includes(city) ? 'Aktiivne' : 'Vali linn'}\n                                    </div>\n                                </button>\n                            ))}\n                        </div>\n                    </div>\n                )}\n\n                {/* STEP 3: MANAGERS */}\n                {currentStep === 3 && (\n                    <div className=\"space-y-8 animate-in fade-in slide-in-from-right-4 duration-300\">\n                        <div className=\"flex justify-between items-end\">\n                            <h2 className=\"text-2xl font-bold text-slate-900 flex items-center gap-2\">\n                                <User className=\"text-emerald-500\" />\n                                Kontaktisikud\n                            </h2>\n                            <span className=\"text-sm bg-blue-50 text-blue-700 px-3 py-1 rounded-full border border-blue-100 font-medium\">\n                                {selectedCities.length} linna valitud\n                            </span>\n                        </div>\n\n                        {selectedCities.map(city => (\n                            <div key={city} className=\"bg-slate-50 p-6 rounded-2xl border border-slate-200\">\n                                <div className=\"flex justify-between items-center mb-4\">\n                                    <h4 className=\"font-bold text-slate-800 text-lg\">{city} esindus</h4>\n                                    <button\n                                        onClick={() => addManager(city)}\n                                        className=\"text-xs bg-white border border-slate-200 hover:bg-slate-100 px-3 py-1.5 rounded-lg font-medium flex items-center gap-1 shadow-sm\"\n                                    >\n                                        <Plus size={14} /> Lisa kontakt\n                                    </button>\n                                </div>\n                                <div className=\"space-y-3\">\n                                    {stores[city]?.managers.map(mgr => (\n                                        <div key={mgr.id} className=\"flex gap-2\">\n                                            <input\n                                                placeholder=\"Nimi\"\n                                                className=\"flex-1 px-3 py-2 rounded-lg border border-slate-200 text-sm\"\n                                                value={mgr.name}\n                                                onChange={e => updateManager(city, mgr.id, 'name', e.target.value)}\n                                            />\n                                            <input\n                                                placeholder=\"E-post\"\n                                                className=\"flex-1 px-3 py-2 rounded-lg border border-slate-200 text-sm\"\n                                                value={mgr.email}\n                                                onChange={e => updateManager(city, mgr.id, 'email', e.target.value)}\n                                            />\n                                            <button onClick={() => removeManager(city, mgr.id)} className=\"text-slate-400 hover:text-red-500 p-2\">\n                                                <Trash2 size={16} />\n                                            </button>\n                                        </div>\n                                    ))}\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                )}\n\n                {/* STEP 4: CONFIRMATION */}\n                {currentStep === 4 && (\n                    <div className=\"space-y-6 animate-in fade-in slide-in-from-right-4 duration-300\">\n                        <h2 className=\"text-2xl font-bold text-slate-900 flex items-center gap-2\">\n                            <ShieldCheck className=\"text-emerald-500\" />\n                            Kinnitus\n                        </h2>\n\n                        <div className=\"bg-slate-50 rounded-2xl p-6 border border-slate-200 space-y-4\">\n                            <div className=\"flex justify-between border-b border-slate-200 pb-4\">\n                                <span className=\"text-slate-500\">Ettevõte</span>\n                                <span className=\"font-bold text-slate-900\">{companyName} ({brandName})</span>\n                            </div>\n                            <div className=\"flex justify-between border-b border-slate-200 pb-4\">\n                                <span className=\"text-slate-500\">Administraator</span>\n                                <span className=\"font-bold text-slate-900\">{adminEmail}</span>\n                            </div>\n                            <div>\n                                <span className=\"text-slate-500 block mb-2\">Aktiveeritavad piirkonnad ({selectedCities.length})</span>\n                                <div className=\"flex flex-wrap gap-2\">\n                                    {selectedCities.map(c => (\n                                        <span key={c} className=\"bg-white border border-slate-200 px-3 py-1 rounded-full text-sm font-medium text-slate-700 shadow-sm\">\n                                            {c}: {stores[c]?.managers.length} kontakti\n                                        </span>\n                                    ))}\n                                </div>\n                            </div>\n                        </div>\n\n                        <div className=\"bg-blue-50 p-4 rounded-xl border border-blue-100 flex gap-3 text-blue-800 text-sm\">\n                            <div className=\"mt-0.5\">ℹ️</div>\n                            <p>\n                                Aktiveerimisel luuakse Teie poele automaatselt konto ja SmartBuildi süsteem hakkab suunama {selectedCities.join(\", \")} piirkonna päringuid Teie sisestatud kontaktidele.\n                            </p>\n                        </div>\n                    </div>\n                )}\n\n                {/* NAVIGATION */}\n                <div className=\"flex justify-between pt-8 mt-8 border-t border-slate-100\">\n                    {currentStep > 1 ? (\n                        <button\n                            onClick={() => setCurrentStep(prev => prev - 1)}\n                            className=\"bg-slate-100 hover:bg-slate-200 text-slate-600 px-6 py-3 rounded-xl font-bold flex items-center gap-2 transition-colors\"\n                        >\n                            <ArrowLeft size={18} /> Tagasi\n                        </button>\n                    ) : <div></div>}\n\n                    {currentStep < 4 ? (\n                        <button\n                            onClick={handleNext}\n                            className=\"bg-slate-900 hover:bg-slate-800 text-white px-8 py-3 rounded-xl font-bold flex items-center gap-2 transition-colors\"\n                        >\n                            Edasi <ArrowRight size={18} />\n                        </button>\n                    ) : (\n                        <button\n                            onClick={handleSubmit}\n                            disabled={isSubmitting}\n                            className=\"bg-emerald-600 hover:bg-emerald-700 text-white px-10 py-3 rounded-xl font-bold flex items-center gap-2 transition-colors shadow-lg shadow-emerald-500/30 disabled:opacity-50\"\n                        >\n                            {isSubmitting ? \"Aktiveerimine...\" : \"Aktiveeri Partnerlus\"}\n                        </button>\n                    )}\n                </div>\n\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/partner/join/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/partner/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/partner/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/partner/plans/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[485,488],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[485,488],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[663,666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[663,666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1332,1335],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1332,1335],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1783,1786],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1783,1786],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2236,2239],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2236,2239],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport PricingTable from \"@/components/partner/PricingTable\";\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\n\nexport default function PartnerPlansPage() {\n    const { t } = useLanguage();\n\n    return (\n        <div className=\"min-h-screen bg-white\">\n            {/* Header */}\n            <div className=\"bg-slate-900 py-20 px-4 text-center\">\n                <h1 className=\"text-4xl md:text-5xl font-black text-white mb-6\">\n                    {(t as any).partner_plans?.title || \"Paketid ehituspoodidele\"}\n                </h1>\n                <p className=\"text-xl text-slate-400 max-w-2xl mx-auto\">\n                    {(t as any).partner_plans?.subtitle || \"Kasvata müüki läbi SmartBuild'i kvalifitseeritud päringute.\"}\n                </p>\n            </div>\n\n            {/* Plans */}\n            <div className=\"py-20 bg-slate-50\">\n                <PricingTable />\n            </div>\n\n            {/* Trust / Content */}\n            <div className=\"py-20 max-w-4xl mx-auto px-4 text-center\">\n                <div className=\"grid md:grid-cols-3 gap-8\">\n                    <div className=\"p-6 bg-white rounded-2xl border border-slate-100 shadow-sm\">\n                        <div className=\"text-4xl mb-4\">📈</div>\n                        <div className=\"font-bold text-slate-900 mb-2\">{(t as any).partner_plans?.features?.leads || \"Kvaliteetsed päringud\"}</div>\n                        <p className=\"text-sm text-slate-500\">Ainult ostuvalmis kliendid. Kontrollitud andmed.</p>\n                    </div>\n                    <div className=\"p-6 bg-white rounded-2xl border border-slate-100 shadow-sm\">\n                        <div className=\"text-4xl mb-4\">🔍</div>\n                        <div className=\"font-bold text-slate-900 mb-2\">{(t as any).partner_plans?.features?.analytics || \"Analüütika\"}</div>\n                        <p className=\"text-sm text-slate-500\">Näe täpselt, milliseid tooteid sinu piirkonnas otsitakse.</p>\n                    </div>\n                    <div className=\"p-6 bg-white rounded-2xl border border-slate-100 shadow-sm\">\n                        <div className=\"text-4xl mb-4\">🚀</div>\n                        <div className=\"font-bold text-slate-900 mb-2\">{(t as any).partner_plans?.features?.exclusive || \"Ainuõigus\"}</div>\n                        <p className=\"text-sm text-slate-500\">Ole eelistatud partner oma kodulinnas.</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/partner/products/new/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/partner/products/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used.","line":29,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { supabase } from \"@/app/lib/supabaseClient\";\nimport Link from \"next/link\";\nimport { Plus, Search, Edit, Trash2 } from \"lucide-react\";\nimport type { StoreProduct } from \"@/app/lib/types\";\n\nexport default function PartnerProductsPage() {\n    const [products, setProducts] = useState<StoreProduct[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [searchTerm, setSearchTerm] = useState(\"\");\n    // const supabase = createClient(); // Removed\n\n    useEffect(() => {\n        const fetchProducts = async () => {\n            const { data: { user } } = await supabase.auth.getUser();\n            if (!user) return;\n\n            // Get store id\n            const { data: membership } = await supabase\n                .from(\"store_users\")\n                .select(\"store_id\")\n                .eq(\"user_id\", user.id)\n                .single();\n\n            if (!membership) return;\n\n            const { data, error } = await supabase\n                .from(\"store_products\")\n                .select(\"*\")\n                .eq(\"store_id\", membership.store_id)\n                .order(\"updated_at\", { ascending: false });\n\n            if (data) setProducts(data as StoreProduct[]);\n            setLoading(false);\n        };\n\n        fetchProducts();\n    }, []);\n\n    const filtered = products.filter(p =>\n        (p.name_override_et || \"\").toLowerCase().includes(searchTerm.toLowerCase()) ||\n        (p.sku || \"\").toLowerCase().includes(searchTerm.toLowerCase()) ||\n        (p.brand || \"\").toLowerCase().includes(searchTerm.toLowerCase())\n    );\n\n    if (loading) return <div>Laen tooteid...</div>;\n\n    return (\n        <div>\n            <div className=\"flex justify-between items-center mb-6\">\n                <div>\n                    <h1 className=\"text-2xl font-bold text-slate-900\">Tooted</h1>\n                    <p className=\"text-slate-500\">Halda poe sortimenti ja hindu.</p>\n                </div>\n                <Link href=\"/partner/products/new\" className=\"bg-emerald-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-emerald-700 transition-colors flex items-center gap-2\">\n                    <Plus size={18} />\n                    Lisa toode\n                </Link>\n            </div>\n\n            {/* Search */}\n            <div className=\"mb-6 relative\">\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={20} />\n                <input\n                    type=\"text\"\n                    placeholder=\"Otsi nime, SKU või brändi järgi...\"\n                    className=\"w-full pl-10 pr-4 py-3 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 text-slate-900\"\n                    value={searchTerm}\n                    onChange={e => setSearchTerm(e.target.value)}\n                />\n            </div>\n\n            {/* Table */}\n            <div className=\"bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm\">\n                <table className=\"w-full text-left\">\n                    <thead className=\"bg-slate-50 border-b border-slate-200 text-xs font-bold text-slate-500 uppercase\">\n                        <tr>\n                            <th className=\"px-6 py-4\">Nimetus</th>\n                            <th className=\"px-6 py-4\">Bränd</th>\n                            <th className=\"px-6 py-4\">Hind</th>\n                            <th className=\"px-6 py-4\">Laoseis</th>\n                            <th className=\"px-6 py-4\">Logistika</th>\n                            <th className=\"px-6 py-4 text-right\">Tegevused</th>\n                        </tr>\n                    </thead>\n                    <tbody className=\"divide-y divide-slate-100\">\n                        {filtered.length === 0 ? (\n                            <tr>\n                                <td colSpan={6} className=\"px-6 py-12 text-center text-slate-400\">\n                                    Tooteid ei leitud. Lisa uus või impordi CSV.\n                                </td>\n                            </tr>\n                        ) : (\n                            filtered.map(product => (\n                                <tr key={product.id} className=\"hover:bg-slate-50 transition-colors\">\n                                    <td className=\"px-6 py-4\">\n                                        <div className=\"font-bold text-slate-900\">{product.name_override_et || \"Nimetus puudub\"}</div>\n                                        <div className=\"text-xs text-slate-400 font-mono\">{product.sku || product.ean || \"NO_CODE\"}</div>\n                                    </td>\n                                    <td className=\"px-6 py-4 text-slate-600\">{product.brand}</td>\n                                    <td className=\"px-6 py-4 font-bold text-slate-900\">{product.price.toFixed(2)} €</td>\n                                    <td className=\"px-6 py-4\">\n                                        <span className={`px-2 py-1 rounded-full text-xs font-bold ${product.stock_status === 'in_stock' ? 'bg-green-100 text-green-700' :\n                                            product.stock_status === 'out_of_stock' ? 'bg-red-100 text-red-700' :\n                                                'bg-yellow-100 text-yellow-700'\n                                            }`}>\n                                            {product.stock_status === 'in_stock' ? 'Laos' :\n                                                product.stock_status === 'out_of_stock' ? 'Otsas' : product.stock_status}\n                                        </span>\n                                    </td>\n                                    <td className=\"px-6 py-4\">\n                                        {product.missing_dimensions ? (\n                                            <span className=\"text-xs text-red-500 font-bold bg-red-50 px-2 py-1 rounded border border-red-100\" title=\"Mõõdud puuduvad - Wolt keelatud\">\n                                                ! Mõõdud\n                                            </span>\n                                        ) : (\n                                            <span className=\"text-xs text-slate-500\">\n                                                {product.weight_kg}kg\n                                            </span>\n                                        )}\n                                        {product.delivery_allowed_wolt && !product.missing_dimensions && (\n                                            <span className=\"ml-2 text-xs text-emerald-600 font-bold bg-emerald-50 px-1 rounded\">W</span>\n                                        )}\n                                    </td>\n                                    <td className=\"px-6 py-4 text-right\">\n                                        <div className=\"flex items-center justify-end gap-2\">\n                                            <button className=\"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors\">\n                                                <Edit size={16} />\n                                            </button>\n                                            <button className=\"p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors\">\n                                                <Trash2 size={16} />\n                                            </button>\n                                        </div>\n                                    </td>\n                                </tr>\n                            ))\n                        )}\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/partner/profile/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[200,203],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[200,203],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { supabase } from \"@/app/lib/supabaseClient\";\n\nexport default function PartnerProfilePage() {\n    const [store, setStore] = useState<any>(null);\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n        const fetchStore = async () => {\n            const { data: { user } } = await supabase.auth.getUser();\n            if (!user) return;\n            // Get store\n            const { data: membership } = await supabase.from(\"store_users\").select(\"store_id, stores(*)\").eq(\"user_id\", user.id).single();\n            if (membership && membership.stores) {\n                setStore(membership.stores);\n            }\n            setLoading(false);\n        };\n        fetchStore();\n    }, []);\n\n    if (loading) return <div>Laen andmeid...</div>;\n    if (!store) return <div>Poodi ei leitud.</div>;\n\n    return (\n        <div className=\"max-w-2xl\">\n            <h1 className=\"text-2xl font-bold text-slate-900 mb-2\">Poe profiil</h1>\n            <p className=\"text-slate-500 mb-8\">Üldised andmed.</p>\n\n            <div className=\"bg-white p-8 rounded-xl border border-slate-200 shadow-sm space-y-6\">\n                <div className=\"grid grid-cols-2 gap-6\">\n                    <div>\n                        <label className=\"block text-sm font-bold text-slate-500 uppercase mb-1\">Nimi</label>\n                        <div className=\"text-lg font-medium text-slate-900\">{store.name}</div>\n                    </div>\n                    <div>\n                        <label className=\"block text-sm font-bold text-slate-500 uppercase mb-1\">Bränd</label>\n                        <div className=\"text-lg font-medium text-slate-900\">{store.brand_name}</div>\n                    </div>\n                    <div>\n                        <label className=\"block text-sm font-bold text-slate-500 uppercase mb-1\">Linn</label>\n                        <div className=\"text-lg font-medium text-slate-900\">{store.city}</div>\n                    </div>\n                    <div>\n                        <label className=\"block text-sm font-bold text-slate-500 uppercase mb-1\">Aadress</label>\n                        <div className=\"text-lg font-medium text-slate-900\">{store.address}</div>\n                    </div>\n                    <div>\n                        <label className=\"block text-sm font-bold text-slate-500 uppercase mb-1\">E-post</label>\n                        <div className=\"text-lg font-medium text-slate-900\">{store.contact_email}</div>\n                    </div>\n                    <div>\n                        <label className=\"block text-sm font-bold text-slate-500 uppercase mb-1\">Telefon</label>\n                        <div className=\"text-lg font-medium text-slate-900\">{store.phone}</div>\n                    </div>\n                    <div>\n                        <label className=\"block text-sm font-bold text-slate-500 uppercase mb-1\">Staatus</label>\n                        <div className=\"inline-block px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-bold uppercase\">\n                            {store.status}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/partner/trust-dashboard/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9051,9054],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9051,9054],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ArrowUpRight, CheckCircle2, Clock, Users } from \"lucide-react\";\n\n// Mock Data for \"Demo Mode\"\nconst DEMO_METRICS = {\n    totalRfqs: 142,\n    completionRate: 98,\n    avgResponseTime: \"45 min\",\n    activeManagers: 12\n};\n\nconst DEMO_MANAGERS = [\n    { name: \"Toomas K.\", store: \"Espak Tartu\", role: \"Tartu Region\", rfqs: 45, lastActive: \"12 min ago\", status: \"Healthy\" },\n    { name: \"Liis M.\", store: \"Espak Tallinn\", role: \"Tallinn Key Account\", rfqs: 52, lastActive: \"5 min ago\", status: \"Healthy\" },\n    { name: \"Andres V.\", store: \"Espak Pärnu\", role: \"Pärnu Manager\", rfqs: 31, lastActive: \"2h ago\", status: \"Attention\" },\n    { name: \"Mart T.\", store: \"Espak Viljandi\", role: \"Viljandi Sales\", rfqs: 14, lastActive: \"1d ago\", status: \"Healthy\" },\n];\n\nconst DEMO_CITIES = [\n    { name: \"Tallinn\", volume: 45, trend: \"+12%\" },\n    { name: \"Tartu\", volume: 30, trend: \"+8%\" },\n    { name: \"Pärnu\", volume: 15, trend: \"+2%\" },\n    { name: \"Viljandi\", volume: 10, trend: \"0%\" },\n];\n\nexport default function TrustDashboardPage() {\n    return (\n        <div className=\"min-h-screen bg-[#020617] text-slate-100\">\n            {/* Executive Header */}\n            <header className=\"border-b border-slate-800 bg-[#0f172a]/50\">\n                <div className=\"container mx-auto px-6 py-6 flex justify-between items-center\">\n                    <div>\n                        <div className=\"flex items-center gap-2 mb-1\">\n                            <span className=\"bg-emerald-500/10 text-emerald-400 text-xs font-bold px-2 py-1 rounded uppercase tracking-wider border border-emerald-500/20\">\n                                Live System Status\n                            </span>\n                            <span className=\"text-slate-500 text-xs font-mono\">ID: SB-TRUST-8821</span>\n                        </div>\n                        <h1 className=\"text-2xl font-bold text-white tracking-tight\">Partner Trust Center</h1>\n                        <p className=\"text-slate-400 text-sm\">Real-time routing transparency & load distribution monitoring.</p>\n                    </div>\n                    <div className=\"text-right hidden md:block\">\n                        <p className=\"text-xs text-slate-500 uppercase font-semibold\">Current SLA Status</p>\n                        <p className=\"text-emerald-400 font-bold flex items-center gap-1 justify-end\">\n                            <CheckCircle2 className=\"w-4 h-4\" />\n                            98.2% Healthy\n                        </p>\n                    </div>\n                </div>\n            </header>\n\n            <main className=\"container mx-auto px-6 py-8 space-y-8\">\n\n                {/* 1. KPI Grid */}\n                <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                    <MetricCard\n                        title=\"Total RFQs (30d)\"\n                        value={DEMO_METRICS.totalRfqs}\n                        trend=\"+18%\"\n                        icon={<ArrowUpRight className=\"w-5 h-5 text-blue-400\" />}\n                    />\n                    <MetricCard\n                        title=\"Success Rate\"\n                        value={`${DEMO_METRICS.completionRate}%`}\n                        sub=\"Delivery Confirmed\"\n                        icon={<CheckCircle2 className=\"w-5 h-5 text-emerald-400\" />}\n                    />\n                    <MetricCard\n                        title=\"Avg Response\"\n                        value={DEMO_METRICS.avgResponseTime}\n                        sub=\"Under 1h Target\"\n                        icon={<Clock className=\"w-5 h-5 text-amber-400\" />}\n                    />\n                    <MetricCard\n                        title=\"Active Managers\"\n                        value={DEMO_METRICS.activeManagers}\n                        sub=\"Load Balanced\"\n                        icon={<Users className=\"w-5 h-5 text-indigo-400\" />}\n                    />\n                </div>\n\n                {/* 2. Manager Distribution Logic */}\n                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n\n                    {/* Main Table: Manager Load */}\n                    <div className=\"lg:col-span-2 bg-[#1e293b] rounded-xl border border-slate-800 overflow-hidden\">\n                        <div className=\"p-6 border-b border-slate-800 flex justify-between items-center\">\n                            <div>\n                                <h3 className=\"font-bold text-white\">Manager Load Distribution</h3>\n                                <p className=\"text-xs text-slate-400\">Proving fair RFQ routing across your sales team.</p>\n                            </div>\n                            <button className=\"text-xs bg-slate-800 hover:bg-slate-700 text-slate-300 px-3 py-1.5 rounded transition\">\n                                Export Report\n                            </button>\n                        </div>\n                        <div className=\"overflow-x-auto\">\n                            <table className=\"w-full text-sm text-left\">\n                                <thead className=\"bg-[#0f172a] text-slate-400 uppercase text-xs font-semibold\">\n                                    <tr>\n                                        <th className=\"px-6 py-3\">Manager</th>\n                                        <th className=\"px-6 py-3\">Role / Region</th>\n                                        <th className=\"px-6 py-3 text-right\">RFQs Received</th>\n                                        <th className=\"px-6 py-3\">Last Active</th>\n                                        <th className=\"px-6 py-3\">Status</th>\n                                    </tr>\n                                </thead>\n                                <tbody className=\"divide-y divide-slate-800\">\n                                    {DEMO_MANAGERS.map((m, i) => (\n                                        <tr key={i} className=\"hover:bg-slate-800/50 transition-colors\">\n                                            <td className=\"px-6 py-4 font-medium text-white\">{m.name}</td>\n                                            <td className=\"px-6 py-4 text-slate-400\">{m.role}</td>\n                                            <td className=\"px-6 py-4 text-right font-mono text-slate-200\">{m.rfqs}</td>\n                                            <td className=\"px-6 py-4 text-slate-500\">{m.lastActive}</td>\n                                            <td className=\"px-6 py-4\">\n                                                <Badge status={m.status} />\n                                            </td>\n                                        </tr>\n                                    ))}\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>\n\n                    {/* Side Panel: Geographic Split */}\n                    <div className=\"bg-[#1e293b] rounded-xl border border-slate-800 p-6\">\n                        <h3 className=\"font-bold text-white mb-4\">Volume by City</h3>\n                        <div className=\"space-y-4\">\n                            {DEMO_CITIES.map((c, i) => (\n                                <div key={i} className=\"flex items-center justify-between group\">\n                                    <div className=\"flex items-center gap-3\">\n                                        <div className=\"w-2 h-2 rounded-full bg-blue-500/50 group-hover:bg-blue-400 transition\" />\n                                        <span className=\"text-slate-300 text-sm\">{c.name}</span>\n                                    </div>\n                                    <div className=\"flex items-center gap-3\">\n                                        <span className=\"text-slate-500 text-xs\">{c.trend}</span>\n                                        <div className=\"w-16 h-1.5 bg-slate-800 rounded-full overflow-hidden\">\n                                            <div\n                                                className=\"h-full bg-blue-500 rounded-full\"\n                                                style={{ width: `${c.volume}%` }}\n                                            />\n                                        </div>\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n\n                        <div className=\"mt-8 pt-6 border-t border-slate-800\">\n                            <h4 className=\"text-xs font-bold text-slate-400 uppercase mb-3\">System Health</h4>\n                            <div className=\"space-y-2\">\n                                <HealthRow label=\"Email Gateway\" status=\"Operational\" />\n                                <HealthRow label=\"SMS Notifier\" status=\"Operational\" />\n                                <HealthRow label=\"Database Sync\" status=\"Operational\" />\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </main>\n        </div>\n    );\n}\n\n// Sub-components for cleanliness\nfunction MetricCard({ title, value, sub, trend, icon }: any) {\n    return (\n        <div className=\"bg-[#1e293b] p-5 rounded-xl border border-slate-800 hover:border-slate-700 transition\">\n            <div className=\"flex justify-between items-start mb-4\">\n                <div className=\"p-2 bg-slate-800/50 rounded-lg\">{icon}</div>\n                {trend && <span className=\"text-emerald-400 text-xs font-bold bg-emerald-500/10 px-2 py-1 rounded\">{trend}</span>}\n            </div>\n            <div>\n                <p className=\"text-slate-400 text-xs uppercase font-semibold\">{title}</p>\n                <div className=\"flex items-baseline gap-2 mt-1\">\n                    <span className=\"text-2xl font-bold text-white\">{value}</span>\n                    {sub && <span className=\"text-xs text-slate-500\">{sub}</span>}\n                </div>\n            </div>\n        </div>\n    );\n}\n\nfunction Badge({ status }: { status: string }) {\n    if (status === \"Healthy\") {\n        return <span className=\"text-xs text-emerald-400 bg-emerald-500/10 px-2 py-1 rounded-full border border-emerald-500/20\">Healthy</span>;\n    }\n    return <span className=\"text-xs text-amber-400 bg-amber-500/10 px-2 py-1 rounded-full border border-amber-500/20\">Check</span>;\n}\n\nfunction HealthRow({ label, status }: { label: string, status: string }) {\n    return (\n        <div className=\"flex justify-between items-center text-xs\">\n            <span className=\"text-slate-400\">{label}</span>\n            <span className=\"text-emerald-400 flex items-center gap-1\">\n                <div className=\"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse\" />\n                {status}\n            </span>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/partner/welcome/ContactForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/partner/welcome/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/partners/contact/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Building2' is defined but never used.","line":7,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Building2"},"fix":{"range":[189,199],"text":""},"desc":"Remove unused variable \"Building2\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\nimport { useState, Suspense } from \"react\";\nimport { useSearchParams } from \"next/navigation\";\nimport {\n    Building2,\n    Truck,\n    Send,\n    CheckCircle2,\n    AlertCircle,\n    ArrowLeft,\n    Factory,\n    Package,\n    Store\n} from \"lucide-react\";\nimport Link from 'next/link';\n\nfunction PartnerContactContent() {\n    const { t } = useLanguage();\n    const searchParams = useSearchParams();\n    const initialType = searchParams.get('type') || 'store';\n\n    const strings = t.partners.form;\n\n    // Form State\n    const [loading, setLoading] = useState(false);\n    const [success, setSuccess] = useState(false);\n    const [error, setError] = useState<string | null>(null);\n    const [partnerType, setPartnerType] = useState(initialType);\n\n    const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\n        e.preventDefault();\n        setLoading(true);\n        setError(null);\n\n        const formData = new FormData(e.currentTarget);\n        const data = Object.fromEntries(formData);\n\n        try {\n            const res = await fetch('/api/contact/partners', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify(data),\n            });\n\n            const json = await res.json();\n\n            if (!res.ok) throw new Error(json.error || 'Failed to send');\n\n            setSuccess(true);\n        } catch (err) {\n            console.error(err);\n            setError(\"Error sending request. Please try again.\");\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    if (!strings) return null;\n\n    return (\n        <div className=\"min-h-screen bg-slate-50 pt-24 pb-20\">\n            <div className=\"container mx-auto px-4 max-w-4xl\">\n\n                <Link href=\"/partners\" className=\"inline-flex items-center gap-2 text-slate-500 hover:text-slate-800 mb-8 transition-colors font-medium\">\n                    <ArrowLeft size={18} /> Tagasi\n                </Link>\n\n                {/* Header */}\n                <div className=\"text-center mb-12\">\n                    <div className=\"inline-flex items-center justify-center p-4 bg-white rounded-2xl shadow-sm border border-slate-100 mb-6\">\n                        {partnerType === 'logistics' ? (\n                            <Truck size={32} className=\"text-blue-600\" />\n                        ) : partnerType === 'manufacturer' ? (\n                            <Factory size={32} className=\"text-purple-600\" />\n                        ) : (\n                            <Store size={32} className=\"text-orange-600\" />\n                        )}\n                    </div>\n                    <h1 className=\"text-4xl font-bold text-slate-900 mb-4\">{strings.title}</h1>\n                    <p className=\"text-xl text-slate-500 max-w-2xl mx-auto\">{strings.subtitle}</p>\n                </div>\n\n                <div className=\"bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden\">\n                    {success ? (\n                        <div className=\"p-16 text-center\">\n                            <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 text-green-600\">\n                                <CheckCircle2 size={40} />\n                            </div>\n                            <h3 className=\"text-3xl font-bold text-slate-900 mb-4\">{strings.success}</h3>\n                            <p className=\"text-lg text-slate-600 mb-8\">{strings.success_desc}</p>\n                            <Link href=\"/\">\n                                <button className=\"px-8 py-3 bg-slate-900 text-white font-bold rounded-xl hover:bg-slate-800 transition-all\">\n                                    Tagasi avalehele\n                                </button>\n                            </Link>\n                        </div>\n                    ) : (\n                        <form onSubmit={handleSubmit} className=\"p-8 md:p-12 space-y-10\">\n\n                            {/* Company Details */}\n                            <div className=\"space-y-6\">\n                                <h3 className=\"text-lg font-bold text-slate-900 border-b border-slate-100 pb-2 mb-4\">Ettevõtte andmed</h3>\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">{strings.company}</label>\n                                        <input\n                                            name=\"company_name\"\n                                            required\n                                            className=\"w-full px-4 py-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition-all\"\n                                            placeholder=\"Company OÜ\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">{strings.city}</label>\n                                        <input\n                                            name=\"city\"\n                                            required\n                                            className=\"w-full px-4 py-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition-all\"\n                                            placeholder=\"Tallinn\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">{strings.contact_name}</label>\n                                        <input\n                                            name=\"contact_name\"\n                                            required\n                                            className=\"w-full px-4 py-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition-all\"\n                                            placeholder=\"Jaan Tamm\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">{strings.email}</label>\n                                        <input\n                                            name=\"email\"\n                                            type=\"email\"\n                                            required\n                                            className=\"w-full px-4 py-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition-all\"\n                                            placeholder=\"info@company.ee\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">{strings.phone}</label>\n                                        <input\n                                            name=\"phone\"\n                                            type=\"tel\"\n                                            required\n                                            className=\"w-full px-4 py-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition-all\"\n                                            placeholder=\"+372 5555 1234\"\n                                        />\n                                    </div>\n                                </div>\n                            </div>\n\n                            {/* Partnership Details */}\n                            <div className=\"space-y-6\">\n                                <h3 className=\"text-lg font-bold text-slate-900 border-b border-slate-100 pb-2 mb-4\">Tegevusala</h3>\n\n                                <div>\n                                    <label className=\"block text-sm font-medium text-slate-700 mb-3\">{strings.type}</label>\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                        {[\n                                            { id: 'store', label: strings.type_store, icon: Store },\n                                            { id: 'wholesaler', label: strings.type_wholesaler, icon: Package },\n                                            { id: 'manufacturer', label: strings.type_manufacturer, icon: Factory },\n                                            { id: 'logistics', label: strings.type_logistics, icon: Truck },\n                                        ].map((type) => (\n                                            <label\n                                                key={type.id}\n                                                className={`relative flex items-center gap-4 p-4 rounded-xl border-2 cursor-pointer transition-all ${partnerType === type.id ? 'border-orange-500 bg-orange-50' : 'border-slate-100 hover:border-slate-200 bg-slate-50/50'}`}\n                                            >\n                                                <input\n                                                    type=\"radio\"\n                                                    name=\"partner_type\"\n                                                    value={type.id}\n                                                    checked={partnerType === type.id}\n                                                    onChange={(e) => setPartnerType(e.target.value)}\n                                                    className=\"absolute opacity-0 w-full h-full cursor-pointer\"\n                                                />\n                                                <div className={`shrink-0 ${partnerType === type.id ? 'text-orange-600' : 'text-slate-400'}`}>\n                                                    <type.icon size={24} />\n                                                </div>\n                                                <span className={`font-bold ${partnerType === type.id ? 'text-slate-900' : 'text-slate-600'}`}>{type.label}</span>\n                                            </label>\n                                        ))}\n                                    </div>\n                                </div>\n\n                                <div className=\"pt-4\">\n                                    <label className=\"block text-sm font-medium text-slate-900 mb-3\">{strings.api_ready}</label>\n                                    <div className=\"flex gap-4\">\n                                        <label className=\"flex items-center gap-2 cursor-pointer\">\n                                            <input type=\"radio\" name=\"api_readiness\" value=\"Yes\" className=\"w-5 h-5 text-orange-600\" />\n                                            <span className=\"text-slate-700\">{strings.api_yes}</span>\n                                        </label>\n                                        <label className=\"flex items-center gap-2 cursor-pointer\">\n                                            <input type=\"radio\" name=\"api_readiness\" value=\"No\" defaultChecked className=\"w-5 h-5 text-orange-600\" />\n                                            <span className=\"text-slate-700\">{strings.api_no}</span>\n                                        </label>\n                                    </div>\n                                </div>\n\n                            </div>\n\n                            {error && (\n                                <div className=\"flex items-center gap-2 text-red-600 bg-red-50 p-4 rounded-xl text-sm font-medium\">\n                                    <AlertCircle size={18} />\n                                    {error}\n                                </div>\n                            )}\n\n                            <div className=\"pt-6 border-t border-slate-100\">\n                                <button\n                                    disabled={loading}\n                                    className=\"w-full py-5 bg-orange-600 hover:bg-orange-700 text-white text-lg font-bold rounded-xl transition-all shadow-lg shadow-orange-600/20 flex items-center justify-center gap-3 disabled:opacity-70 disabled:cursor-not-allowed transform active:scale-[0.99]\"\n                                >\n                                    {loading ? (\n                                        <span>Saving...</span>\n                                    ) : (\n                                        <>\n                                            {strings.submit}\n                                            <Send size={20} />\n                                        </>\n                                    )}\n                                </button>\n                                <p className=\"text-center text-xs text-slate-400 mt-4\">\n                                    By submitting you agree to our privacy policy.\n                                </p>\n                            </div>\n                        </form>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n}\n\nexport default function PartnerContactPage() {\n    return (\n        <Suspense fallback={<div className=\"min-h-screen flex items-center justify-center\">Loading...</div>}>\n            <PartnerContactContent />\n        </Suspense>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/partners/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[393,396],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[393,396],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'common' is assigned a value but never used.","line":22,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[433,436],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[433,436],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4986,4989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4986,4989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5151,5154],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5151,5154],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5222,5225],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5222,5225],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5293,5296],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5293,5296],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5364,5367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5364,5367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5437,5440],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5437,5440],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\nimport Link from \"next/link\";\nimport {\n    CheckCircle2,\n    ShoppingCart,\n    Box,\n    MapPin,\n    Send,\n    BarChart3,\n    PieChart,\n    TrendingUp,\n    ArrowRight,\n    Building2,\n    Users\n} from \"lucide-react\";\n\nexport default function PartnersPage() {\n    const { t } = useLanguage();\n    const txt = (t as any).partners;\n    const common = (t as any).common;\n\n    if (!txt) return null;\n\n    return (\n        <div className=\"min-h-screen bg-slate-50\">\n            {/* Hero Section */}\n            <section className=\"bg-slate-900 text-white pt-24 pb-32 relative overflow-hidden\">\n                <div className=\"absolute top-0 right-0 w-1/3 h-full bg-orange-500/10 rotate-12 transform translate-x-32 blur-3xl pointer-events-none\"></div>\n                <div className=\"absolute bottom-0 left-0 w-1/3 h-full bg-blue-500/10 -rotate-12 transform -translate-x-32 blur-3xl pointer-events-none\"></div>\n\n                <div className=\"container mx-auto px-4 relative z-10 text-center max-w-4xl\">\n                    <div className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800 border border-slate-700 text-slate-300 text-xs font-medium mb-6\">\n                        <Building2 size={14} className=\"text-orange-500\" />\n                        <span>B2B Partner Program</span>\n                    </div>\n                    <h1 className=\"text-4xl md:text-6xl font-extrabold tracking-tight mb-6 leading-tight\">\n                        {txt.title}\n                    </h1>\n                    <p className=\"text-xl text-slate-400 mb-10 max-w-2xl mx-auto leading-relaxed\">\n                        {txt.subtitle}\n                    </p>\n                    <div className=\"flex flex-col items-center justify-center gap-4\">\n                        <Link\n                            href=\"/partners/contact\"\n                            className=\"px-8 py-4 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-xl transition-all shadow-lg shadow-orange-500/20 flex items-center gap-2 cursor-pointer relative z-20\"\n                        >\n                            {txt.cta}\n                            <ArrowRight size={20} />\n                        </Link>\n\n                        <a href=\"mailto:info@smartbuild.ee\" className=\"text-sm text-slate-500 hover:text-slate-300 transition-colors flex items-center gap-2 cursor-pointer z-20\">\n                            <Send size={12} /> info@smartbuild.ee\n                        </a>\n                    </div>\n                </div>\n            </section>\n\n            {/* How it works */}\n            <section className=\"py-20 -mt-20 relative z-20\">\n                <div className=\"container mx-auto px-4\">\n                    <div className=\"bg-white rounded-3xl shadow-xl border border-slate-100 p-8 md:p-12\">\n                        <div className=\"text-center mb-12\">\n                            <h2 className=\"text-2xl font-bold text-slate-900\">{txt.how_it_works.title}</h2>\n                        </div>\n                        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-8 relative\">\n                            {/* Connecting Line (Desktop) */}\n                            <div className=\"hidden md:block absolute top-8 left-1/8 right-1/8 h-0.5 bg-slate-100 w-3/4 mx-auto -z-10\"></div>\n\n                            {[\n                                { icon: ShoppingCart, text: txt.how_it_works.step1 },\n                                { icon: Box, text: txt.how_it_works.step2 },\n                                { icon: MapPin, text: txt.how_it_works.step3 },\n                                { icon: Send, text: txt.how_it_works.step4 }\n                            ].map((step, idx) => (\n                                <div key={idx} className=\"flex flex-col items-center text-center group\">\n                                    <div className=\"w-16 h-16 rounded-2xl bg-white border border-slate-100 shadow-sm flex items-center justify-center mb-4 group-hover:border-orange-200 group-hover:shadow-orange-100 transition-all z-10\">\n                                        <step.icon className=\"text-slate-600 group-hover:text-orange-500 transition-colors\" size={28} />\n                                    </div>\n                                    <span className=\"font-semibold text-slate-800\">{step.text}</span>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                </div>\n            </section>\n\n            {/* Value Props & Demo Split */}\n            <section className=\"py-16\">\n                <div className=\"container mx-auto px-4\">\n                    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-16 items-center\">\n                        {/* Left: Benefits (How it helps) */}\n                        <div>\n                            <h2 className=\"text-3xl font-bold text-slate-900 mb-8\">{(txt as any).how_it_helps.title}</h2>\n                            <div className=\"space-y-6\">\n                                {[\n                                    (txt as any).how_it_helps.reason1,\n                                    (txt as any).how_it_helps.reason2,\n                                    (txt as any).how_it_helps.reason3,\n                                    (txt as any).how_it_helps.reason4\n                                ].map((reason: any, idx) => (\n                                    <div key={idx} className=\"flex items-start gap-4 p-5 rounded-2xl bg-white shadow-sm border border-slate-100 hover:border-orange-200 transition-all\">\n                                        <div className=\"mt-1 shrink-0 w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center\">\n                                            <CheckCircle2 size={16} className=\"text-orange-600\" />\n                                        </div>\n                                        <div>\n                                            <h3 className=\"text-lg font-bold text-slate-900 mb-1\">{reason.title}</h3>\n                                            <p className=\"text-slate-600 leading-relaxed\">{reason.text}</p>\n                                        </div>\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n\n                        {/* Right: Demo Visuals */}\n                        <div className=\"relative\">\n                            {/* Blur Back */}\n                            <div className=\"absolute inset-0 bg-gradient-to-tr from-orange-100 to-blue-50 rounded-full blur-3xl opacity-60\"></div>\n\n                            {/* RFQ Card Demo */}\n                            <div className=\"relative bg-white rounded-2xl shadow-xl border border-slate-100 p-6 max-w-md mx-auto transform rotate-2 hover:rotate-0 transition-transform duration-500\">\n                                <div className=\"flex justify-between items-center mb-6\">\n                                    <div className=\"flex items-center gap-3\">\n                                        <div className=\"w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center font-bold text-slate-600\">\n                                            SB\n                                        </div>\n                                        <div>\n                                            <div className=\"text-xs text-slate-400 uppercase tracking-wider font-semibold\">SmartBuild RFQ #4829</div>\n                                            <div className=\"text-sm font-bold text-slate-900\">{txt.demo_rfq.title}</div>\n                                        </div>\n                                    </div>\n                                    <span className=\"text-xs font-medium bg-green-100 text-green-700 px-2 py-1 rounded-md\">Verified</span>\n                                </div>\n\n                                <div className=\"space-y-4 mb-6\">\n                                    <div className=\"flex justify-between py-2 border-b border-slate-50\">\n                                        <span className=\"text-sm text-slate-500\">{txt.demo_rfq.city}</span>\n                                        <span className=\"text-sm font-medium text-slate-900 flex items-center gap-1\">\n                                            <MapPin size={14} /> {txt.demo_rfq.example_city}\n                                        </span>\n                                    </div>\n                                    <div className=\"flex justify-between py-2 border-b border-slate-50\">\n                                        <span className=\"text-sm text-slate-500\">{txt.demo_rfq.items}</span>\n                                        <span className=\"text-sm font-medium text-slate-900\">12 items</span>\n                                    </div>\n                                    <div className=\"flex justify-between py-2 border-b border-slate-50\">\n                                        <span className=\"text-sm text-slate-500\">{txt.demo_rfq.client}</span>\n                                        <span className=\"text-sm font-medium text-slate-900\">{txt.demo_rfq.example_client}</span>\n                                    </div>\n                                </div>\n\n                                <div className=\"flex gap-2\">\n                                    <button className=\"flex-1 bg-slate-900 text-white text-sm font-medium py-2 rounded-lg\">Accept</button>\n                                    <button className=\"flex-1 bg-slate-100 text-slate-600 text-sm font-medium py-2 rounded-lg\">Ignore</button>\n                                </div>\n                            </div>\n\n                            {/* Mini Analytics Badge */}\n                            <div className=\"absolute -bottom-6 -left-6 bg-white p-4 rounded-xl shadow-lg border border-slate-100 max-w-[200px] transform hover:scale-105 transition-transform\">\n                                <div className=\"text-xs text-slate-400 mb-1\">{txt.analytics.title}</div>\n                                <div className=\"flex items-end gap-2 h-8\">\n                                    <div className=\"w-2 bg-blue-200 h-4 rounded-t\"></div>\n                                    <div className=\"w-2 bg-blue-300 h-6 rounded-t\"></div>\n                                    <div className=\"w-2 bg-blue-500 h-8 rounded-t\"></div>\n                                    <div className=\"w-2 bg-blue-300 h-5 rounded-t\"></div>\n                                </div>\n                                <div className=\"text-xs font-bold text-slate-800 mt-2\">+24% growth</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </section>\n\n            {/* Smart Allocation */}\n            <section className=\"py-20 bg-white border-y border-slate-100\">\n                <div className=\"container mx-auto px-4 text-center max-w-3xl\">\n                    <div className=\"inline-flex items-center justify-center p-3 rounded-2xl bg-blue-50 text-blue-600 mb-6\">\n                        <Users size={32} />\n                    </div>\n                    <h2 className=\"text-3xl font-bold text-slate-900 mb-4\">{txt.allocation.title}</h2>\n                    <p className=\"text-lg text-slate-500\">\n                        {txt.allocation.text}\n                    </p>\n                </div>\n            </section>\n\n            {/* Analytics Grid */}\n            <section className=\"py-20 bg-slate-50\">\n                <div className=\"container mx-auto px-4\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                        {[\n                            { title: txt.analytics.viz1, icon: PieChart, color: \"text-purple-500\", bg: \"bg-purple-50\" },\n                            { title: txt.analytics.viz2, icon: BarChart3, color: \"text-blue-500\", bg: \"bg-blue-50\" },\n                            { title: txt.analytics.viz3, icon: TrendingUp, color: \"text-green-500\", bg: \"bg-green-50\" }\n                        ].map((item, idx) => (\n                            <div key={idx} className=\"bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-4\">\n                                <div className={`w-12 h-12 rounded-xl ${item.bg} flex items-center justify-center shrink-0`}>\n                                    <item.icon className={item.color} size={24} />\n                                </div>\n                                <span className=\"font-semibold text-slate-700\">{item.title}</span>\n                            </div>\n                        ))}\n                    </div>\n                </div>\n            </section>\n\n            {/* Final CTA */}\n            <section className=\"py-24 bg-slate-900 text-white text-center\">\n                <div className=\"container mx-auto px-4\">\n                    <h2 className=\"text-3xl font-bold mb-8\">Ready to grow?</h2>\n                    <Link href=\"/partners/contact\" className=\"inline-flex items-center gap-3 px-10 py-4 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-xl transition-all shadow-lg shadow-orange-500/20 text-lg cursor-pointer\">\n                        {txt.cta}\n                        <ArrowRight size={20} />\n                    </Link>\n                    <p className=\"mt-6 text-slate-500 text-sm\">\n                        SmartBuild Platform &copy; 2026\n                    </p>\n                </div>\n            </section>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/products/ClientCatalog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Link"},"fix":{"range":[156,185],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[251,254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[251,254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect } from \"react\";\nimport { track } from \"@/app/lib/analytics\";\nimport ProductCard from \"@/components/products/ProductCard\";\nimport Link from \"next/link\";\n\nexport default function ClientCatalog({ products }: { products: any[] }) {\n    useEffect(() => {\n        track(\"view_catalog\");\n    }, []);\n\n    return (\n        <div className=\"bg-slate-50 min-h-screen\">\n            <div className=\"container mx-auto px-4 py-12\">\n\n                {/* Header Section */}\n                <div className=\"flex flex-col md:flex-row justify-between items-end mb-10 gap-6\">\n                    <div>\n                        <div className=\"inline-flex items-center gap-2 bg-blue-50 text-blue-800 px-3 py-1 rounded-full text-xs font-semibold uppercase tracking-wide mb-2\">\n                            <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\" /><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\" /></svg>\n                            Piirkond: Pärnu (Vaikimisi)\n                        </div>\n                        <h1 className=\"text-3xl md:text-4xl font-bold text-slate-900\">Ehitusmaterjalide hinnad</h1>\n                        <p className=\"text-slate-500 mt-2 max-w-2xl\">\n                            SmartBuild ei müü kaupu – me aitame leida parima hinna Eesti ehituspoodides.\n                        </p>\n                    </div>\n\n                    <div className=\"flex gap-2\">\n                        <button className=\"bg-white border border-slate-200 text-slate-700 px-4 py-2 rounded-lg text-sm font-medium hover:bg-slate-50 transition-colors\">\n                            Filtreeri\n                        </button>\n                        <button className=\"bg-orange-500 text-white px-6 py-2 rounded-lg text-sm font-bold hover:bg-orange-600 transition-colors shadow-sm\">\n                            Ostukorv\n                        </button>\n                    </div>\n                </div>\n\n                {/* Product Grid */}\n                <div className=\"grid sm:grid-cols-2 lg:grid-cols-3 gap-6\">\n                    {products.map((product) => (\n                        <ProductCard key={product.id} product={product} />\n                    ))}\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/products/[id]/ClientProductDetail.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AddToCartButton' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":23,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"AddToCartButton"},"fix":{"range":[125,193],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[420,423],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[420,423],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":104,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":107,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[436,439],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[436,439],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":117,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":120,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[449,452],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[449,452],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":42,"column":37,"nodeType":"JSXOpeningElement","endLine":42,"endColumn":128},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5435,5438],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5435,5438],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect } from \"react\";\nimport { track } from \"@/app/lib/analytics\";\nimport Link from \"next/link\";\nimport AddToCartButton from \"@/components/products/AddToCartButton\"; // Make sure to use this if needed, or if the page uses it.\n\n// Replicating the display logic from the server page but as client component\nexport default function ClientProductDetail({ product, bestPrice, offers }: { product: any, bestPrice: any, offers: any[] }) {\n\n    useEffect(() => {\n        if (product) {\n            track(\"view_product\", {\n                product_id: product.id,\n                product_name: product.name,\n                category: product.category\n            });\n        }\n    }, [product]);\n\n    if (!product) return null;\n\n    return (\n        <div className=\"bg-slate-50 min-h-screen py-10\">\n            <div className=\"container mx-auto px-4\">\n\n                {/* Breadcrumbs */}\n                <div className=\"flex items-center gap-2 text-sm text-slate-500 mb-6\">\n                    <Link href=\"/\" className=\"hover:text-slate-900\">Avaleht</Link>\n                    <span>/</span>\n                    <Link href=\"/products\" className=\"hover:text-slate-900\">Kataloog</Link>\n                    <span>/</span>\n                    <span className=\"text-slate-900 truncate max-w-xs\">{product.name}</span>\n                </div>\n\n                <div className=\"grid md:grid-cols-3 gap-8\">\n                    {/* Left: Product Image & Info */}\n                    <div className=\"md:col-span-1\">\n                        <div className=\"bg-white rounded-2xl p-6 border border-slate-100 shadow-sm mb-6\">\n                            <div className=\"aspect-square bg-slate-50 rounded-xl relative overflow-hidden mb-6 flex items-center justify-center\">\n                                {product.image_url ? (\n                                    <img src={product.image_url} alt={product.name} className=\"w-full h-full object-contain\" />\n                                ) : (\n                                    <span className=\"text-slate-300\">Pilt puudub</span>\n                                )}\n                            </div>\n                        </div>\n\n                        <div className=\"bg-white rounded-2xl p-6 border border-slate-100 shadow-sm\">\n                            <h3 className=\"font-bold text-slate-900 mb-4\">Toote info</h3>\n                            <dl className=\"space-y-3 text-sm\">\n                                <div className=\"flex justify-between border-b border-slate-50 pb-2\">\n                                    <dt className=\"text-slate-500\">Kategooria</dt>\n                                    <dd className=\"font-medium text-slate-900 text-right\">{product.category || '-'}</dd>\n                                </div>\n                                <div className=\"flex justify-between border-b border-slate-50 pb-2\">\n                                    <dt className=\"text-slate-500\">Ühik</dt>\n                                    <dd className=\"font-medium text-slate-900 text-right\">{product.unit || 'tk'}</dd>\n                                </div>\n                                <div className=\"flex justify-between\">\n                                    <dt className=\"text-slate-500\">Tootekood</dt>\n                                    <dd className=\"font-medium text-slate-900 text-right text-xs bg-slate-100 px-2 py-0.5 rounded text-slate-500\">{product.id.split('-')[0]}</dd>\n                                </div>\n                            </dl>\n                        </div>\n                    </div>\n\n                    {/* Right: Comparison Table */}\n                    <div className=\"md:col-span-2\">\n                        <div className=\"bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden\">\n                            <div className=\"p-6 border-b border-slate-100\">\n                                <h1 className=\"text-2xl md:text-3xl font-bold text-slate-900 mb-2\">{product.name}</h1>\n                                <p className=\"text-slate-500\">\n                                    {offers.length > 0 ? (\n                                        <>Leidsime <strong className=\"text-slate-900\">{offers.length} pakkumist</strong> alates <strong className=\"text-green-600\">{bestPrice} €</strong></>\n                                    ) : (\n                                        \"Hetkel pakkumised puuduvad.\"\n                                    )}\n                                </p>\n                            </div>\n\n                            <div className=\"overflow-x-auto\">\n                                <table className=\"w-full text-left text-sm\">\n                                    <thead className=\"bg-slate-50 text-slate-500 font-medium uppercase text-xs\">\n                                        <tr>\n                                            <th className=\"px-6 py-4\">Pood</th>\n                                            <th className=\"px-6 py-4\">Hind ({product.unit})</th>\n                                            <th className=\"px-6 py-4 hidden sm:table-cell\">Uuendatud</th>\n                                            <th className=\"px-6 py-4 text-right\">Tegevus</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody className=\"divide-y divide-slate-100\">\n                                        {offers.map((offer: any, index: number) => {\n                                            const isCheapest = index === 0;\n                                            return (\n                                                <tr key={offer.id} className={`hover:bg-slate-50 transition-colors ${isCheapest ? 'bg-orange-50/30' : ''}`}>\n                                                    <td className=\"px-6 py-4\">\n                                                        <div className=\"flex items-center gap-3\">\n                                                            <div className=\"font-bold text-slate-900\">{offer.brands?.name}</div>\n                                                            {isCheapest && (\n                                                                <span className=\"bg-green-100 text-green-700 text-xs px-2 py-0.5 rounded-full font-bold\">Parim hind</span>\n                                                            )}\n                                                        </div>\n                                                    </td>\n                                                    <td className=\"px-6 py-4\">\n                                                        <div className=\"text-lg font-bold text-slate-900\">{offer.price} €</div>\n                                                    </td>\n                                                    <td className=\"px-6 py-4 hidden sm:table-cell text-slate-500\">\n                                                        {new Date(offer.updated_at).toLocaleDateString('et-EE')}\n                                                    </td>\n                                                    <td className=\"px-6 py-4 text-right\">\n                                                        <Link\n                                                            href={`/cart?add=${product.id}&offer=${offer.id}`}\n                                                            className=\"inline-block bg-[#0f172a] hover:bg-slate-700 text-white px-4 py-2 rounded-lg font-medium transition-colors\"\n                                                        >\n                                                            Lisa ostukorvi\n                                                        </Link>\n                                                    </td>\n                                                </tr>\n                                            );\n                                        })}\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n\n                        <div className=\"mt-6 bg-blue-50 border border-blue-100 rounded-xl p-4 flex gap-4 items-start\">\n                            <svg className=\"w-6 h-6 text-blue-600 flex-shrink-0 mt-0.5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                            </svg>\n                            <div>\n                                <h4 className=\"font-bold text-blue-900 text-sm\">Kas soovite osta suuremat kogust?</h4>\n                                <p className=\"text-blue-700 text-sm mt-1\">\n                                    Lisage tooted ostukorvi ja saatke meile hinnapäring. Saadame selle automaatselt poodide projektimüügi osakondadesse, et saaksite personaalse pakkumise.\n                                </p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/products/[id]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'jsonLd' is assigned a value but never used.","line":51,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":51,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2183,2186],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2183,2186],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2873,2876],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2873,2876],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2881,2884],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2881,2884],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from \"../../lib/supabaseClient\";\nimport Link from \"next/link\";\nimport ClientProductDetail from \"./ClientProductDetail\";\n\nexport const revalidate = 60;\n\nexport async function generateMetadata({ params }: { params: Promise<{ id: string }> }) {\n    const { id } = await params;\n    const { data: product } = await supabase.from('products').select('name').eq('id', id).single();\n    return {\n        title: product ? `${product.name} hind — Võrdlus` : 'Toode puudub',\n        description: product ? `${product.name} parim hind Eestis. Võrdle pakkumisi erinevatest ehituspoodidest SmartBuildis.` : 'Vaata ehitusmaterjalide hindu.',\n    };\n}\n\nexport default async function ProductDetailPage({ params }: { params: Promise<{ id: string }> }) {\n    const { id } = await params;\n\n    // Fetch product and ALL offers with brand info (mock for now if no DB)\n    // NOTE: In previous context, we might rely on Supabase, but restrictions said \"No Supabase\" for new stuff.\n    // However, this file imports 'supabase'. Assuming it works or is a mock client.\n    // If this fails, we should check if supabaseClient is actually mock. \n    // Based on user request: \"Данные: mock (без Supabase)\".\n    // So likely the existing code tries to use supabase but it might be broken or mocked?\n    // User said \"Code relating to the user's requests should be written... Avoid adding Supabase\".\n    // I see existing code uses supabase. I will stick to what is there but add JSON-LD.\n\n    // Actually, I should probably check if supabase client is real or mock. \n    // But I must not break existing architecture.\n\n    const { data: product, error } = await supabase\n        .from('products')\n        .select(`\n      *,\n      offers (\n        id,\n        price,\n        updated_at,\n        url,\n        brands (\n           name,\n           slug,\n           logo_url\n        )\n      )\n    `)\n        .eq('id', id)\n        .single();\n\n    // JSON-LD Construction\n    const jsonLd = product ? {\n        '@context': 'https://schema.org',\n        '@type': 'Product',\n        name: product.name,\n        description: `Võrdle ${product.name} hindu.`,\n        offers: product.offers?.map((offer: any) => ({\n            '@type': 'Offer',\n            price: offer.price,\n            priceCurrency: 'EUR',\n            seller: {\n                '@type': 'Organization',\n                name: offer.brands?.name\n            }\n        }))\n    } : null;\n\n    if (error || !product) {\n        return (\n            <div className=\"container mx-auto px-4 py-20 text-center\">\n                <h1 className=\"text-2xl font-bold text-slate-900 mb-4\">Toodet ei leitud</h1>\n                <Link href=\"/products\" className=\"text-orange-600 hover:underline\">Tagasi kataloogi</Link>\n            </div>\n        );\n    }\n\n    // Sort offers by price (ascending)\n    const offers = product.offers?.sort((a: any, b: any) => a.price - b.price) || [];\n    const bestPrice = offers.length > 0 ? offers[0].price : null;\n\n    return <ClientProductDetail product={product} bestPrice={bestPrice} offers={offers} />;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/products/loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/products/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/providers.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/register/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1270,1273],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1270,1273],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1715,1718],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1715,1718],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3097,3100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3097,3100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4230,4233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4230,4233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5402,5405],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5402,5405],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5920,5923],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5920,5923],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport { useUser } from '@/components/auth/UserProvider';\nimport { useLanguage } from '@/components/i18n/LanguageProvider';\nimport { signInWithOAuth } from '../lib/supabaseClient';\n\nexport default function RegisterPage() {\n    const { t } = useLanguage();\n    const { login } = useUser();\n    const [email, setEmail] = useState('');\n    const [city, setCity] = useState('Pärnu');\n    const [companyName, setCompanyName] = useState('');\n\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState<string | null>(null);\n    const router = useRouter();\n\n    const handleRegister = async (e: React.FormEvent) => {\n        e.preventDefault();\n        setLoading(true);\n        setError(null);\n\n        try {\n            // Simple Client-Side Persistence (No Password)\n            await login({\n                email,\n                city,\n                name: companyName // using company name as name identifier for now, or just leave empty\n            });\n\n            alert('Andmed salvestatud! Teid tuvastatakse nüüd automaatselt.');\n            router.push('/'); // Redirect to home or logic\n        } catch (err: any) {\n            setError('Viga salvestamisel: ' + err.message);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"min-h-[calc(100vh-64px)] flex items-center justify-center bg-slate-50 px-4\">\n            <div className=\"bg-white p-8 rounded-2xl shadow-sm border border-slate-100 w-full max-w-md\">\n                <h1 className=\"text-2xl font-bold text-center mb-6 text-slate-900\">{(t as any).auth?.register || \"Seadista profiil\"}</h1>\n\n                {/* Social Login Buttons */}\n                <div className=\"space-y-3 mb-6\">\n                    <button\n                        onClick={() => signInWithOAuth('google')}\n                        disabled={loading}\n                        className=\"w-full flex items-center justify-center gap-3 px-4 py-2.5 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors text-slate-700 font-medium disabled:opacity-50\"\n                    >\n                        <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\">\n                            <path d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\" fill=\"#4285F4\" />\n                            <path d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\" fill=\"#34A853\" />\n                            <path d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.26.81-.58z\" fill=\"#FBBC05\" />\n                            <path d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\" fill=\"#EA4335\" />\n                        </svg>\n                        {(t as any).auth?.continue_with_google || \"Jätka Google’iga\"}\n                    </button>\n                    {/* Facebook and Apple skipped for brevity in Register to avoid overwhelming wall of text, or should I add them? \n                        USER asked for consistency. Let's add them.\n                     */}\n                    <button\n                        onClick={() => signInWithOAuth('facebook')}\n                        disabled={loading}\n                        className=\"w-full flex items-center justify-center gap-3 px-4 py-2.5 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors text-slate-700 font-medium disabled:opacity-50\"\n                    >\n                        <svg className=\"w-5 h-5 text-[#1877F2]\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path d=\"M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.581c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a8.68 8.68 0 0 1 1.141.195v3.325a8.623 8.623 0 0 0-.653-.036c-2.148 0-2.797 1.603-2.797 4.16v1.922h5.083l-1.109 3.667h-3.974v7.98h-5.026z\" />\n                        </svg>\n                        {(t as any).auth?.continue_with_facebook || \"Jätka Facebook’iga\"}\n                    </button>\n                    <button\n                        onClick={() => signInWithOAuth('apple')}\n                        disabled={loading}\n                        className=\"w-full flex items-center justify-center gap-3 px-4 py-2.5 bg-black text-white rounded-lg hover:bg-slate-800 transition-colors font-medium disabled:opacity-50\"\n                    >\n                        <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path d=\"M12.152 6.896c-.948 0-2.415-1.078-3.96-1.04-2.04.027-3.91 1.183-4.961 3.014-2.117 3.675-.546 9.103 1.519 12.09 1.013 1.454 2.208 3.09 3.792 3.039 1.52-.065 2.09-.987 3.935-.987 1.831 0 2.35.987 3.96.948 1.637-.026 2.676-1.48 3.676-2.948 1.156-1.688 1.636-3.325 1.662-3.415-.039-.013-3.182-1.221-3.22-4.857-.027-3.04 2.48-4.508 2.597-4.598-1.429-2.09-3.623-2.324-4.403-2.363-2-.08-3.675 1.04-4.61 1.04zm4.961-4.47c.546 1.052.701 2.325.701 3.597 1.182.027 2.455-.494 3.013-1.48.559-1.027.676-2.287.676-3.443-1.324.013-2.52.545-3.091 1.325z\" />\n                        </svg>\n                        {(t as any).auth?.continue_with_apple || \"Jätka Apple’iga\"}\n                    </button>\n                </div>\n\n                <div className=\"relative my-6\">\n                    <div className=\"absolute inset-0 flex items-center\">\n                        <div className=\"w-full border-t border-slate-200\"></div>\n                    </div>\n                    <div className=\"relative flex justify-center text-sm\">\n                        <span className=\"px-2 bg-white text-slate-500\">\n                            {(t as any).auth?.or_email || \"või e-postiga\"}\n                        </span>\n                    </div>\n                </div>\n\n                <p className=\"text-center text-slate-500 mb-6 text-sm\">Salvestame teie e-posti ja linna, et te ei peaks neid igakord uuesti sisestama.</p>\n\n                {error && (\n                    <div className=\"bg-red-50 text-red-600 p-3 rounded-lg mb-4 text-sm\">\n                        {error}\n                    </div>\n                )}\n\n                <form onSubmit={handleRegister} className=\"space-y-4\">\n                    <div>\n                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">E-post <span className=\"text-red-500\">*</span></label>\n                        <input\n                            type=\"email\"\n                            value={email}\n                            onChange={(e) => setEmail(e.target.value)}\n                            className=\"w-full px-4 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-orange-500\"\n                            required\n                        />\n                    </div>\n                    {/* Password removed - No DB auth */}\n\n                    <div className=\"grid grid-cols-1 gap-4\">\n                        <div>\n                            <label className=\"block text-sm font-medium text-slate-700 mb-1\">Linn (Tarne ja päringud) <span className=\"text-red-500\">*</span></label>\n                            <select\n                                value={city}\n                                onChange={(e) => setCity(e.target.value)}\n                                className=\"w-full px-4 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-orange-500 bg-white\"\n                            >\n                                {['Pärnu', 'Tallinn', 'Tartu', 'Rakvere', 'Viljandi'].map(c => (\n                                    <option key={c} value={c}>{c}</option>\n                                ))}\n                            </select>\n                        </div>\n                        <div>\n                            <label className=\"block text-sm font-medium text-slate-700 mb-1\">Ettevõtte nimi / Nimi</label>\n                            <input\n                                type=\"text\"\n                                value={companyName}\n                                onChange={(e) => setCompanyName(e.target.value)}\n                                className=\"w-full px-4 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-orange-500\"\n                                placeholder=\"nt. Ehitus OÜ\"\n                            />\n                        </div>\n                    </div>\n\n                    <button\n                        type=\"submit\"\n                        disabled={loading}\n                        className=\"w-full bg-[#0f172a] hover:bg-slate-800 text-white font-semibold py-3 rounded-lg transition-colors disabled:opacity-50 mt-6\"\n                    >\n                        {loading ? 'Salvestamine...' : 'Salvesta andmed'}\n                    </button>\n                </form>\n\n                <p className=\"mt-6 text-center text-sm text-slate-600\">\n                    Juba konto olemas?{' '}\n                    <Link href=\"/login\" className=\"text-orange-600 hover:text-orange-700 font-medium\">\n                        Logi sisse\n                    </Link>\n                </p>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/rfq/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/rfq/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":153,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4896,4899],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4896,4899],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { useCart } from \"@/components/cart/CartProvider\";\nimport Link from \"next/link\";\nimport type { StoreName, CityName } from \"@/app/lib/storeContacts\";\nimport { SUPPORTED_STORES, SUPPORTED_CITIES } from \"@/app/lib/storeContacts\";\nimport { track } from \"@/app/lib/analytics\";\nimport { useUser } from \"@/components/auth/UserProvider\";\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\nimport { getTranslatedProduct } from \"@/app/lib/i18n/productUtils\";\n\nconst CITIES = SUPPORTED_CITIES;\n\nexport default function RFQWizardPage() {\n    const { items, clear } = useCart();\n    const { user, login } = useUser();\n    const { t } = useLanguage();\n    const [step, setStep] = useState(1);\n    const [loading, setLoading] = useState(false);\n    const [success, setSuccess] = useState(false);\n\n    // Logging Helper\n    const logFunnel = (action: string, details?: string) => {\n        console.log(`[RFQ_FUNNEL] ${action}${details ? `: ${details}` : ''}`);\n        // In real app: send to analytics\n    };\n\n    // Initialize Log\n    useState(() => {\n        if (items.length > 0) {\n            logFunnel(\"RFQ_STARTED\", `Items: ${items.length}`);\n            track(\"start_rfq\", { items_count: items.length });\n            if (window.innerWidth < 768) track(\"mobile_rfq_started\");\n        }\n    });\n\n    // Form State\n    const [formData, setFormData] = useState({\n        name: \"\",\n        email: \"\",\n        phone: \"\",\n        city: \"Pärnu\" as CityName,\n        company: \"\",\n        customerType: \"private\", // Default to private\n        notes: \"\",\n        consent: false,\n    });\n\n    // Auto-fill from user session\n    useEffect(() => {\n        if (user) {\n            setFormData(prev => ({\n                ...prev,\n                email: user.email || prev.email,\n                name: user.name || prev.name,\n                city: (user.city as CityName) || prev.city,\n            }));\n        }\n    }, [user]);\n\n    const [selectedStores, setSelectedStores] = useState<StoreName[]>([]);\n\n    // Handlers\n    const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\n        const value = e.target.type === \"checkbox\" ? (e.target as HTMLInputElement).checked : e.target.value;\n        setFormData({ ...formData, [e.target.name]: value });\n    };\n\n    const toggleStore = (store: StoreName) => {\n        if (selectedStores.includes(store)) {\n            setSelectedStores(selectedStores.filter((s) => s !== store));\n        } else {\n            setSelectedStores([...selectedStores, store]);\n        }\n    };\n\n    // Validation\n    const validateStep2 = () => {\n        if (selectedStores.length === 0) return false;\n        return true;\n    };\n\n    const validateStep3 = () => {\n        if (!formData.email || !formData.email.includes(\"@\")) return false;\n        if (!formData.city) return false;\n        if (!formData.consent) return false;\n        return true;\n    };\n\n    // Navigation\n    const nextStep = () => {\n        if (step === 1) {\n            logFunnel(\"RFQ_STEP_2\", \"Products Reviewed\");\n            setStep(2);\n        } else if (step === 2) {\n            if (validateStep2()) {\n                logFunnel(\"RFQ_STEP_3\", `Stores Selected: ${selectedStores.length}`);\n                setStep(3);\n            } else {\n                alert(t.validation.select_store);\n            }\n        }\n    };\n\n    const prevStep = () => {\n        if (step > 1) setStep(step - 1);\n    };\n\n    // Submit\n    const handleSubmit = async () => {\n        if (!validateStep3()) {\n            alert(t.validation.fill_required);\n            return;\n        }\n\n        setLoading(true);\n        logFunnel(\"RFQ_SUBMITTED\");\n        track(\"submit_rfq\", {\n            city: formData.city,\n            customer_type: formData.customerType,\n            stores_count: selectedStores.length,\n            items_count: items.length\n        });\n\n        try {\n            const res = await fetch(\"/api/rfq/send\", {\n                method: \"POST\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify({\n                    ...formData,\n                    selectedStores,\n                    cartItems: items,\n                }),\n            });\n\n            const data = await res.json();\n            if (!res.ok) throw new Error(data.error || t.validation.error_sending);\n\n            // Persist user session for future convenience\n            await login({\n                email: formData.email,\n                name: formData.name,\n                city: formData.city\n            });\n\n            setSuccess(true);\n            logFunnel(\"RFQ_SUCCESS\");\n            track(\"rfq_success\");\n            if (window.innerWidth < 768) track(\"mobile_rfq_completed\");\n            clear();\n            window.scrollTo(0, 0);\n        } catch (err: any) {\n            logFunnel(\"RFQ_ERROR\", err.message);\n            alert(\"Viga: \" + err.message);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    // Rendering Success Screen\n    if (success) {\n        return (\n            <div className=\"mx-auto max-w-xl px-4 py-20 text-center animate-in zoom-in-95 duration-300\">\n                <div className=\"mx-auto mb-6 flex h-20 w-20 items-center justify-center rounded-full bg-emerald-900/40 border border-emerald-500/20 shadow-xl shadow-emerald-500/10\">\n                    <svg className=\"h-10 w-10 text-emerald-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                    </svg>\n                </div>\n                <h1 className=\"text-3xl font-bold text-white mb-2\">{t.rfq.success_title}</h1>\n                <p className=\"text-xl text-slate-400 mb-6\">\n                    {t.rfq.success_desc_prefix} <strong>{formData.email}</strong>.\n                </p>\n\n                <div className=\"bg-slate-900 rounded-2xl p-6 mb-8 text-left border border-slate-700\">\n                    <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                        <div>\n                            <span className=\"block text-slate-500 mb-1\">{t.rfq.selected_stores}</span>\n                            <span className=\"font-semibold text-white\">{selectedStores.length} {t.products.shops}</span>\n                        </div>\n                        <div>\n                            <span className=\"block text-slate-500 mb-1\">{t.rfq.item_count}</span>\n                            <span className=\"font-semibold text-white\">{items.length} {t.common.pcs}</span>\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n                    <Link href=\"/\" className=\"px-8 py-3 rounded-xl bg-slate-800 text-slate-200 font-bold hover:bg-slate-700 hover:text-white transition-colors border border-slate-700\">\n                        {t.common.back_home}\n                    </Link>\n                    <Link href=\"/products\" className=\"px-8 py-3 rounded-xl bg-emerald-600 text-white font-bold hover:bg-emerald-500 transition-colors shadow-lg shadow-emerald-900/20\">\n                        {t.products.add_to_cart}\n                    </Link>\n                </div>\n            </div>\n        );\n    }\n\n    if (items.length === 0) {\n        return (\n            <div className=\"mx-auto max-w-4xl px-4 py-16 text-center\">\n                <h1 className=\"text-3xl font-bold text-white mb-4\">{t.cart.empty_title}</h1>\n                <p className=\"text-slate-400 mb-8\">{t.cart.empty_text}</p>\n                <Link href=\"/products\" className=\"rounded-xl bg-orange-500 px-6 py-3 text-white font-bold hover:bg-orange-400 transition-colors shadow-lg shadow-orange-900/20\">\n                    {t.cart.open_catalog}\n                </Link>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"mx-auto max-w-4xl px-4 py-10\">\n            {/* NEW HEADLINE */}\n            <h1 className=\"text-3xl sm:text-4xl font-black text-white mb-2\">{t.rfq.hero_title}</h1>\n            <p className=\"text-lg text-slate-400 mb-10 flex items-center gap-2\">\n                <span className=\"bg-emerald-900/30 text-emerald-400 border border-emerald-500/20 px-2 py-0.5 rounded text-sm font-bold\">{t.rfq.hero_badge}</span>\n                {t.rfq.hero_subtitle}\n            </p>\n\n            {/* Progress Bar */}\n            <div className=\"flex items-center gap-4 mb-10 text-sm font-medium border-b border-slate-800 pb-4 overflow-x-auto\">\n                <div className={`whitespace-nowrap px-3 py-1 rounded-lg ${step >= 1 ? 'bg-slate-800 text-white font-bold border border-slate-700 shadow-sm ring-1 ring-white/5' : 'text-slate-500'}`}>{t.rfq.step_1}</div>\n                <div className=\"text-slate-600\">→</div>\n                <div className={`whitespace-nowrap px-3 py-1 rounded-lg ${step >= 2 ? 'bg-slate-800 text-white font-bold border border-slate-700 shadow-sm ring-1 ring-white/5' : 'text-slate-500'}`}>{t.rfq.step_2}</div>\n                <div className=\"text-slate-600\">→</div>\n                <div className={`whitespace-nowrap px-3 py-1 rounded-lg ${step >= 3 ? 'bg-slate-800 text-white font-bold border border-slate-700 shadow-sm ring-1 ring-white/5' : 'text-slate-500'}`}>{t.rfq.step_3}</div>\n            </div>\n\n            <div className=\"grid lg:grid-cols-12 gap-10\">\n                <div className=\"lg:col-span-12 bg-surface rounded-3xl p-8\">\n\n                    {/* STEP 1: PRODUCTS REVIEW */}\n                    {step === 1 && (\n                        <div className=\"animate-in slide-in-from-left-4 fade-in duration-300\">\n                            <h2 className=\"text-2xl font-bold text-white mb-6\">{t.rfq.review_products}</h2>\n                            {/* Mobile: Card View */}\n                            <div className=\"block sm:hidden space-y-4 mb-4\">\n                                {items.map((item) => {\n                                    const { displayName, unitName } = getTranslatedProduct(item, t);\n                                    return (\n                                        <div key={item.id} className=\"bg-slate-900/50 p-4 rounded-xl border border-slate-700\">\n                                            <div className=\"font-bold text-slate-200 mb-1\">{displayName}</div>\n                                            <div className=\"flex justify-between items-center text-sm text-slate-400\">\n                                                <span>{t.common.quantity}:</span>\n                                                <span className=\"font-semibold text-slate-200\">{item.qty} {unitName ?? t.common.pcs}</span>\n                                            </div>\n                                        </div>\n                                    );\n                                })}\n                            </div>\n\n                            {/* Desktop: Table View */}\n                            <div className=\"hidden sm:block bg-slate-900/30 rounded-2xl overflow-hidden border border-slate-700 mb-8\">\n                                <table className=\"w-full text-left text-sm\">\n                                    <thead className=\"bg-slate-900/80 text-slate-400 font-semibold border-b border-slate-700\">\n                                        <tr>\n                                            <th className=\"p-4\">{t.common.product}</th>\n                                            <th className=\"p-4 text-right\">{t.common.quantity}</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody className=\"divide-y divide-slate-700/50\">\n                                        {items.map((item) => {\n                                            const { displayName, unitName } = getTranslatedProduct(item, t);\n                                            return (\n                                                <tr key={item.id}>\n                                                    <td className=\"p-4 font-medium text-slate-200\">{displayName}</td>\n                                                    <td className=\"p-4 text-right text-slate-400\">\n                                                        {item.qty} {unitName ?? t.common.pcs}\n                                                    </td>\n                                                </tr>\n                                            );\n                                        })}\n                                    </tbody>\n                                </table>\n                            </div>\n\n                            <div className=\"flex justify-end\">\n                                <button onClick={nextStep} className=\"bg-emerald-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-emerald-500 shadow-lg shadow-emerald-900/20 transition-all active:scale-95 flex items-center gap-2\">\n                                    {t.rfq.next_select_stores} →\n                                </button>\n                            </div>\n                        </div>\n                    )}\n\n                    {/* STEP 2: STORES */}\n                    {step === 2 && (\n                        <div className=\"animate-in slide-in-from-right-4 fade-in duration-300\">\n                            <h2 className=\"text-2xl font-bold text-white mb-2\">{t.rfq.select_stores_title}</h2>\n                            <div className=\"bg-blue-900/20 border border-blue-500/20 p-4 rounded-xl mb-6 flex gap-3 text-sm text-blue-300\">\n                                <span className=\"font-bold text-xl\">💡</span>\n                                <p>{t.rfq.tip_pick_3}</p>\n                            </div>\n\n                            <div className=\"grid sm:grid-cols-2 gap-4 mb-8\">\n                                {SUPPORTED_STORES.map((store) => (\n                                    <label key={store} className={`flex items-center gap-4 p-4 rounded-xl border cursor-pointer transition-all ${selectedStores.includes(store) ? 'border-emerald-500 bg-emerald-900/20 ring-1 ring-emerald-500' : 'border-slate-700 bg-slate-900/30 hover:bg-slate-800 hover:border-slate-600'}`}>\n                                        <input\n                                            type=\"checkbox\"\n                                            checked={selectedStores.includes(store)}\n                                            onChange={() => toggleStore(store)}\n                                            className=\"w-5 h-5 text-emerald-500 rounded focus:ring-emerald-500/50 border-slate-600 bg-slate-800\"\n                                        />\n                                        <span className={`font-bold ${selectedStores.includes(store) ? 'text-emerald-400' : 'text-slate-200'}`}>{store}</span>\n                                    </label>\n                                ))}\n                            </div>\n\n                            <div className=\"flex justify-between mt-8 pt-6 border-t border-slate-700/50\">\n                                <button onClick={prevStep} className=\"text-slate-400 font-medium hover:text-white px-4 transition-colors\">{t.common.back}</button>\n                                <button onClick={nextStep} className=\"bg-emerald-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-emerald-500 shadow-lg shadow-emerald-900/20 transition-all active:scale-95\">\n                                    {t.rfq.next_contact} →\n                                </button>\n                            </div>\n                        </div>\n                    )}\n\n                    {/* STEP 3: CONTACT FORM & SUBMIT */}\n                    {step === 3 && (\n                        <div className=\"animate-in slide-in-from-right-4 fade-in duration-300\">\n                            <h2 className=\"text-2xl font-bold text-white mb-6\">{t.rfq.contact_title}</h2>\n\n                            <div className=\"grid gap-6 sm:grid-cols-2 mb-8\">\n                                {/* Segmentation */}\n                                <div className=\"col-span-2 bg-amber-900/10 rounded-xl p-5 border border-amber-500/20\">\n                                    <label className=\"block text-sm font-bold text-amber-400 mb-3\">{t.rfq.role_label}</label>\n                                    <div className=\"flex flex-col sm:flex-row gap-4\">\n                                        <label className=\"flex items-center gap-2 cursor-pointer\">\n                                            <input type=\"radio\" name=\"customerType\" value=\"private\" checked={formData.customerType === \"private\"} onChange={handleChange} className=\"w-4 h-4 text-orange-500 focus:ring-orange-500 bg-slate-900 border-slate-600\" />\n                                            <span className=\"text-sm text-slate-300\">{t.rfq.role_private}</span>\n                                        </label>\n                                        <label className=\"flex items-center gap-2 cursor-pointer\">\n                                            <input type=\"radio\" name=\"customerType\" value=\"builder\" checked={formData.customerType === \"builder\"} onChange={handleChange} className=\"w-4 h-4 text-orange-500 focus:ring-orange-500 bg-slate-900 border-slate-600\" />\n                                            <span className=\"text-sm text-slate-300\">{t.rfq.role_builder}</span>\n                                        </label>\n                                        <label className=\"flex items-center gap-2 cursor-pointer\">\n                                            <input type=\"radio\" name=\"customerType\" value=\"company\" checked={formData.customerType === \"company\"} onChange={handleChange} className=\"w-4 h-4 text-orange-500 focus:ring-orange-500 bg-slate-900 border-slate-600\" />\n                                            <span className=\"text-sm text-slate-300\">{t.rfq.role_company}</span>\n                                        </label>\n                                    </div>\n                                </div>\n\n                                <div className=\"col-span-2 sm:col-span-1\">\n                                    <label className=\"block text-sm font-medium text-slate-300 mb-1\">{t.rfq.email_label} <span className=\"text-red-400\">*</span></label>\n                                    <input autoFocus required name=\"email\" value={formData.email} onChange={handleChange} type=\"email\" className=\"w-full rounded-xl border border-slate-600 bg-slate-900 text-white px-4 py-3 outline-none focus:ring-2 focus:ring-blue-500 placeholder:text-slate-500 transition-colors\" placeholder=\"sinu@email.ee\" />\n                                </div>\n                                <div className=\"col-span-2 sm:col-span-1\">\n                                    <label className=\"block text-sm font-medium text-slate-300 mb-1\">{t.rfq.city_label} <span className=\"text-red-400\">*</span></label>\n                                    <select name=\"city\" value={formData.city} onChange={handleChange} className=\"w-full rounded-xl border border-slate-600 bg-slate-900 text-white px-4 py-3 outline-none focus:ring-2 focus:ring-blue-500 appearance-none\">\n                                        {CITIES.map(c => <option key={c} value={c}>{c}</option>)}\n                                    </select>\n                                </div>\n\n                                <div className=\"col-span-2 sm:col-span-1\">\n                                    <label className=\"block text-sm font-medium text-slate-300 mb-1\">{t.rfq.name_label}</label>\n                                    <input name=\"name\" value={formData.name} onChange={handleChange} type=\"text\" className=\"w-full rounded-xl border border-slate-600 bg-slate-900 text-white px-4 py-3 outline-none focus:ring-2 focus:ring-blue-500 placeholder:text-slate-500\" />\n                                </div>\n                                <div className=\"col-span-2 sm:col-span-1\">\n                                    <label className=\"block text-sm font-medium text-slate-300 mb-1\">{t.rfq.phone_label}</label>\n                                    <input name=\"phone\" value={formData.phone} onChange={handleChange} type=\"tel\" className=\"w-full rounded-xl border border-slate-600 bg-slate-900 text-white px-4 py-3 outline-none focus:ring-2 focus:ring-blue-500 placeholder:text-slate-500\" />\n                                </div>\n\n                                <div className=\"col-span-2\">\n                                    <label className=\"block text-sm font-medium text-slate-300 mb-1\">{t.rfq.notes_label}</label>\n                                    <textarea name=\"notes\" value={formData.notes} onChange={handleChange} rows={2} className=\"w-full rounded-xl border border-slate-600 bg-slate-900 text-white px-4 py-3 outline-none focus:ring-2 focus:ring-blue-500 placeholder:text-slate-500\" placeholder=\"Nt. soovin transporti objektile...\" />\n                                </div>\n                            </div>\n\n                            {/* Trust / What happens next */}\n                            <div className=\"bg-emerald-900/20 rounded-xl p-6 mb-8 border border-emerald-500/20\">\n                                <h3 className=\"text-sm font-bold text-emerald-400 mb-4 flex items-center gap-2\">\n                                    <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" /></svg>\n                                    {t.rfq.what_next_title}\n                                </h3>\n                                <div className=\"space-y-3\">\n                                    <p className=\"text-sm text-slate-400 ml-6\">\n                                        1. {t.rfq.what_next_1.replace(\"{count}\", selectedStores.length.toString())}\n                                    </p>\n                                    <p className=\"text-sm text-slate-400 ml-6\">\n                                        2. {t.rfq.what_next_2}\n                                    </p>\n                                    <p className=\"text-sm text-slate-400 ml-6\">\n                                        3. {t.rfq.what_next_3}\n                                    </p>\n                                </div>\n                            </div>\n\n                            <label className=\"flex items-center gap-3 mb-8 cursor-pointer group select-none\">\n                                <input\n                                    type=\"checkbox\"\n                                    required\n                                    name=\"consent\"\n                                    checked={formData.consent}\n                                    onChange={handleChange}\n                                    className=\"w-5 h-5 text-orange-500 rounded border-slate-600 bg-slate-800 focus:ring-orange-500\"\n                                />\n                                <span className=\"text-sm text-slate-400 group-hover:text-white transition-colors\">\n                                    {t.rfq.consent_label}\n                                </span>\n                            </label>\n\n                            <div className=\"flex justify-between mt-8 pt-6 border-t border-slate-700/50\">\n                                <button onClick={prevStep} className=\"text-slate-400 font-medium hover:text-white px-4 transition-colors\">{t.common.back}</button>\n                                <button\n                                    disabled={loading || !formData.consent || !formData.email}\n                                    onClick={handleSubmit}\n                                    className=\"bg-emerald-600 text-white px-10 py-4 rounded-xl font-bold shadow-lg shadow-emerald-500/30 hover:bg-emerald-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all transform active:scale-95 flex items-center gap-2 w-full sm:w-auto justify-center\"\n                                >\n                                    {loading ? (\n                                        <>\n                                            <svg className=\"animate-spin h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n                                                <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n                                                <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n                                            </svg>\n                                            {t.rfq.sending}\n                                        </>\n                                    ) : (\n                                        <>{t.rfq.submit_btn}</>\n                                    )}\n                                </button>\n                            </div>\n\n                            {/* Conversion Element: Risk Reversal & Clarity */}\n                            <div className=\"mt-4 flex flex-wrap justify-center gap-x-6 gap-y-2 text-xs font-medium text-slate-500\">\n                                <span className=\"flex items-center gap-1.5\">\n                                    <svg className=\"w-3.5 h-3.5 text-emerald-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2.5}><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M5 13l4 4L19 7\" /></svg>\n                                    {t.rfq.spam_free}\n                                </span>\n                                <span className=\"flex items-center gap-1.5\">\n                                    <svg className=\"w-3.5 h-3.5 text-emerald-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2.5}><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M5 13l4 4L19 7\" /></svg>\n                                    {t.rfq.data_privacy}\n                                </span>\n                            </div>\n                        </div>\n                    )}\n\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/robots.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/app/sitemap.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/auth/SocialLoginModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/auth/UserProvider.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getSession' is defined but never used.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":20,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"getSession"},"fix":{"range":[150,161],"text":""},"desc":"Remove unused variable \"getSession\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":101,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":104,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2019,2022],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2019,2022],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { createContext, useContext, useEffect, useState } from \"react\";\nimport type { UserSession} from \"@/app/actions/auth\";\nimport { getSession, login as serverLogin, logout as serverLogout } from \"@/app/actions/auth\";\nimport { supabase, signInWithOAuth, isDemoMode } from \"@/app/lib/supabaseClient\";\n\ntype UserContextType = {\n    user: UserSession | null;\n    loading: boolean;\n    login: (data: { email: string; name?: string; city?: string }) => Promise<void>;\n    loginWithSocial: (provider: \"google\" | \"facebook\" | \"apple\") => Promise<void>;\n    logout: () => Promise<void>;\n};\n\nconst UserContext = createContext<UserContextType>({\n    user: null,\n    loading: true,\n    login: async () => { },\n    loginWithSocial: async () => { },\n    logout: async () => { },\n});\n\nexport function UserProvider({ children }: { children: React.ReactNode }) {\n    const [user, setUser] = useState<UserSession | null>(null);\n    const [loading, setLoading] = useState(true);\n\n    // Restore session on mount & Listen for changes\n    useEffect(() => {\n        const init = async () => {\n            try {\n                // 1. Get initial session\n                const { data: { session } } = await supabase.auth.getSession();\n                if (session?.user) {\n                    setUser({\n                        id: session.user.id,\n                        email: session.user.email || \"\",\n                        name: session.user.user_metadata?.full_name || session.user.user_metadata?.name,\n                        city: session.user.user_metadata?.city,\n                        createdAt: new Date(session.user.created_at).getTime(),\n                    });\n                }\n            } catch (err) {\n                console.error(\"Failed to restore session\", err);\n            } finally {\n                setLoading(false);\n            }\n        };\n        init();\n\n        // 2. Subscribe to changes\n        const { data: { subscription } } = supabase.auth.onAuthStateChange((event: string, session: any) => {\n            console.log(\"Auth State Change:\", event);\n            if (session?.user) {\n                setUser({\n                    id: session.user.id,\n                    email: session.user.email || \"\",\n                    name: session.user.user_metadata?.full_name || session.user.user_metadata?.name,\n                    city: session.user.user_metadata?.city,\n                    createdAt: new Date(session.user.created_at).getTime(),\n                });\n                setLoading(false);\n            } else if (event === 'SIGNED_OUT') {\n                setUser(null);\n                setLoading(false);\n            }\n        });\n\n        return () => subscription.unsubscribe();\n    }, []);\n\n    const login = async (data: { email: string; name?: string; city?: string }) => {\n        // Fallback for Email Login (if we keep the mock style or use Magic Link)\n        // For now, let's try to use Supabase signInWithOtp or Password if implemented.\n        // But the requirement says \"Keep existing Email login\" which was mock.\n        // Let's keep it mixed: If env vars exist, use real auth. If not, mock.\n\n        // Actually, if we use Supabase, we should probably stick to it. \n        // But to pass \"Email login remains available and working\" without rewriting the whole Login form logic \n        // (which currently assumes simple success), we might need to compromise.\n        // The existing Login page calls `login({ email })`.\n\n        // Let's implement a real Magic Link login if in Production mode?\n        // Or just keep the \"Mock\" behavior for Email to be safe as per prompt \"Keep existing... email login\".\n        // BUT persistence is required.\n        // If we mix them, state might conflict.\n\n        // DECISION: Map the \"Email Login\" to a simple Supabase Anonymous sign-in or just fake it LOCALLY \n        // but since we switched `setUser` to be driven by `onAuthStateChange`, manual `setUser` might be overwritten.\n\n        // Wait, if I call `setUser` manually here, it updates the state. \n        // If Supabase is disjoint, it's fine.\n        // But if I reload, Supabase won't know about this \"Mock User\".\n\n        // FIX: If we are in \"Real Mode\", we must create a real session.\n        // If we are in \"Demo Mode\", we use local state.\n\n        // For Simple Email Login to work with Persistence in Real Mode without Password flow (which needs UI),\n        // we might rely on the existing mock implementation for now unless specific instructions to change it.\n        // \"Keep existing Email login fully working\".\n\n        const newUser = await serverLogin(data); // This sets a cookie.\n        setUser(newUser);\n        // Supabase listener won't fire for this cookie change unless we sync them. \n        // This is a dual-stack approach. It's tricky.\n        // Ideally we'd replace `serverLogin` with `supabase.auth.signInWithPassword`.\n        // But we don't have a password field in the `data` arg here necessarily?\n        // Let's check the Login page implementation next.\n    };\n\n    const loginWithSocial = async (provider: \"google\" | \"facebook\" | \"apple\") => {\n        await signInWithOAuth(provider);\n        // Redirect happens, so no need to setUser here immediately.\n    };\n\n    const logout = async () => {\n        await serverLogout(); // Clears cookie\n        if (!isDemoMode) {\n            await supabase.auth.signOut();\n        }\n        setUser(null);\n    };\n\n    return (\n        <UserContext.Provider value={{ user, loading, login, loginWithSocial, logout }}>\n            {children}\n        </UserContext.Provider>\n    );\n}\n\nexport const useUser = () => useContext(UserContext);\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/cart/CartProvider.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/dmitri/smartbuild-site/components/cart/CartProvider.tsx:34:17\n  32 |             if (stored) {\n  33 |                  \n> 34 |                 setItems(JSON.parse(stored));\n     |                 ^^^^^^^^ Avoid calling setState() directly within an effect\n  35 |             }\n  36 |         } catch (e) {\n  37 |             console.error(\"Failed to load cart\", e);","line":34,"column":17,"nodeType":null,"endLine":34,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport React, { createContext, useContext, useEffect, useState } from \"react\";\n\nimport type { Product } from \"@/app/lib/types\";\n\nexport type CartItem = Product & {\n    qty: number;\n    // We keep offers here to calculate totals roughly - already in Product but we can keep overlap if needed\n};\n\ntype CartContextType = {\n    items: CartItem[];\n    addItem: (product: Product, qty?: number) => void;\n    updateItem: (id: string, qty: number) => void;\n    inc: (id: string) => void;\n    dec: (id: string) => void;\n    remove: (id: string) => void;\n    clear: () => void;\n    totalItems: number;\n};\n\nconst CartContext = createContext<CartContextType | null>(null);\n\nexport function CartProvider({ children }: { children: React.ReactNode }) {\n    const [items, setItems] = useState<CartItem[]>([]);\n\n    // Load from local storage on mount\n    useEffect(() => {\n        try {\n            const stored = localStorage.getItem(\"sb_cart\");\n            if (stored) {\n                 \n                setItems(JSON.parse(stored));\n            }\n        } catch (e) {\n            console.error(\"Failed to load cart\", e);\n        }\n    }, []);\n\n    // Save to local storage on change\n    useEffect(() => {\n        try {\n            localStorage.setItem(\"sb_cart\", JSON.stringify(items));\n        } catch (e) {\n            console.error(\"Failed to save cart\", e);\n        }\n    }, [items]);\n\n    const addItem = (product: Product, qty = 1) => {\n        setItems((prev) => {\n            const existing = prev.find((p) => p.id === product.id);\n            if (existing) {\n                return prev.map((p) =>\n                    p.id === product.id ? { ...p, qty: p.qty + qty } : p\n                );\n            }\n            // Create new item - spread product to keep all i18n keys\n            return [\n                ...prev,\n                {\n                    ...product,\n                    // offers: product.offers provided by spread ...product\n                    qty,\n                },\n            ];\n        });\n    };\n\n    const updateItem = (id: string, qty: number) => {\n        setItems((prev) =>\n            prev.map((p) => (p.id === id ? { ...p, qty } : p))\n        );\n    };\n\n    const inc = (id: string) => {\n        setItems((prev) =>\n            prev.map((p) => (p.id === id ? { ...p, qty: p.qty + 1 } : p))\n        );\n    };\n\n    const dec = (id: string) => {\n        setItems((prev) =>\n            prev\n                .map((p) => (p.id === id ? { ...p, qty: Math.max(1, p.qty - 1) } : p))\n                .filter((p) => p.qty > 0)\n        );\n    };\n\n    const remove = (id: string) => {\n        setItems((prev) => prev.filter((p) => p.id !== id));\n    };\n\n    const clear = () => {\n        setItems([]);\n    };\n\n    const totalItems = items.reduce((acc, curr) => acc + curr.qty, 0);\n\n    return (\n        <CartContext.Provider\n            value={{ items, addItem, updateItem, inc, dec, remove, clear, totalItems }}\n        >\n            {children}\n        </CartContext.Provider>\n    );\n}\n\nexport function useCart() {\n    const ctx = useContext(CartContext);\n    if (!ctx) throw new Error(\"useCart must be used within CartProvider\");\n    return ctx;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/cart/WoltDeliveryWidget.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1012,1015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1012,1015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleUndo' is assigned a value but never used.","line":132,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":132,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo } from \"react\";\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\nimport type { WoltEstimateResponse, WoltOrderResponse, WoltEligibility } from \"@/app/lib/wolt\";\nimport { checkDeliveryEligibility, getSmartSuggestion, CITIES } from \"@/app/lib/wolt\";\nimport type { CartItem } from \"@/components/cart/CartProvider\";\nimport { useCart } from \"@/components/cart/CartProvider\";\nimport WoltSmartTip from \"./WoltSmartTip\";\n\ntype DeliveryMethod = \"pickup\" | \"wolt\";\n\ninterface WoltState {\n    street: string;\n    city: string;\n    phone: string;\n    method: DeliveryMethod;\n}\n\nexport default function WoltDeliveryWidget({\n    items,\n    onDeliveryChange\n}: {\n    items: CartItem[];\n    onDeliveryChange: (method: DeliveryMethod) => void;\n}) {\n    const { t } = useLanguage();\n    // Assuming t works as Dictionary, but if strict typing fails we cast to Record<string, any>\n    // to match legacy behavior without 'any'.\n    const dict = t as unknown as Record<string, any>;\n\n    const { updateItem } = useCart();\n    const [method, setMethod] = useState<DeliveryMethod>(\"pickup\");\n    const [address, setAddress] = useState({ street: \"\", city: \"Tallinn\", phone: \"\" });\n    const [estimate, setEstimate] = useState<WoltEstimateResponse | null>(null);\n    const [loading, setLoading] = useState(false);\n    const [order, setOrder] = useState<WoltOrderResponse | null>(null);\n    const [eligibilityResult, setEligibilityResult] = useState<WoltEligibility | null>(null);\n\n    // Auto-check on load/change\n    useEffect(() => {\n        const result = checkDeliveryEligibility(items, address.city);\n        setEligibilityResult(result);\n    }, [items, address.city]);\n\n    // Load persisted preference\n    useEffect(() => {\n        const savedCity = localStorage.getItem(\"sb_wolt_city\");\n        if (savedCity && CITIES.includes(savedCity)) {\n            setAddress(prev => ({ ...prev, city: savedCity }));\n        }\n    }, []);\n\n    // Persist choice\n    const handleCityChange = (newCity: string) => {\n        setAddress({ ...address, city: newCity });\n        localStorage.setItem(\"sb_wolt_city\", newCity);\n    };\n    // Tip State (to handle Undo)\n    const [lastAction, setLastAction] = useState<{ type: string; itemId: string; originalQty: number } | null>(null);\n\n    // Calc split\n    const eligibility = useMemo(() => {\n        return checkDeliveryEligibility(items, address.city);\n    }, [items, address.city]);\n\n    const isFullyEligible = eligibility.state === 'eligible';\n    const isSplitPossible = eligibility.state === 'partial';\n\n    // Enrich items for rendering\n    const enrichedEligibleItems = useMemo(() => {\n        return eligibility.eligibleItems.map(ei => {\n            const original = items.find(i => (i.id) === ei.id) || {\n                name: 'Unknown',\n                id: ei.id,\n                price: 0,\n                image: '',\n                qty: 0,\n                // Add required CartItem/Product properties mock\n                genericNameKey: 'prod_unknown',\n                categoryKey: 'cat_unknown',\n                category: 'Unknown',\n                unit: 'pcs',\n                offers: []\n            } as unknown as CartItem;\n            return { ...original, qty: ei.qty };\n        });\n    }, [eligibility, items]);\n\n    const enrichedIneligibleItems = useMemo(() => {\n        return eligibility.ineligibleItems.map(ei => {\n            const original = items.find(i => (i.id) === ei.id);\n            return { item: { ...(original || {}), qty: original?.qty || 0 }, reasons: ei.reasons };\n        });\n    }, [eligibility, items]);\n\n    // On-the-fly Totals\n    const eligibleTotals = useMemo(() => ({\n        weight: enrichedEligibleItems.reduce((s, i) => s + (i.weightKg || 0) * i.qty, 0),\n        count: enrichedEligibleItems.reduce((s, i) => s + i.qty, 0)\n    }), [enrichedEligibleItems]);\n\n    const ineligibleTotals = useMemo(() => ({\n        weight: enrichedIneligibleItems.reduce((s, i) => s + (i.item.weightKg || 0) * (i.item.qty || 1), 0),\n        count: enrichedIneligibleItems.reduce((s, i) => s + (i.item.qty || 1), 0)\n    }), [enrichedIneligibleItems]);\n\n    const isWoltAvailable = isFullyEligible || isSplitPossible;\n\n    // Analytics: Track Tip Impression\n    const suggestion = useMemo(() => {\n        if (eligibility.ineligibleItems.length === 0) return null;\n        return getSmartSuggestion(items);\n    }, [items, eligibility]);\n\n    useEffect(() => {\n        if (method === \"wolt\" && suggestion && !isFullyEligible) {\n            console.log(\"[ANALYTICS] inline_tip_shown\", {\n                type: suggestion.type,\n                reason: suggestion.reason,\n                item: suggestion.itemName\n            });\n        }\n    }, [method, suggestion, isFullyEligible]);\n\n    // Analytics: Track Success\n    useEffect(() => {\n        if (method === \"wolt\" && isFullyEligible && lastAction) {\n            console.log(\"[ANALYTICS] inline_tip_success_enabled_wolt\", { success: true });\n        }\n    }, [method, isFullyEligible, lastAction]);\n\n    // Undo\n    const handleUndo = () => {\n        if (!lastAction) return;\n        if (lastAction.type === \"REDUCE_QTY\") {\n            updateItem(lastAction.itemId, lastAction.originalQty);\n        }\n        setLastAction(null);\n    };\n\n    // Initialize state from localStorage\n    useEffect(() => {\n        try {\n            const saved = localStorage.getItem(\"sb_wolt_state\");\n            if (saved) {\n                const parsed = JSON.parse(saved);\n                if (parsed.method && (parsed.method === 'pickup' || isWoltAvailable)) {\n                    setMethod(parsed.method);\n                    onDeliveryChange(parsed.method);\n                } else if (parsed.method === 'wolt' && !isWoltAvailable) {\n                    setMethod('pickup');\n                    onDeliveryChange('pickup');\n                }\n                if (parsed.street) setAddress({ street: parsed.street, city: parsed.city || \"Pärnu\", phone: parsed.phone || \"\" });\n            }\n        } catch (e) {\n            console.error(\"Failed to load wolt state\", e);\n        }\n    }, [onDeliveryChange, isWoltAvailable]);\n\n    // Persist state\n    useEffect(() => {\n        const state: WoltState = { ...address, method };\n        localStorage.setItem(\"sb_wolt_state\", JSON.stringify(state));\n    }, [address, method]);\n\n    // Helper to calc price (Mock)\n    const getQuoteForItems = async (items: unknown[]) => {\n        return { price: 5.90 + (items.length * 0.1), eta: 35 };\n    };\n\n    const handleEstimate = async () => {\n        if (!address.street || !address.phone) return;\n        setLoading(true);\n        setEstimate(null); // Reset prev estimate\n        try {\n            await new Promise(r => setTimeout(r, 600)); // Fake network delay\n\n            const result = checkDeliveryEligibility(items, address.city);\n            setEligibilityResult(result);\n\n            if (result.state === 'eligible' || result.state === 'partial') {\n                const pricing = await getQuoteForItems(result.eligibleItems);\n                setEstimate({\n                    price: pricing.price,\n                    eta_minutes: pricing.eta,\n                    currency: \"EUR\",\n                    is_demo: true,\n                });\n            } else {\n                setEstimate(null);\n            }\n        } catch (e) {\n            console.error(e);\n            alert(dict.wolt?.error_estimate || \"Error\");\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleCreateOrder = async () => {\n        if (!estimate) return;\n        setLoading(true);\n        try {\n            await new Promise(r => setTimeout(r, 1000));\n            setOrder({\n                tracking_url: \"https://wolt.com/track/mock\",\n                order_id: \"mock_order_123\",\n                eta: \"35 min\"\n            } as unknown as WoltOrderResponse);\n        } catch (e) {\n            console.error(e);\n            alert(\"Failed to create order\");\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    if (eligibilityResult === null && !estimate) {\n        // Initial state logic, maybe empty return or loading?\n        // Kept existing flow\n    }\n\n    return (\n        <div className=\"mt-8 rounded-3xl bg-surface p-6 overflow-hidden\">\n            <h2 className=\"text-xl text-premium mb-6 flex items-center gap-2\">\n                {t.cart.title} <span className=\"text-slate-500 text-base font-normal\">(Delivery)</span>\n            </h2>\n\n            {/* Delivery Method Selector */}\n            <div className=\"flex gap-4 mb-6\">\n                <label className={`flex-1 cursor-pointer rounded-xl border p-4 transition-all ${method === 'pickup' ? 'border-emerald-500 bg-emerald-900/20 text-emerald-100 ring-1 ring-emerald-500/50' : 'border-slate-700 bg-slate-800/50 hover:border-emerald-500/50 hover:bg-slate-800'}`}>\n                    <input\n                        type=\"radio\"\n                        name=\"delivery\"\n                        value=\"pickup\"\n                        checked={method === \"pickup\"}\n                        onChange={() => { setMethod(\"pickup\"); onDeliveryChange(\"pickup\"); }}\n                        className=\"sr-only\"\n                    />\n                    <div className=\"flex items-center gap-3\">\n                        <span className=\"text-2xl\">🏪</span>\n                        <div className=\"font-bold text-sm md:text-base\">{dict.wolt?.method_pickup}</div>\n                    </div>\n                </label>\n\n                <label className={`flex-1 relative rounded-xl border p-4 transition-all ${!isWoltAvailable ? 'opacity-50 cursor-not-allowed border-slate-800 bg-slate-900' : (method === 'wolt' ? 'cursor-pointer border-blue-500 bg-blue-900/20 text-blue-100 ring-1 ring-blue-500/50' : 'cursor-pointer border-slate-700 bg-slate-800/50 hover:border-blue-500/50 hover:bg-slate-800')}`}>\n                    <input\n                        type=\"radio\"\n                        name=\"delivery\"\n                        value=\"wolt\"\n                        checked={method === \"wolt\"}\n                        onChange={() => {\n                            if (isWoltAvailable) {\n                                setMethod(\"wolt\");\n                                onDeliveryChange(\"wolt\");\n                            }\n                        }}\n                        disabled={!isWoltAvailable}\n                        className=\"sr-only\"\n                    />\n                    <div className=\"flex items-center gap-3\">\n                        <span className=\"text-2xl\">🚙</span>\n                        <div>\n                            <div className=\"font-bold text-sm md:text-base\">{dict.wolt?.method_wolt}</div>\n                            {method !== 'wolt' && <div className=\"text-xs text-slate-400\">Powered by Wolt Drive</div>}\n                        </div>\n                    </div>\n                    {/* Eligibility Badge */}\n                    {!isFullyEligible && !isSplitPossible && (\n                        <div className=\"absolute -top-2 -right-2 bg-red-100 text-red-600 text-[10px] font-bold px-2 py-1 rounded-full border border-red-200\">\n                            N/A\n                        </div>\n                    )}\n                    {/* Split Badge */}\n                    {isSplitPossible && (\n                        <div className=\"absolute -top-2 -right-2 bg-amber-100 text-amber-700 text-[10px] font-bold px-2 py-1 rounded-full border border-amber-200\">\n                            Partial\n                        </div>\n                    )}\n\n                    {/* INLINE SMART TIP */}\n                    {suggestion && !isFullyEligible && (\n                        <div className=\"w-full mt-2\" onClick={e => { e.preventDefault(); e.stopPropagation(); }}>\n                            <WoltSmartTip\n                                suggestion={suggestion}\n                                items={items}\n                                city={address.city}\n                                onApply={(newItem) => updateItem(newItem.id, newItem.qty)}\n                                onUndo={() => lastAction && lastAction.type === \"REDUCE_QTY\" && updateItem(lastAction.itemId, lastAction.originalQty)}\n                            />\n                        </div>\n                    )}\n                </label>\n            </div>\n\n            {/* ERROR VIEW */}\n            {!isWoltAvailable && (\n                <div className=\"mb-6 p-4 bg-red-900/20 border border-red-500/30 rounded-xl\">\n                    <h3 className=\"text-sm font-bold text-red-200 flex items-center gap-2 mb-2\">{dict.wolt?.ineligible_title}</h3>\n                    <div className=\"text-sm text-red-200/70 mb-3 space-y-1\">\n                        {enrichedIneligibleItems.map((si, idx) => (\n                            <div key={idx}>• {si.item.name} (x{si.item.qty}): {si.reasons.map(r => dict.wolt?.reasons?.[r] || r).join(\", \")}</div>\n                        ))}\n                    </div>\n                </div>\n            )}\n\n            {/* PARTIAL VIEW */}\n            {method === \"wolt\" && isSplitPossible && (\n                <div className=\"mb-6 space-y-4 animate-in fade-in\">\n                    <div className=\"bg-amber-900/30 border border-amber-500/50 rounded-xl p-6 text-center\">\n                        <div className=\"h-12 w-12 bg-amber-500/20 rounded-full flex items-center justify-center mx-auto mb-3 text-2xl\">⚠️</div>\n                        <h3 className=\"text-lg font-bold text-amber-100 mb-2\">{dict.wolt?.split_title || \"Tellimus jagatakse kaheks\"}</h3>\n                        <button className=\"bg-amber-500 hover:bg-amber-400 text-amber-950 font-bold py-2 px-6 rounded-lg transition-colors shadow-lg shadow-amber-900/40\">\n                            {dict.wolt?.action_auto_split || \"Jaga korv automaatselt\"}\n                        </button>\n                    </div>\n\n                    {/* Eligible Section */}\n                    <div className=\"rounded-xl border border-slate-700/50 overflow-hidden\">\n                        <div className=\"bg-slate-800/80 border-b border-slate-700 px-4 py-3 flex justify-between items-center\">\n                            <h4 className=\"font-bold text-slate-200 flex items-center gap-2\"><span className=\"text-lg\">🚙</span> {dict.wolt?.wolt_eligible_section}</h4>\n                            <span className=\"text-xs font-medium text-slate-400 bg-slate-900 px-2 py-1 rounded border border-slate-700\">\n                                {eligibleTotals.weight.toFixed(1)}kg / {eligibleTotals.count} items\n                            </span>\n                        </div>\n                        <div className=\"p-4 bg-slate-900/50\">\n                            <ul className=\"space-y-2 mb-4\">\n                                {enrichedEligibleItems.map((item, i) => (\n                                    <li key={i} className=\"text-sm flex justify-between text-slate-300\">\n                                        <span>{item.name}</span>\n                                        <span className=\"font-medium text-slate-100\">x{item.qty}</span>\n                                    </li>\n                                ))}\n                            </ul>\n                            {/* Form rendered for eligible only */}\n                            {!order && (\n                                <div className=\"space-y-4 pt-4 border-t border-slate-800\">\n                                    <div className=\"grid md:grid-cols-2 gap-4\">\n                                        <div>\n                                            <label className=\"block text-xs font-bold uppercase tracking-wider text-slate-300 mb-1.5 ml-1\">{dict.wolt?.addr_street}</label>\n                                            <input type=\"text\" value={address.street} onChange={(e) => setAddress({ ...address, street: e.target.value })} className=\"w-full h-12 rounded-xl bg-slate-800 border-2 border-slate-600 text-white text-base px-4 placeholder:text-slate-400 outline-none\" placeholder=\"Riia 12\" />\n                                        </div>\n                                        <div>\n                                            <label className=\"block text-xs font-bold uppercase tracking-wider text-slate-300 mb-1.5 ml-1\">{dict.wolt?.addr_phone}</label>\n                                            <input type=\"tel\" value={address.phone} onChange={(e) => setAddress({ ...address, phone: e.target.value })} className=\"w-full h-12 rounded-xl bg-slate-800 border-2 border-slate-600 text-white text-base px-4 placeholder:text-slate-400 outline-none\" placeholder=\"+372 555 5555\" />\n                                        </div>\n                                    </div>\n                                    {estimate && (\n                                        <div className=\"bg-blue-900/40 rounded-xl p-4 border border-blue-500/50 flex justify-between items-center shadow-lg\">\n                                            <div>\n                                                <div className=\"text-xs text-blue-300 font-bold uppercase tracking-wider\">{dict.wolt?.est_price}</div>\n                                                <div className=\"text-2xl font-black text-white\">{estimate.price.toFixed(2)} €</div>\n                                            </div>\n                                            <div className=\"text-right\">\n                                                <div className=\"text-xl font-black text-white\">~{estimate.eta_minutes} min</div>\n                                            </div>\n                                        </div>\n                                    )}\n                                    <div className=\"flex gap-2\">\n                                        <button onClick={handleEstimate} disabled={!address.street || !address.phone || loading} className=\"flex-1 bg-white border border-slate-300 text-slate-700 text-sm font-bold py-2 rounded-lg hover:bg-slate-50\">{loading ? \"...\" : dict.wolt?.calc_price}</button>\n                                        {estimate && <button onClick={handleCreateOrder} disabled={loading} className=\"flex-1 bg-blue-600 text-white text-sm font-bold py-2 rounded-lg hover:bg-blue-700\">Confirm</button>}\n                                    </div>\n                                </div>\n                            )}\n                        </div>\n                    </div>\n\n                    {/* Ineligible Section */}\n                    <div className=\"rounded-xl border border-red-900/30 overflow-hidden\">\n                        <div className=\"bg-red-950/30 border-b border-red-900/30 px-4 py-3 flex justify-between items-center\">\n                            <h4 className=\"font-bold text-red-200 flex items-center gap-2\"><span className=\"text-lg\">❌</span> {dict.wolt?.wolt_ineligible_section || \"Pickup Only\"}</h4>\n                            <span className=\"text-xs font-medium text-red-400 bg-red-950/50 px-2 py-1 rounded border border-red-900/30\">\n                                {ineligibleTotals.weight.toFixed(1)}kg / {ineligibleTotals.count} items\n                            </span>\n                        </div>\n                        <div className=\"p-4 bg-red-950/10\">\n                            <ul className=\"space-y-2 mb-4\">\n                                {enrichedIneligibleItems.map((si, i) => (\n                                    <li key={i} className=\"text-sm flex justify-between items-start\">\n                                        <div>\n                                            <span className=\"text-slate-300\">{si.item.name}</span>\n                                            <div className=\"text-[10px] text-red-400\">{si.reasons.map(r => dict.wolt?.reasons?.[r] || r).join(\", \")}</div>\n                                        </div>\n                                        <span className=\"font-medium text-slate-400\">x{si.item.qty}</span>\n                                    </li>\n                                ))}\n                            </ul>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* FULLY ELIGIBLE VIEW */}\n            {method === \"wolt\" && isFullyEligible && (\n                <div className=\"animate-in slide-in-from-top-2 fade-in\">\n                    {!order ? (\n                        <div className=\"space-y-4\">\n                            <div className=\"grid md:grid-cols-2 gap-6\">\n                                <div className=\"space-y-4\">\n                                    <div>\n                                        <label className=\"block text-xs font-bold uppercase tracking-wider text-slate-300 mb-1.5 ml-1\">{dict.wolt?.addr_street}</label>\n                                        <input type=\"text\" value={address.street} onChange={(e) => setAddress({ ...address, street: e.target.value })} className=\"w-full h-12 rounded-xl bg-slate-800 border-2 border-slate-600 text-white text-base px-4 placeholder:text-slate-400 outline-none\" placeholder=\"Riia 12\" />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold uppercase tracking-wider text-slate-300 mb-1.5 ml-1\">{dict.wolt?.addr_phone}</label>\n                                        <input type=\"tel\" value={address.phone} onChange={(e) => setAddress({ ...address, phone: e.target.value })} className=\"w-full h-12 rounded-xl bg-slate-800 border-2 border-slate-600 text-white text-base px-4 placeholder:text-slate-400 outline-none\" placeholder=\"+372 555 5555\" />\n                                    </div>\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold uppercase tracking-wider text-slate-300 mb-1.5 ml-1\">{dict.wolt?.addr_city}</label>\n                                    <div className=\"relative\">\n                                        <select\n                                            value={address.city}\n                                            onChange={(e) => handleCityChange(e.target.value)}\n                                            className=\"w-full h-12 rounded-xl bg-slate-800 border-2 border-slate-600 text-white text-base px-4 appearance-none outline-none cursor-pointer\"\n                                        >\n                                            {CITIES.map(c => <option key={c} value={c}>{c}</option>)}\n                                        </select>\n                                    </div>\n                                </div>\n                            </div>\n                            {estimate && (\n                                <div className=\"bg-blue-900/20 rounded-xl p-4 border border-blue-500/30 flex items-center justify-between\">\n                                    <div><div className=\"text-xs text-blue-400 font-medium uppercase tracking-wider\">{dict.wolt?.est_price}</div><div className=\"text-2xl font-black text-blue-100\">{estimate.price.toFixed(2)} €</div></div>\n                                    <div><div className=\"text-xs text-blue-400 font-medium uppercase tracking-wider\">{dict.wolt?.est_time}</div><div className=\"text-2xl font-black text-blue-100\">~{estimate.eta_minutes} min</div></div>\n                                </div>\n                            )}\n                            <div className=\"flex gap-3 mt-4\">\n                                <button onClick={handleEstimate} disabled={!address.street || !address.phone || loading} className=\"flex-1 bg-slate-800 border border-slate-700 text-slate-300 font-bold py-3 rounded-xl hover:bg-slate-700 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors\">{loading ? \"...\" : dict.wolt?.calc_price}</button>\n                                {estimate && <button onClick={handleCreateOrder} disabled={loading} className=\"flex-1 bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-700 shadow-lg shadow-blue-500/20\">{dict.wolt?.confirm_delivery}</button>}\n                            </div>\n                        </div>\n                    ) : (\n                        <div className=\"bg-emerald-900/10 p-6 rounded-2xl border border-emerald-500/20 text-center\">\n                            <h3 className=\"text-xl font-bold text-emerald-100 mb-2\">Delivery Confirmed!</h3>\n                            <a href={order.tracking_url} target=\"_blank\" className=\"font-bold text-emerald-400 underline\">Track Order</a>\n                        </div>\n                    )}\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/cart/WoltSmartTip.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onUndo' is defined but never used. Allowed unused args must match /^_/u.","line":19,"column":68,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":74},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2533,2536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2533,2536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2780,2783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2780,2783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2969,2972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2969,2972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3323,3326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3323,3326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3676,3679],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3676,3679],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState, useMemo } from \"react\";\nimport { Check, Truck } from \"lucide-react\";\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\nimport type { SmartSuggestion } from \"@/app/lib/wolt\";\nimport { checkDeliveryEligibility } from \"@/app/lib/wolt\";\nimport type { CartItem } from \"@/components/cart/CartProvider\";\n\ninterface Props {\n    suggestion: SmartSuggestion;\n    items: CartItem[];\n    onApply: (newItem: CartItem) => void;\n    onUndo: () => void;\n    originalItem?: CartItem;\n    city: string;\n}\n\nexport default function WoltSmartTip({ suggestion, items, onApply, onUndo, city }: Props) {\n    const { t } = useLanguage();\n    const itemName = suggestion.itemName;\n\n    // Local Logic for Preview\n\n\n    // Initial values\n    const originalQty = suggestion.fromQty || 0;\n    const recommendedQty = suggestion.toQty || 0;\n    const [previewQty, setPreviewQty] = useState(recommendedQty);\n\n    const isQtyReduction = suggestion.type === \"REDUCE_QTY\";\n    const isRemove = suggestion.type === \"REMOVE_ITEM\";\n\n    // Hypothetical Check\n    // Hypothetical Check\n    const isEligible = useMemo(() => {\n        // Construct hypothetical cart\n        const hypotheticalItems = items.map(item => {\n            const isTarget = (item.id || item.name) === suggestion.itemId;\n            if (isRemove && isTarget) return { ...item, qty: 0 };\n            return isTarget ? { ...item, qty: previewQty } : item;\n        }).filter(i => i.qty > 0);\n\n        const check = checkDeliveryEligibility(hypotheticalItems, city);\n        return check.state === 'eligible';\n    }, [items, suggestion, isRemove, previewQty, city]);\n\n    const handleApply = () => {\n        const target = items.find(i => (i.id || i.name) === suggestion.itemId);\n        if (target) {\n            if (isRemove) {\n                // Zero qty effectively removes it (CartProvider handles logic usually, or we pass 0)\n                onApply({ ...target, qty: 0 });\n            } else {\n                onApply({ ...target, qty: previewQty });\n            }\n        }\n    };\n\n    return (\n        <div className=\"bg-blue-500/10 border border-blue-500/30 rounded-xl p-3 flex flex-col gap-2\">\n            <div className=\"flex items-start gap-3\">\n                <div className=\"p-2 bg-blue-500/20 rounded-full text-blue-400 shrink-0\">\n                    <Truck size={18} />\n                </div>\n                <div className=\"flex-1\">\n                    <h4 className=\"text-sm font-medium text-blue-200\">\n                        {((t as any).wolt?.tip_inline_general || \"Suggestion\").replace(\"{name}\", itemName)}\n                    </h4>\n                    <p className=\"text-xs text-blue-300/80 mt-0.5\">\n                        {isQtyReduction\n                            ? ((t as any).wolt?.tip_inline_reduce || \"Reduce {name}\").replace(\"{name}\", itemName).replace(\"{from}\", String(originalQty)).replace(\"{to}\", String(previewQty))\n                            : ((t as any).wolt?.tip_inline_move || \"Move {name}\").replace(\"{name}\", itemName)\n                        }\n                    </p>\n                    {isEligible && (\n                        <div className=\"flex items-center gap-1.5 mt-1 text-emerald-400 text-xs font-medium\">\n                            <Check size={12} />\n                            {(t as any).wolt?.tip_inline_success}\n                        </div>\n                    )}\n                </div>\n                <button\n                    onClick={handleApply}\n                    className=\"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white text-xs font-medium rounded-lg transition-colors\"\n                >\n                    {(t as any).wolt?.action_inline_apply}\n                </button>\n            </div>\n\n            {/* Range Slider for Qty (Only if Reduction) */}\n            {isQtyReduction && (\n                <div className=\"pl-10 pr-2 pb-1\">\n                    <div className=\"flex items-center gap-2\">\n                        <span className=\"text-xs text-slate-400\">{1}</span>\n                        <input\n                            type=\"range\"\n                            min={1}\n                            max={originalQty}\n                            value={previewQty}\n                            onChange={(e) => setPreviewQty(parseInt(e.target.value))}\n                            className=\"flex-1 h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-500\"\n                        />\n                        <span className=\"text-xs text-white font-mono bg-slate-800 px-1.5 py-0.5 rounded\">{previewQty}</span>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/home/FinalCTA.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/home/Hero.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1042,1045],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1042,1045],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\nimport HeroSearch from \"./HeroSearch\";\nimport HeroCTA from \"./HeroCTA\";\n\nexport default function Hero() {\n    const { t } = useLanguage();\n\n    return (\n        <section className=\"relative pt-20 pb-16 md:pt-32 md:pb-24 overflow-hidden bg-pattern-hero\">\n            <div className=\"container mx-auto px-4 text-center max-w-4xl relative z-10\">\n                {/* Visual Badge */}\n                <div className=\"inline-flex items-center gap-2 rounded-full border border-slate-700/50 bg-slate-800/40 backdrop-blur-md px-4 py-1.5 text-sm font-medium text-slate-300 mb-8 shadow-xl ring-1 ring-white/10\">\n                    <span className=\"relative flex h-2 w-2\">\n                        <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75\"></span>\n                        <span className=\"relative inline-flex rounded-full h-2 w-2 bg-emerald-500\"></span>\n                    </span>\n                    {(t as any).footer?.desc ?? \"Sõltumatu ehitusmaterjalide hindamine\"}\n                </div>\n\n                <h1 className=\"text-3xl md:text-6xl font-bold tracking-tight text-white mb-6 leading-[1.2] md:leading-[1.1] drop-shadow-lg px-2\">\n                    {t.hero.title_1} <br className=\"block md:hidden\" /> {t.hero.title_2} <br className=\"hidden md:block\" />\n                </h1>\n\n                <p className=\"text-lg md:text-xl text-slate-300 mb-10 max-w-2xl mx-auto leading-relaxed drop-shadow-sm font-light\">\n                    {t.hero.subtitle}\n                </p>\n\n                {/* Search Input */}\n                <HeroSearch />\n\n                {/* Trust Blocks */}\n                <div className=\"flex flex-wrap justify-center gap-4 text-slate-300 text-sm font-medium\">\n                    <div className=\"flex items-center gap-2 bg-slate-800/40 px-5 py-2.5 rounded-xl border border-slate-700/50 backdrop-blur-sm shadow-lg hover:bg-slate-800/60 transition-colors\">\n                        <svg className=\"w-5 h-5 text-emerald-400\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\"><path d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" strokeLinecap=\"round\" strokeLinejoin=\"round\" /></svg>\n                        <span>{t.trust.compare_prices}</span>\n                    </div>\n                    <div className=\"flex items-center gap-2 bg-slate-800/40 px-5 py-2.5 rounded-xl border border-slate-700/50 backdrop-blur-sm shadow-lg hover:bg-slate-800/60 transition-colors\">\n                        <svg className=\"w-5 h-5 text-blue-400\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\"><path d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" strokeLinecap=\"round\" strokeLinejoin=\"round\" /></svg>\n                        <span>{t.empty.sla_fast}</span>\n                    </div>\n                    <div className=\"flex items-center gap-2 bg-slate-800/40 px-5 py-2.5 rounded-xl border border-slate-700/50 backdrop-blur-sm shadow-lg hover:bg-slate-800/60 transition-colors\">\n                        <svg className=\"w-5 h-5 text-purple-400\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\"><path d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\" strokeLinecap=\"round\" strokeLinejoin=\"round\" /></svg>\n                        <span>{t.rfq.hero_subtitle}</span>\n                    </div>\n                </div>\n\n                <HeroCTA />\n            </div>\n        </section>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/home/HeroCTA.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/home/HeroSearch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/home/HowItWorks.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/home/SeoBlock.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[451,454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[451,454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\n\nexport default function SeoBlock() {\n    const { t } = useLanguage();\n\n    return (\n        <section className=\"py-8 bg-white\">\n            <div className=\"container mx-auto px-4 max-w-3xl text-center\">\n                <h2 className=\"sr-only\">{t.how_it_works.title}</h2>\n                <p className=\"text-sm text-slate-500 leading-relaxed\">\n                    {(t as any).footer?.desc ?? \"Sõltumatu ehitusmaterjalide hinnavõrdlusportaal Eestis.\"}\n                    {\" \"}\n                    {t.trust.compare_prices}.\n                    {\" \"}\n                    {t.hero.subtitle}\n                </p>\n            </div>\n        </section>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/home/TrustLogos.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Image' is defined but never used.","line":3,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":13,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Image"},"fix":{"range":[15,46],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport Image from \"next/image\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { track } from \"@/app/lib/analytics\";\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\n\nconst LOGOS = [\n    { name: \"Bauhof\", src: \"/logos/bauhof.png\" }, // Using placeholders or text if image not real\n    { name: \"K-Rauta\", src: \"/logos/k-rauta.png\" },\n    { name: \"Espak\", src: \"/logos/espak.png\" },\n    { name: \"Ehitus ABC\", src: \"/logos/ehitusabc.png\" },\n    { name: \"Decora\", src: \"/logos/decora.png\" },\n];\n\nexport default function TrustLogos() {\n    const { t } = useLanguage();\n    // Tracking visibility\n    const ref = useRef<HTMLDivElement>(null);\n    const [hasTracked, setHasTracked] = useState(false);\n\n    useEffect(() => {\n        const observer = new IntersectionObserver(([entry]) => {\n            if (entry.isIntersecting && !hasTracked) {\n                track(\"trust_block_viewed\", { block: \"homepage_logos\" });\n                setHasTracked(true);\n            }\n        });\n        if (ref.current) observer.observe(ref.current);\n        return () => observer.disconnect();\n    }, [hasTracked]);\n\n    return (\n        <section ref={ref} className=\"w-full bg-slate-900 border-b border-slate-800 py-8\">\n            <div className=\"container mx-auto px-4 text-center\">\n                <p className=\"text-xs font-medium text-slate-500 uppercase tracking-widest mb-6\">\n                    {t.trust.compare_prices}\n                </p>\n\n                <div className=\"flex flex-wrap justify-center items-center gap-8 md:gap-16 opacity-50 grayscale transition-all duration-500 hover:grayscale-0 hover:opacity-100\">\n                    {/* Text Fallback for Logos since we don't have actual SVG/Images handy in this env */}\n                    {LOGOS.map((store) => (\n                        <div key={store.name} className=\"flex items-center\">\n                            <span className=\"text-xl md:text-2xl font-black text-slate-300 pointer-events-none select-none font-sans tracking-tight\">\n                                {store.name}\n                            </span>\n                        </div>\n                    ))}\n                </div>\n            </div>\n        </section>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/i18n/LanguageProvider.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/dmitri/smartbuild-site/components/i18n/LanguageProvider.tsx:29:13\n  27 |         if (saved === \"et\" || saved === \"ru\") {\n  28 |              \n> 29 |             setLanguageState(saved);\n     |             ^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  30 |         }\n  31 |     }, []);\n  32 |","line":29,"column":13,"nodeType":null,"endLine":29,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1151,1154],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1151,1154],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1166,1169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1166,1169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1184,1187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1184,1187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { createContext, useContext, useEffect, useState } from \"react\";\nimport type { Dictionary } from \"@/app/lib/i18n/dictionary\";\nimport { ET_DICTIONARY, RU_DICTIONARY } from \"@/app/lib/i18n/dictionary\";\n\ntype Language = \"et\" | \"ru\";\n\ntype LanguageContextType = {\n    language: Language;\n    setLanguage: (lang: Language) => void;\n    t: Dictionary;\n};\n\nconst LanguageContext = createContext<LanguageContextType>({\n    language: \"et\",\n    setLanguage: () => { },\n    t: ET_DICTIONARY,\n});\n\nexport function LanguageProvider({ children }: { children: React.ReactNode }) {\n    const [language, setLanguageState] = useState<Language>(\"et\");\n\n    // Load from localStorage on mount\n    useEffect(() => {\n        const saved = localStorage.getItem(\"sb_lang\") as Language;\n        if (saved === \"et\" || saved === \"ru\") {\n             \n            setLanguageState(saved);\n        }\n    }, []);\n\n    const setLanguage = (lang: Language) => {\n        setLanguageState(lang);\n        localStorage.setItem(\"sb_lang\", lang);\n    };\n\n    // Safety mechanism: Proxy to fallback to ET if key missing in RU\n    const createSafeDictionary = (target: any, fallback: any, path = \"t\"): any => {\n        return new Proxy(target, {\n            get(obj, prop: string) {\n                const value = obj[prop];\n                const fallbackValue = fallback?.[prop];\n\n                if (value === undefined) {\n                    if (process.env.NODE_ENV === \"development\" && fallbackValue !== undefined) {\n                        console.warn(`[i18n] Missing translation for key: ${path}.${prop}`);\n                    }\n                    return fallbackValue; // Fallback to ET\n                }\n\n                if (typeof value === \"object\" && value !== null && !Array.isArray(value)) {\n                    return createSafeDictionary(value, fallbackValue, `${path}.${prop}`);\n                }\n\n                return value;\n            },\n        });\n    };\n\n    const t = language === \"ru\"\n        ? createSafeDictionary(RU_DICTIONARY, ET_DICTIONARY)\n        : ET_DICTIONARY;\n\n    return (\n        <LanguageContext.Provider value={{ language, setLanguage, t }}>\n            {children}\n        </LanguageContext.Provider>\n    );\n}\n\nexport const useLanguage = () => useContext(LanguageContext);\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/layout/BottomNav.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1879,1882],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1879,1882],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport { useCart } from \"@/components/cart/CartProvider\";\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\nimport { useUser } from \"@/components/auth/UserProvider\";\nimport { useState } from \"react\";\nimport SocialLoginModal from \"@/components/auth/SocialLoginModal\";\n\nexport default function BottomNav() {\n    const pathname = usePathname();\n    const { totalItems } = useCart();\n    const { t } = useLanguage();\n    const { user } = useUser();\n    const [showLogin, setShowLogin] = useState(false);\n\n    const isActive = (path: string) => pathname === path;\n\n    const handleProfileClick = (e: React.MouseEvent) => {\n        if (!user) {\n            e.preventDefault();\n            setShowLogin(true);\n        }\n    };\n\n    return (\n        <>\n            <div className=\"md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-50 px-6 py-3 safe-area-bottom\">\n                <div className=\"flex justify-between items-center max-w-sm mx-auto\">\n\n                    {/* Catalog */}\n                    <Link href=\"/products\" className={`flex flex-col items-center gap-1 ${isActive('/products') ? 'text-slate-900' : 'text-slate-400'}`}>\n                        <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z\" />\n                        </svg>\n                        <span className=\"text-[10px] font-medium\">{(t as any).footer?.catalog ?? \"Kataloog\"}</span>\n                    </Link>\n\n                    {/* Cart */}\n                    <Link href=\"/cart\" className={`flex flex-col items-center gap-1 relative ${isActive('/cart') ? 'text-slate-900' : 'text-slate-400'}`}>\n                        <div className=\"relative\">\n                            <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z\" />\n                            </svg>\n                            {totalItems > 0 && (\n                                <span className=\"absolute -top-1.5 -right-1.5 flex h-4 w-4 items-center justify-center rounded-full bg-orange-500 text-[10px] font-bold text-white ring-2 ring-white\">\n                                    {totalItems}\n                                </span>\n                            )}\n                        </div>\n                        <span className=\"text-[10px] font-medium\">{t.common.cart}</span>\n                    </Link>\n\n                    {/* Profile/Login */}\n                    <Link\n                        href={user ? \"/partner/dashboard\" : \"#\"}\n                        onClick={handleProfileClick}\n                        className={`flex flex-col items-center gap-1 ${isActive('/login') ? 'text-slate-900' : 'text-slate-400'}`}\n                    >\n                        <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\n                        </svg>\n                        <span className=\"text-[10px] font-medium\">\n                            {user ? user.name?.split(' ')[0] : t.common.login}\n                        </span>\n                    </Link>\n\n                </div>\n            </div>\n\n            <SocialLoginModal isOpen={showLogin} onClose={() => setShowLogin(false)} />\n        </>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/layout/Footer.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[517,520],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[517,520],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[719,722],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[719,722],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[904,907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[904,907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1035,1038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1035,1038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1226,1229],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1226,1229],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1406,1409],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1406,1409],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1538,1541],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1538,1541],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":114,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":117,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1698,1701],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1698,1701],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":105,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":108,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2065,2068],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2065,2068],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport Link from \"next/link\";\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\n\nexport default function Footer() {\n    const { t } = useLanguage();\n\n    return (\n        <footer className=\"bg-slate-900 text-slate-400 py-10 border-t border-slate-800\">\n            <div className=\"container mx-auto px-4 grid md:grid-cols-4 gap-8 mb-8\">\n                <div>\n                    <h3 className=\"text-white font-bold mb-4\">SmartBuild</h3>\n                    <p className=\"text-sm\">{(t as any).footer?.desc ?? \"Sõltumatu ehitusmaterjalide hinnavõrdlusportaal Eestis.\"}</p>\n                </div>\n                <div>\n                    <h4 className=\"text-white font-semibold mb-3\">{(t as any).footer?.customer ?? \"Kliendile\"}</h4>\n                    <ul className=\"text-sm space-y-2\">\n                        <li><Link href=\"/products\" className=\"hover:text-white\">{(t as any).footer?.catalog ?? \"Kataloog\"}</Link></li>\n                        <li><Link href=\"/cart\" className=\"hover:text-white\">{(t as any).footer?.rfq ?? \"Hinnapäring\"}</Link></li>\n                    </ul>\n                </div>\n                <div>\n                    <h4 className=\"text-white font-semibold mb-3\">{(t as any).footer?.company ?? \"Ettevõte\"}</h4>\n                    <ul className=\"text-sm space-y-2\">\n                        <li><Link href=\"/meist\" className=\"hover:text-white\">{(t as any).footer?.about_us ?? \"Meist\"}</Link></li>\n                        <li><Link href=\"/contact\" className=\"hover:text-white\">{(t as any).footer?.contact ?? \"Kontakt\"}</Link></li>\n                        <li><Link href=\"/partners\" className=\"hover:text-emerald-400 text-emerald-500/80\">{(t as any).footer?.partners ?? \"Partneritele\"}</Link></li>\n                        <li><Link href=\"/delivery-partners\" className=\"hover:text-blue-400 text-blue-500/80\">Delivery Partners</Link></li>\n                    </ul>\n                </div>\n                <div>\n                    <p className=\"text-xs text-slate-500 mt-4\">&copy; {new Date().getFullYear()} {(t as any).footer?.copyright ?? \"SmartBuild Eesti.\"}</p>\n                </div>\n            </div>\n        </footer>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/layout/Header.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1676,1679],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1676,1679],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport Link from \"next/link\";\nimport NavbarCartLink from \"./NavbarCartLink\";\nimport HeaderAuth from \"./HeaderAuth\";\nimport LanguageSwitcher from \"./LanguageSwitcher\";\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\nimport NotificationBell from \"@/components/notifications/NotificationBell\";\n\nexport default function Header() {\n    const { t } = useLanguage();\n\n    return (\n        <header className=\"sticky top-0 z-50 bg-[#0f172a] text-white shadow-md border-b border-slate-700\">\n            <div className=\"container mx-auto px-4 h-16 flex items-center justify-between\">\n                {/* Brand Logo */}\n                <Link href=\"/\" className=\"flex items-center gap-2 group\">\n                    <div className=\"bg-orange-500 rounded p-1\">\n                        <svg className=\"w-5 h-5 text-white\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\" />\n                        </svg>\n                    </div>\n                    <span className=\"text-xl font-bold tracking-tight text-white group-hover:text-slate-200 transition-colors\">\n                        SmartBuild\n                    </span>\n                </Link>\n\n                {/* Desktop Navigation */}\n                <nav className=\"hidden md:flex gap-8 items-center\">\n                    <Link href=\"/products\" className=\"text-sm font-medium text-slate-300 hover:text-white transition-colors\">\n                        {(t as any).footer?.catalog ?? \"Kataloog\"}\n                    </Link>\n                    <NavbarCartLink />\n                    <NotificationBell />\n                    <div className=\"h-5 w-px bg-slate-700\"></div>\n                    <HeaderAuth />\n                </nav>\n\n                {/* Mobile Menu Icon (Placeholder) */}\n                <div className=\"md:hidden flex items-center gap-4\">\n                    <LanguageSwitcher />\n                    <button className=\"text-slate-300 hover:text-white\">\n                        <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\n                        </svg>\n                    </button>\n                </div>\n            </div>\n        </header>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/layout/HeaderAuth.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/layout/LanguageSwitcher.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/layout/NavbarCartLink.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/notifications/NotificationBell.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":3,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":42,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useCallback"},"fix":{"range":[43,56],"text":""},"desc":"Remove unused variable \"useCallback\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2100,2103],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2100,2103],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2471,2474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2471,2474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2722,2725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2722,2725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2736,2739],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2736,2739],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":112,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4772,4775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4772,4775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState, useCallback } from \"react\";\nimport { Bell } from \"lucide-react\";\nimport { supabase } from \"@/app/lib/supabaseClient\";\nimport type { Notification } from \"@/app/lib/types\";\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\n\nexport default function NotificationBell() {\n    const { t } = useLanguage();\n    const router = useRouter();\n    const [notifications, setNotifications] = useState<Notification[]>([]);\n    const [unreadCount, setUnreadCount] = useState(0);\n    const [isOpen, setIsOpen] = useState(false);\n\n    useEffect(() => {\n        const fetchNotifications = async () => {\n            const { data: { user } } = await supabase.auth.getUser();\n            if (!user) return;\n\n            const { data } = await supabase\n                .from('notifications')\n                .select('*')\n                .eq('user_id', user.id)\n                .order('created_at', { ascending: false })\n                .limit(10);\n\n            if (data) {\n                const notifications = data as unknown as Notification[];\n                setNotifications(notifications);\n                setUnreadCount(notifications.filter((n) => !n.is_read).length);\n            }\n        };\n\n        fetchNotifications();\n\n        const interval = setInterval(fetchNotifications, 60000);\n        return () => clearInterval(interval);\n    }, []);\n\n    const handleRead = async (n: Notification) => {\n        if (!n.is_read) {\n            await supabase.from('notifications').update({ is_read: true }).eq('id', n.id);\n            // Optimistic update\n            setNotifications(prev => prev.map(item => item.id === n.id ? { ...item, is_read: true } : item));\n            setUnreadCount(prev => Math.max(0, prev - 1));\n        }\n        setIsOpen(false);\n        if (n.payload?.order_id) {\n            router.push(`/account/orders/${n.payload.order_id}`);\n        }\n    };\n\n    const getLocalizedText = (n: Notification) => {\n        const dict = (t as unknown as Record<string, any>).notifications || {};\n        const title = n.title_key ? titleFallback(n.title_key, dict) : n.title_text || \"\";\n        const body = n.body_key ? bodyFallback(n.body_key, dict, n.payload) : n.body_text || \"\";\n        return { title, body };\n    };\n\n    // Helper to resolve nested keys \"notifications.title.dispatched\"\n    const titleFallback = (key: string, dict: any) => {\n        const parts = key.split('.');\n        if (parts.length === 3 && parts[0] === 'notifications') {\n            return dict[parts[1]]?.[parts[2]] || key;\n        }\n        return key;\n    };\n\n    const bodyFallback = (key: string, dict: any, payload: any) => {\n        let text = titleFallback(key, dict); // Reuse logic\n        // Simple template replacement\n        if (payload) {\n            // e.g. {eta_range}\n            // payload might trigger other lookups, simplifed for now\n            Object.keys(payload).forEach(k => {\n                text = text.replace(`{${k}}`, payload[k]);\n            });\n        }\n        return text;\n    };\n\n    return (\n        <div className=\"relative\">\n            <button\n                onClick={() => setIsOpen(!isOpen)}\n                className=\"relative p-2 text-slate-600 hover:bg-slate-100 rounded-full transition-colors\"\n            >\n                <Bell size={20} />\n                {unreadCount > 0 && (\n                    <span className=\"absolute top-1 right-1 w-4 h-4 bg-red-500 text-white text-[10px] flex items-center justify-center rounded-full font-bold\">\n                        {unreadCount > 9 ? '9+' : unreadCount}\n                    </span>\n                )}\n            </button>\n\n            {isOpen && (\n                <>\n                    <div className=\"fixed inset-0 z-40\" onClick={() => setIsOpen(false)}></div>\n                    <div className=\"absolute right-0 top-full mt-2 w-80 bg-white rounded-2xl shadow-xl border border-slate-100 z-50 overflow-hidden\">\n                        <div className=\"p-3 border-b border-slate-50 flex justify-between items-center bg-slate-50/50\">\n                            <span className=\"font-bold text-sm text-slate-700\">Notifications</span>\n                            <Link href=\"/account/notifications\" className=\"text-xs text-blue-600 font-medium hover:underline\">\n                                View All\n                            </Link>\n                        </div>\n                        <div className=\"max-h-[400px] overflow-y-auto\">\n                            {notifications.length === 0 ? (\n                                <div className=\"p-8 text-center text-slate-400 text-sm\">\n                                    {(t as unknown as Record<string, any>).notifications?.empty || \"No notifications\"}\n                                </div>\n                            ) : (\n                                notifications.map(n => {\n                                    const { title, body } = getLocalizedText(n);\n                                    return (\n                                        <div\n                                            key={n.id}\n                                            onClick={() => handleRead(n)}\n                                            className={`p-3 border-b border-slate-50 hover:bg-slate-50 cursor-pointer flex gap-3 ${!n.is_read ? 'bg-blue-50/30' : ''}`}\n                                        >\n                                            <div className={`w-2 h-2 rounded-full mt-2 shrink-0 ${!n.is_read ? 'bg-blue-500' : 'bg-slate-200'}`}></div>\n                                            <div className=\"flex-1 min-w-0\">\n                                                <div className=\"text-sm font-semibold text-slate-800 truncate\">{title}</div>\n                                                <div className=\"text-xs text-slate-500 line-clamp-2 mt-0.5\">{body}</div>\n                                                <div className=\"text-[10px] text-slate-400 mt-1\">\n                                                    {new Date(n.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                                                </div>\n                                            </div>\n                                        </div>\n                                    );\n                                })\n                            )}\n                        </div>\n                    </div>\n                </>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/partner/PricingTable.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[404,407],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[404,407],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[621,624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[621,624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[808,811],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[808,811],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2169,2172],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2169,2172],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2375,2378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2375,2378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3762,3765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3762,3765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { PARTNER_PLANS } from \"@/app/lib/partners\";\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\n\nexport default function PricingTable() {\n    const { t } = useLanguage();\n\n    // Map plans to array for easier rendering\n    const plans = [\n        {\n            key: \"free\",\n            config: PARTNER_PLANS.free,\n            color: \"slate\",\n            title: (t as any).partner_plans?.tiers?.free || \"Baas\",\n        },\n        {\n            key: \"partner\",\n            config: PARTNER_PLANS.partner,\n            color: \"emerald\",\n            popular: true,\n            title: (t as any).partner_plans?.tiers?.pro || \"Pro\",\n        },\n        {\n            key: \"premium\",\n            config: PARTNER_PLANS.premium,\n            color: \"purple\",\n            title: (t as any).partner_plans?.tiers?.enterprise || \"Enterprise\",\n        },\n    ];\n\n    return (\n        <div className=\"grid md:grid-cols-3 gap-8 max-w-6xl mx-auto px-4\">\n            {plans.map((plan) => (\n                <div\n                    key={plan.key}\n                    className={`relative rounded-3xl p-8 border ${plan.popular ? 'border-emerald-500 shadow-xl shadow-emerald-500/10 bg-white ring-1 ring-emerald-500' : 'border-slate-200 bg-slate-50/50 hover:bg-white hover:shadow-lg transition-all'}`}\n                >\n                    {plan.popular && (\n                        <div className=\"absolute -top-4 left-1/2 -translate-x-1/2 bg-emerald-500 text-white px-4 py-1 rounded-full text-xs font-bold uppercase tracking-wide\">\n                            Populaarseim\n                        </div>\n                    )}\n\n                    <div className=\"mb-6\">\n                        <h3 className={`text-lg font-bold text-${plan.color}-900 mb-2`}>{plan.title}</h3>\n                        <div className=\"flex items-baseline gap-1\">\n                            {typeof plan.config.price === 'number' ? (\n                                <>\n                                    <span className=\"text-4xl font-black text-slate-900\">€{plan.config.price}</span>\n                                    <span className=\"text-slate-500 font-medium\">{(t as any).partner_plans?.period?.monthly}</span>\n                                </>\n                            ) : (\n                                <span className=\"text-3xl font-black text-slate-900\">{(t as any).partner_plans?.period?.custom}</span>\n                            )}\n                        </div>\n                    </div>\n\n                    <ul className=\"space-y-4 mb-8\">\n                        {plan.config.features.map((feature, i) => (\n                            <li key={i} className=\"flex items-start gap-3\">\n                                <svg className={`w-5 h-5 text-${plan.color}-500 flex-shrink-0`} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                                </svg>\n                                <span className=\"text-sm text-slate-600\">{feature}</span>\n                            </li>\n                        ))}\n                    </ul>\n\n                    <button\n                        className={`w-full py-3 rounded-xl font-bold transition-transform active:scale-95 ${plan.popular\n                                ? 'bg-emerald-600 text-white hover:bg-emerald-700 shadow-lg shadow-emerald-500/20'\n                                : `bg-white border border-slate-200 text-slate-700 hover:bg-slate-50 hover:text-slate-900`\n                            }`}\n                        onClick={() => window.location.href = \"mailto:sales@smartbuild.ee\"}\n                    >\n                        {(t as any).partner_plans?.contact_sales}\n                    </button>\n                </div>\n            ))}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/products/AddToCartButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/products/EmptyState.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2780,2783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2780,2783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport Link from \"next/link\";\nimport { track } from \"@/app/lib/analytics\";\nimport { useEffect } from \"react\";\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\n\nexport default function EmptyState() {\n    const { t } = useLanguage();\n\n    useEffect(() => {\n        track(\"empty_state_shown\");\n    }, []);\n\n    const handleCtaClick = () => {\n        track(\"empty_state_cta_click\");\n    };\n\n    return (\n        <div className=\"flex flex-col items-center justify-center py-20 px-4 text-center animate-in fade-in duration-500\">\n            {/* Friendly Icon */}\n            <div className=\"bg-slate-800/50 p-6 rounded-full border border-slate-700/50 mb-6 backdrop-blur-sm\">\n                <svg className=\"w-12 h-12 text-slate-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={1.5}>\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\n                </svg>\n            </div>\n\n            <h3 className=\"text-xl md:text-2xl font-bold text-white mb-2\">{t.empty.no_results_title}</h3>\n            <p className=\"text-slate-400 max-w-md mx-auto mb-10\">\n                {t.empty.no_results_desc}\n            </p>\n\n            {/* Primary Action */}\n            <Link\n                href=\"/rfq\"\n                onClick={handleCtaClick}\n                className=\"group relative flex flex-col items-center justify-center w-full sm:w-auto min-w-[280px] px-8 py-3.5 rounded-xl bg-emerald-600 hover:bg-emerald-500 text-white shadow-xl shadow-emerald-500/20 hover:shadow-emerald-500/30 transition-all active:scale-[0.98] border border-emerald-500/50 mb-12\"\n            >\n                <span className=\"text-base font-bold tracking-wide\">{t.empty.action_rfq}</span>\n                <span className=\"text-[10px] font-medium text-emerald-100/90 mt-0.5 opacity-90 group-hover:opacity-100\">\n                    {t.empty.sla_fast}\n                </span>\n            </Link>\n\n            {/* Secondary Actions */}\n            <div className=\"grid gap-4 w-full max-w-sm\">\n                <div className=\"p-4 rounded-xl bg-slate-800/40 border border-slate-700/50 text-left\">\n                    <p className=\"text-sm font-semibold text-slate-300 mb-2\">{t.empty.try_also}</p>\n                    <div className=\"flex flex-wrap gap-2\">\n                        <span className=\"px-3 py-1 rounded-lg bg-slate-700/50 text-xs text-slate-400 border border-slate-600/50\">{t.empty.suggestion_general}</span>\n                        <span className=\"px-3 py-1 rounded-lg bg-slate-700/50 text-xs text-slate-400 border border-slate-600/50\">{t.empty.suggestion_no_brand}</span>\n                    </div>\n                </div>\n                <p className=\"text-xs text-slate-500\">{(t as any).empty?.hint_example ?? \"Näiteks: kipsplaat → kips\"}</p>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/products/ProductCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Image' is defined but never used.","line":4,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":13,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Image"},"fix":{"range":[49,80],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1533,1536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1533,1536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1623,1626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1623,1626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2036,2039],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2036,2039],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":66,"column":21,"nodeType":"JSXOpeningElement","endLine":71,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState } from \"react\";\nimport Image from \"next/image\";\nimport AddToCartButton from \"./AddToCartButton\";\nimport type { Product } from \"@/app/lib/types\";\nimport type { StoreName } from \"@/app/lib/stores\";\nimport { STORE_HOME_URL } from \"@/app/lib/stores\";\nimport { getProductImage } from \"@/app/lib/imageUtils\";\nimport { useLanguage } from \"@/components/i18n/LanguageProvider\";\nimport { getPartnerConfig } from \"@/app/lib/partners\";\n\nexport default function ProductCard({ product }: { product: Product }) {\n    const { t } = useLanguage();\n    const [showPrices, setShowPrices] = useState(false);\n\n    // Monetization / Partner Logic\n    // const { getPartnerConfig } = require(\"@/app/lib/partners\");\n\n    // Sort offers so we know the best one\n    const sortedOffers = [...product.offers].sort((a, b) => a.price - b.price);\n    const bestOffer = sortedOffers[0];\n\n    const partnerConfig = bestOffer ? getPartnerConfig(bestOffer.storeName) : null;\n    const isPartner = partnerConfig?.tier === \"premium\" || partnerConfig?.tier === \"partner\";\n\n    const minPrice = Math.min(...product.offers.map((o) => o.price));\n\n    // Resolve Image (Hybrid Strategy: Real > Fallback)\n    const hasSpecificImage = product.image && !product.image.includes(\"unsplash\");\n    // Ensure we use the helper to normalize path\n    const initialImage = getProductImage(hasSpecificImage ? product.image : undefined);\n    const [imgSrc, setImgSrc] = useState(initialImage);\n\n    // I18N Data Layer Logic\n    const categoryName = (t as any).categories?.[product.categoryKey] || product.category;\n    const genericName = (t as any).prod_generics?.[product.genericNameKey];\n\n    // Construct Display Name: \"GenericName Brand Spec\" (e.g. \"Kipsplaat Gyproc GN 13\")\n    // If genericName exists, use it. Otherwise fall back to legacy product.name\n    const displayName = genericName\n        ? `${genericName} ${product.brand || \"\"} ${product.specification || \"\"}`.trim().replace(/\\s+/g, \" \")\n        : product.name;\n\n    const unitName = (t as any).units?.[product.unitKey || \"\"] || product.unit;\n\n    return (\n        <div className={`group bg-[#1e293b] rounded-2xl border transition-all overflow-hidden flex flex-col h-full ${isPartner ? 'border-emerald-500/30 shadow-lg shadow-emerald-900/20' : 'border-slate-700 shadow-lg hover:border-slate-600'}`}>\n            {/* Top Section: Image & Basic Info */}\n            <div className=\"p-5 flex-grow\">\n                {/* Badge */}\n                <div className=\"flex justify-between items-start mb-3\">\n                    {isPartner ? (\n                        <div title=\"See pood vastab päringutele prioriteetselt\" className=\"bg-emerald-900/50 text-emerald-400 text-[10px] px-2 py-1 rounded-full font-bold uppercase tracking-wider border border-emerald-500/30 flex items-center gap-1 cursor-help\">\n                            <svg className=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M9.049 2.927c.3-.921 1.603-.921 1.602 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" /></svg>\n                            Partner\n                        </div>\n                    ) : (\n                        <div className=\"bg-slate-700 text-slate-300 text-[10px] px-2 py-1 rounded-full font-bold uppercase tracking-wider border border-slate-600\">\n                            {categoryName}\n                        </div>\n                    )}\n                </div>\n\n                <div className=\"aspect-[4/3] relative bg-slate-900 rounded-xl mb-4 overflow-hidden border border-slate-700/50\">\n                    <img\n                        src={imgSrc}\n                        alt={displayName}\n                        onError={() => setImgSrc(\"/images/products/placeholder.png\")}\n                        className=\"absolute inset-0 w-full h-full object-cover group-hover:scale-105 transition-transform duration-500 opacity-90 group-hover:opacity-100\"\n                    />\n                    {/* Gradient Overlay for Text Readability if needed, though we have cards below */}\n                    <div className=\"absolute inset-0 bg-gradient-to-t from-slate-900/40 to-transparent pointer-events-none\" />\n                </div>\n\n                <h3 className=\"font-bold text-slate-100 text-lg leading-tight mb-1\">{displayName}</h3>\n                <p className=\"text-sm text-slate-400 mb-4\">{t.products.unit_label}: {product.unitLabel || unitName}</p>\n\n                <div className=\"flex items-center justify-between mt-auto\">\n                    <div>\n                        <p className=\"text-xs text-slate-500\">{t.products.price_from}</p>\n                        <p className=\"text-xl font-bold text-emerald-400\">{minPrice.toFixed(2)} €</p>\n                    </div>\n\n                    <button\n                        onClick={() => setShowPrices(!showPrices)}\n                        className={`w-full md:w-auto px-6 py-3 md:py-2 rounded-xl text-sm font-bold transition-colors shadow-sm ${showPrices ? 'bg-slate-700 text-white' : 'bg-white text-slate-900 hover:bg-slate-200'}`}\n                    >\n                        {showPrices ? t.products.hide_prices : t.products.view_prices}\n                    </button>\n                </div>\n            </div>\n\n            {/* Expanded Section: Prices Table */}\n            {showPrices && (\n                <div className=\"border-t border-slate-700 bg-slate-800/50 p-4 animate-in slide-in-from-top-2 duration-200\">\n                    <div className=\"space-y-2 mb-4\">\n                        {sortedOffers.map((offer, idx) => {\n                            const isBest = offer.price === minPrice;\n\n                            // Affiliate / Partner Logic\n                            const offerPartnerConfig = getPartnerConfig(offer.storeName);\n                            // Base URL from store map\n                            const baseUrl = STORE_HOME_URL[offer.storeName as StoreName] || \"#\";\n                            // Append affiliate param if exists\n                            const finalUrl = offerPartnerConfig.affiliateParam\n                                ? `${baseUrl}${offerPartnerConfig.affiliateParam}`\n                                : baseUrl;\n\n                            return (\n                                <div key={idx} className={`flex items-center justify-between p-3 rounded-lg text-sm ${isBest ? 'bg-emerald-900/30 ring-1 ring-emerald-500/50' : 'bg-slate-700/30'}`}>\n                                    <div className=\"flex items-center gap-2\">\n                                        <div className={`w-2 h-2 rounded-full ${offer.logoColor}`} />\n                                        <span className={`font-medium ${offerPartnerConfig.tier === 'premium' ? 'text-emerald-400 font-bold' : 'text-slate-300'}`}>{offer.storeName}</span>\n                                    </div>\n\n                                    <div className=\"flex items-center gap-4\">\n                                        <div className=\"text-right\">\n                                            <div className={`font-semibold ${isBest ? 'text-emerald-400' : 'text-slate-200'}`}>\n                                                {offer.price.toFixed(2)} €\n                                            </div>\n                                        </div>\n\n                                        {/* Visit Store Link */}\n                                        <a\n                                            href={finalUrl}\n                                            target=\"_blank\"\n                                            rel=\"noopener noreferrer\"\n                                            className=\"text-xs font-medium text-slate-500 hover:text-white underline decoration-slate-600 hover:decoration-slate-400 transition-all flex items-center gap-1\"\n                                            title={t.products.go_to_store}\n                                        >\n                                            {t.products.go_to_store}\n                                            <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={2} stroke=\"currentColor\" className=\"w-3 h-3\">\n                                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25\" />\n                                            </svg>\n                                        </a>\n                                    </div>\n                                </div>\n                            )\n                        })}\n                    </div>\n\n                    <AddToCartButton product={product} />\n                    <p className=\"text-[10px] text-center text-slate-500 mt-2\">\n                        {t.products.tip_bulk}\n                    </p>\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/products/ProductList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/products/ProductsView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/ui/Skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/components/ui/Toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/next.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/dmitri/smartbuild-site/postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
